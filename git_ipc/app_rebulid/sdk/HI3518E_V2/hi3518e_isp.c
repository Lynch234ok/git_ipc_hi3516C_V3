
#include "hi3518e.h"
#include "hi3518e_isp_sensor.h"
#include "sdk/sdk_debug.h"
#include "sdk/sdk_api.h"
#include "sdk/sdk_isp_def.h"
#include "hi_isp_api.h"
#include "hi_isp.h"
#include "signal.h"
#include "hi_spi.h"
#include "hi3518e_vi_info.h"
#include "sdk_common.h"
//#include "hi_ssp.h"
#include "hi_isp_cfg.h"



#define HI3518A_VIN_DEV (0)
#define HI3518A_VIN_CHN (0)

#define GPIO_BASE_ADDR 0x20140000
#define ISP_GPIO_DAYLIGHT (0)
#define ISP_GPIO_NIGHT (1)

#define IRLED_CONTROL_MODE (0)
#define LIGHT_CONTROL_MODE (1)
#define SMART_CONTROL_MODE (2)

struct HI3518A_ERR_MAP
{
	uint32_t errno;
	const char* str;
};

static struct HI3518A_ERR_MAP _hi3518a_err_map[] =
{
	// sys
	{ 0xA0028003, "HI_ERR_SYS_ILLEGAL_PARAM", },
	{ 0xA0028006, "HI_ERR_SYS_NULL_PTR", },
	{ 0xA0028009, "HI_ERR_SYS_NOT_PERM", },
	{ 0xA0028010, "HI_ERR_SYS_NOTREADY", },
	{ 0xA0028012, "HI_ERR_SYS_BUSY", },
	{ 0xA002800C, "HI_ERR_SYS_NOMEM", },

	// venc
	{ 0xA0078001, "HI_ERR_VENC_INVALID_DEVID", },
	{ 0xA0078002, "HI_ERR_VENC_INVALID_CHNID", },
	{ 0xA0078003, "HI_ERR_VENC_ILLEGAL_PARAM", },
	{ 0xA0078004, "HI_ERR_VENC_EXIST", },
	{ 0xA0078005, "HI_ERR_VENC_UNEXIST", },
	{ 0xA0078006, "HI_ERR_VENC_NULL_PTR", },
	{ 0xA0078007, "HI_ERR_VENC_NOT_CONFIG", },
	{ 0xA0078008, "HI_ERR_VENC_NOT_SUPPORT", },
	{ 0xA0078009, "HI_ERR_VENC_NOT_PERM", },
	{ 0xA007800C, "HI_ERR_VENC_NOMEM", },
	{ 0xA007800D, "HI_ERR_VENC_NOBUF", },
	{ 0xA007800E, "HI_ERR_VENC_BUF_EMPTY", },
	{ 0xA007800F, "HI_ERR_VENC_BUF_FULL", },
	{ 0xA0078010, "HI_ERR_VENC_SYS_NOTREADY", },

	// vpss
	{ 0xA0088001, "HI_ERR_VPSS_INVALID_DEVID", },
	{ 0xA0088002, "HI_ERR_VPSS_INVALID_CHNID", },
	{ 0xA0088003, "HI_ERR_VPSS_ILLEGAL_PARAM", },
	{ 0xA0088004, "HI_ERR_VPSS_EXIST", },
	{ 0xA0088005, "HI_ERR_VPSS_UNEXIT", },
	{ 0xA0088006, "HI_ERR_VPSS_NULL_PTR", },
	{ 0xA0086008, "HI_ERR_VPSS_NOT_SUPPORT", },
	{ 0xA0088009, "HI_ERR_VPSS_NOT_PERM", },
	{ 0xA008800C, "HI_ERR_VPSS_NOMEM", },
	{ 0xA008800D, "HI_ERR_VPSS_NOBUF" },
	{ 0xA0088010, "HI_ERR_VPSS_NOTREADY", },
	{ 0xA0088012, "HI_ERR_VPSS_BUSY", },
};


const char* SOC_strerror(uint32_t errno)
{
	int i = 0;
	for(i = 0; i < (int)(sizeof(_hi3518a_err_map) / sizeof(_hi3518a_err_map[0])); ++i){
		if(errno == _hi3518a_err_map[i].errno){
			return _hi3518a_err_map[i].str;
		}
	}
	return "UNKNOWN ERROR!";
}

typedef struct _hi_isp_strength
{
	int strength;
	int daylight_val;
	int night_val;
}stHiIspStrength,*lpHiIspStrength;

typedef struct _hi_isp_attr
{
	stBSPApi bsp_api;
	stSensorApi api;
	emSENSOR_MODEL sensor_type;
	uint32_t gpio_status_old;// ISP_GPIO_DAYLIGHT;//daytime
	stSensorColorMaxValue color_max_value;
	uint8_t ircut_auto_switch_enable;// HI_TRUE;
	uint8_t ircut_control_mode;
	uint32_t sensor_resolution_width;
	uint32_t sensor_resolution_height;
	uint8_t src_framerate;
	uint8_t lowlight_mode;
	stHiIspStrength aeCompensition;
	stHiIspStrength aeHistSlope;
	stHiIspStrength aeHistOffset;
	stHiIspStrength wdr;
//	stHiIspStrength denoise3d_GlobalStrength;
	stHiIspStrength YPKStrength;
	stHiIspStrength YSFStrength;
	stHiIspStrength YTFStrength;
	stHiIspStrength YSmthStrength;
	
	uint8_t isp_auto_drc_enabled;
	stSensorAfAttr AfAttr;
	uint8_t isp_framerate_status;	
	uint8_t filter_frequency;
	LpIspCfgAttr ispCfgAttr;
	WDR_MODE_E isp_wdr_mode;
	bool vpss_flip;
	bool vpss_mirror;
	pthread_t isp_run_pid;
	pthread_t md_alarm_pid;
	bool md_alarm_thread_trigger;
	bool md_lock;
	uint8_t ircut_switch_control_mode;

	int (*sensor_set_mirror)(bool mirror);
	int (*sensor_set_flip)(bool flip);
	int (*sensor_get_resolution)(uint32_t * ret_width,uint32_t * ret_height);
	int (*sensor_get_name)(char *sensor_name);
	pthread_t awb_cal_pid;
	bool awb_thread_trigger;
	
}stHiIspAttr, *lpHiIspAttr;

static stHiIspAttr _isp_attr;

const HI_U16 gs_Gamma[22][GAMMA_NODE_NUMBER] = {
	//[0]
	{		0x0,0x28,0x60,0xb0,0xf8,0x140,0x170,0x194,0x1db,0x207,0x24f,0x295,0x2d7,0x316,0x352,0x38c,
0x3c3,0x3f7,0x429,0x459,0x487,0x4b4,0x4de,0x507,0x52e,0x553,0x578,0x59b,0x5be,0x5df,0x600,0x620,
0x63f,0x65e,0x67c,0x69a,0x6b7,0x6d3,0x6ef,0x70b,0x726,0x741,0x75b,0x775,0x78e,0x7a7,0x7c0,0x7d9,
0x7f1,0x80a,0x822,0x83a,0x851,0x869,0x881,0x898,0x8b0,0x8c8,0x8df,0x8f7,0x90f,0x927,0x93f,0x957,
0x970,0x988,0x9a1,0x9b9,0x9d2,0x9ea,0xa02,0xa1a,0xa32,0xa49,0xa60,0xa76,0xa8c,0xaa2,0xab6,0xacb,
0xade,0xaf1,0xb03,0xb14,0xb24,0xb33,0xb42,0xb4f,0xb5b,0xb66,0xb6f,0xb78,0xb7f,0xb91,0xba2,0xbb4,
0xbc5,0xbd7,0xbe8,0xbf9,0xc09,0xc1a,0xc2a,0xc3a,0xc4a,0xc59,0xc69,0xc78,0xc87,0xc95,0xca3,0xcb1,
0xcbf,0xccc,0xcd9,0xce5,0xcf1,0xcfd,0xd08,0xd14,0xd1e,0xd28,0xd32,0xd3b,0xd44,0xd4d,0xd55,0xd5c,
0xd63,0xd6a,0xd70,0xd75,0xd7a,0xd7f,0xd88,0xd92,0xd9c,0xda5,0xdaf,0xdb8,0xdc1,0xdca,0xdd4,0xddd,
0xde6,0xdee,0xdf7,0xe00,0xe08,0xe10,0xe19,0xe21,0xe29,0xe30,0xe38,0xe3f,0xe47,0xe4e,0xe55,0xe5b,
0xe62,0xe68,0xe6e,0xe74,0xe7a,0xe80,0xe85,0xe8a,0xe8f,0xe93,0xe98,0xe9c,0xea0,0xea3,0xea6,0xea9,
0xeac,0xeaf,0xeb3,0xeb7,0xebb,0xec0,0xec4,0xec9,0xecd,0xed2,0xed7,0xedc,0xee0,0xee5,0xeea,0xeef,
0xef4,0xef9,0xefe,0xf03,0xf08,0xf0d,0xf12,0xf18,0xf1d,0xf22,0xf27,0xf2c,0xf32,0xf37,0xf3c,0xf41,
0xf46,0xf4b,0xf51,0xf56,0xf5b,0xf60,0xf65,0xf6a,0xf6f,0xf74,0xf79,0xf7e,0xf83,0xf88,0xf8c,0xf91,
0xf96,0xf9a,0xf9f,0xfa4,0xfa8,0xfac,0xfb1,0xfb5,0xfb9,0xfbd,0xfc1,0xfc5,0xfc9,0xfcc,0xfd0,0xfd4,
0xfd7,0xfda,0xfde,0xfe1,0xfe4,0xfe7,0xfea,0xfec,0xfef,0xff1,0xff3,0xff6,0xff8,0xffa,0xffb,0xffd,
0xfff,
	},
	//[1]
	{
		96,160,205,237,262,294,330,374,422,474,528,592,672,739,795,843,886,926,963,997,1029,1061,1090,
		1118,1147,1176,1205,1232,1259,1286,1314,1341,1368,1395,1421,1446,1472,1498,1523,1549,1574,1600,
		1626,1651,1677,1702,1728,1754,1779,1805,1830,1854,1878,1902,1926,1950,1974,1994,2013,2032,2051,
		2070,2090,2109,2127,2146,2164,2182,2201,2219,2238,2255,2273,2290,2308,2326,2343,2361,2378,2394,
		2410,2426,2442,2458,2474,2490,2506,2522,2538,2554,2570,2586,2602,2618,2634,2649,2664,2679,2694,
		2710,2723,2737,2750,2764,2778,2791,2805,2818,2832,2846,2858,2871,2884,2897,2910,2922,2935,2948,
		2961,2973,2985,2997,3009,3021,3033,3045,3056,3067,3078,3090,3101,3112,3123,3134,3146,3155,3165,
		3174,3184,3194,3203,3213,3222,3232,3242,3251,3261,3270,3280,3290,3299,3307,3315,3323,3331,3339,
		3347,3355,3363,3371,3379,3387,3395,3403,3411,3419,3427,3435,3443,3450,3456,3462,3469,3475,3482,
		3488,3494,3501,3507,3514,3520,3526,3533,3539,3546,3552,3558,3565,3571,3576,3581,3586,3590,3595,
		3600,3605,3610,3614,3619,3624,3629,3634,3638,3643,3648,3653,3658,3662,3667,3672,3677,3682,3686,
		3691,3696,3701,3706,3710,3715,3720,3725,3730,3734,3739,3744,3749,3754,3758,3763,3768,3773,3778,
		3782,3787,3792,3797,3802,3806,3811,3816,3821,3826,3830,3835,3840,3846,3854,3864,3875,3888,3901,
		3915,3930,3946,3962,3981,4000,
	},
	//[2]
	{				
		0x0, 0x50, 0xA3, 0xF7, 0x14B, 0x19E, 0x1EE, 0x23A, 0x27F, 0x2BE, 0x303, 0x33E, 0x372, 0x39F, 0x3C9, 
		0x3F3, 0x41D, 0x442, 0x464, 0x485, 0x4A4, 0x4C3, 0x4E2, 0x502, 0x524, 0x546, 0x567, 0x588, 0x5AA, 0x5CD, 
		0x5F3, 0x61C, 0x649, 0x662, 0x67D, 0x699, 0x6B7, 0x6D5, 0x6F5, 0x715, 0x735, 0x755, 0x775, 0x794, 0x7B2, 
		0x7CF, 0x7EB, 0x805, 0x81D, 0x833, 0x847, 0x85A, 0x86C, 0x87C, 0x88C, 0x89B, 0x8AA, 0x8B8, 0x8C6, 0x8D4, 
		0x8E3, 0x8F2, 0x902, 0x912, 0x924, 0x937, 0x94A, 0x95E, 0x972, 0x986, 0x99B, 0x9B0, 0x9C5, 0x9DA, 0x9EF, 
		0xA04, 0xA18, 0xA2C, 0xA40, 0xA53, 0xA66, 0xA78, 0xA8A, 0xA9C, 0xAAE, 0xAC0, 0xAD1, 0xAE3, 0xAF3, 0xB04, 
		0xB14, 0xB24, 0xB34, 0xB43, 0xB51, 0xB5F, 0xB6D, 0xB7A, 0xB86, 0xB91, 0xB9B, 0xBA5, 0xBAE, 0xBB7, 0xBC0, 
		0xBC8, 0xBD1, 0xBDA, 0xBE4, 0xBEE, 0xBF8, 0xC04, 0xC10, 0xC1D, 0xC2B, 0xC3A, 0xC49, 0xC59, 0xC69, 0xC7A, 
		0xC8A, 0xC9B, 0xCAB, 0xCBC, 0xCCB, 0xCDB, 0xCEA, 0xCF8, 0xD06, 0xD13, 0xD20, 0xD2D, 0xD3A, 0xD46, 0xD52, 
		0xD5E, 0xD6A, 0xD75, 0xD80, 0xD8A, 0xD94, 0xD9D, 0xDA6, 0xDAE, 0xDB6, 0xDBD, 0xDC2, 0xDC7, 0xDCB, 0xDCF, 
		0xDD2, 0xDD4, 0xDD7, 0xDD9, 0xDDB, 0xDDD, 0xDE0, 0xDE3, 0xDE7, 0xDEB, 0xDF0, 0xDF6, 0xDFC, 0xE03, 0xE0A, 
		0xE12, 0xE1A, 0xE22, 0xE2A, 0xE33, 0xE3B, 0xE43, 0xE4A, 0xE52, 0xE59, 0xE5F, 0xE65, 0xE6A, 0xE6F, 0xE74, 
		0xE78, 0xE7C, 0xE7F, 0xE83, 0xE86, 0xE89, 0xE8C, 0xE90, 0xE93, 0xE96, 0xE99, 0xE9C, 0xEA0, 0xEA4, 0xEA7, 
		0xEAB, 0xEAE, 0xEB1, 0xEB5, 0xEB8, 0xEBB, 0xEBF, 0xEC2, 0xEC6, 0xEC9, 0xECD, 0xED1, 0xED6, 0xEDA, 0xEDF, 
		0xEE4, 0xEE9, 0xEEF, 0xEF4, 0xEFA, 0xF00, 0xF06, 0xF0C, 0xF12, 0xF18, 0xF1D, 0xF23, 0xF28, 0xF2D, 0xF32, 
		0xF36, 0xF3A, 0xF3E, 0xF41, 0xF44, 0xF46, 0xF49, 0xF4C, 0xF4F, 0xF52, 0xF55, 0xF59, 0xF5D, 0xF62, 0xF67, 
		0xF6D, 0xF74, 0xF7B, 0xF83, 0xF8B, 0xF94, 0xF9D, 0xFA7, 0xFB1, 0xFBA, 0xFC4, 0xFCE, 0xFD8, 0xFE2, 0xFEC, 
		0xFF6, 0xFFF
		},
		//[3]
	{
		0x0,0x11,0x2b,0x4d,0x75,0xa1,0xd0,0xff,0x12f,0x15e,0x18d,0x1bc,0x1ea,0x217,0x244,0x271,
		0x29d,0x2c9,0x2f4,0x31f,0x349,0x373,0x39d,0x3c6,0x3ef,0x417,0x43f,0x466,0x48d,0x4b4,0x4da,0x500,
		0x525,0x54a,0x56f,0x593,0x5b7,0x5da,0x5fd,0x620,0x642,0x664,0x685,0x6a7,0x6c7,0x6e7,0x707,0x727,
		0x746,0x765,0x783,0x7a1,0x7bf,0x7dc,0x7f9,0x816,0x832,0x84e,0x869,0x884,0x89f,0x8b9,0x8d3,0x8ed,
		0x907,0x920,0x938,0x951,0x969,0x980,0x998,0x9af,0x9c6,0x9dc,0x9f2,0xa08,0xa1e,0xa33,0xa48,0xa5d,
		0xa71,0xa85,0xa99,0xaad,0xac0,0xad3,0xae6,0xaf9,0xb0b,0xb1d,0xb2f,0xb40,0xb52,0xb63,0xb74,0xb84,
		0xb95,0xba5,0xbb5,0xbc5,0xbd5,0xbe4,0xbf3,0xc02,0xc11,0xc20,0xc2e,0xc3c,0xc4b,0xc58,0xc66,0xc74,
		0xc81,0xc8f,0xc9c,0xca9,0xcb5,0xcc2,0xccf,0xcdb,0xce7,0xcf4,0xd00,0xd0b,0xd17,0xd23,0xd2e,0xd3a,
		0xd45,0xd50,0xd5b,0xd66,0xd71,0xd7b,0xd86,0xd90,0xd9b,0xda5,0xdaf,0xdb9,0xdc3,0xdcc,0xdd6,0xddf,
		0xde9,0xdf2,0xdfb,0xe04,0xe0d,0xe16,0xe1f,0xe27,0xe30,0xe38,0xe40,0xe48,0xe50,0xe58,0xe60,0xe68,
		0xe70,0xe77,0xe7f,0xe86,0xe8d,0xe95,0xe9c,0xea3,0xeaa,0xeb0,0xeb7,0xebe,0xec4,0xecb,0xed1,0xed7,
		0xedd,0xee4,0xeea,0xef0,0xef5,0xefb,0xf01,0xf06,0xf0c,0xf11,0xf17,0xf1c,0xf21,0xf26,0xf2b,0xf30,
		0xf35,0xf3a,0xf3f,0xf44,0xf48,0xf4d,0xf51,0xf56,0xf5a,0xf5e,0xf63,0xf67,0xf6b,0xf6f,0xf73,0xf77,
		0xf7b,0xf7f,0xf82,0xf86,0xf8a,0xf8d,0xf91,0xf94,0xf98,0xf9b,0xf9e,0xfa2,0xfa5,0xfa8,0xfab,0xfae,
		0xfb1,0xfb4,0xfb7,0xfba,0xfbd,0xfc0,0xfc2,0xfc5,0xfc8,0xfca,0xfcd,0xfd0,0xfd2,0xfd5,0xfd7,0xfda,
		0xfdc,0xfde,0xfe1,0xfe3,0xfe5,0xfe7,0xfea,0xfec,0xfee,0xff0,0xff2,0xff4,0xff6,0xff8,0xffb,0xffd,
		0xfff
	},
	//[4]
	{
		0x0, 0x36, 0x6a, 0x9e, 0xd1, 0x103, 0x134, 0x164, 0x193, 0x1c2, 0x1ef, 0x21c, 0x248, 0x274, 0x29e, 0x2c9, 
		0x2f2, 0x31b, 0x343, 0x36a, 0x391, 0x3b7, 0x3dd, 0x402, 0x426, 0x44a, 0x46d, 0x490, 0x4b3, 0x4d4, 0x4f6, 0x517, 
		0x537, 0x557, 0x576, 0x595, 0x5b4, 0x5d2, 0x5f0, 0x60d, 0x62a, 0x647, 0x663, 0x67f, 0x69a, 0x6b5, 0x6d0, 0x6ea, 
		0x704, 0x71e, 0x738, 0x751, 0x769, 0x782, 0x79a, 0x7b2, 0x7c9, 0x7e1, 0x7f8, 0x80e, 0x825, 0x83b, 0x851, 0x866, 
		0x87c, 0x891, 0x8a6, 0x8bb, 0x8cf, 0x8e3, 0x8f7, 0x90b, 0x91f, 0x932, 0x945, 0x958, 0x96b, 0x97d, 0x98f, 0x9a1, 
		0x9b3, 0x9c5, 0x9d7, 0x9e8, 0x9f9, 0xa0a, 0xa1b, 0xa2b, 0xa3c, 0xa4c, 0xa5c, 0xa6c, 0xa7c, 0xa8c, 0xa9b, 0xaab, 
		0xaba, 0xac9, 0xad8, 0xae6, 0xaf5, 0xb03, 0xb12, 0xb20, 0xb2e, 0xb3c, 0xb4a, 0xb57, 0xb65, 0xb72, 0xb80, 0xb8d, 
		0xb9a, 0xba7, 0xbb4, 0xbc0, 0xbcd, 0xbd9, 0xbe6, 0xbf2, 0xbfe, 0xc0a, 0xc16, 0xc22, 0xc2e, 0xc39, 0xc45, 0xc50, 
		0xc5c, 0xc67, 0xc72, 0xc7d, 0xc88, 0xc93, 0xc9e, 0xca8, 0xcb3, 0xcbe, 0xcc8, 0xcd2, 0xcdd, 0xce7, 0xcf1, 0xcfb, 
		0xd05, 0xd0f, 0xd18, 0xd22, 0xd2c, 0xd35, 0xd3f, 0xd48, 0xd52, 0xd5b, 0xd64, 0xd6d, 0xd76, 0xd7f, 0xd88, 0xd91, 
		0xd9a, 0xda2, 0xdab, 0xdb4, 0xdbc, 0xdc5, 0xdcd, 0xdd5, 0xdde, 0xde6, 0xdee, 0xdf6, 0xdfe, 0xe06, 0xe0e, 0xe16, 
		0xe1e, 0xe25, 0xe2d, 0xe35, 0xe3c, 0xe44, 0xe4c, 0xe53, 0xe5a, 0xe62, 0xe69, 0xe70, 0xe77, 0xe7f, 0xe86, 0xe8d, 
		0xe94, 0xe9b, 0xea2, 0xea8, 0xeaf, 0xeb6, 0xebd, 0xec3, 0xeca, 0xed1, 0xed7, 0xede, 0xee4, 0xeeb, 0xef1, 0xef7, 
		0xefe, 0xf04, 0xf0a, 0xf10, 0xf17, 0xf1d, 0xf23, 0xf29, 0xf2f, 0xf35, 0xf3b, 0xf41, 0xf46, 0xf4c, 0xf52, 0xf58, 
		0xf5d, 0xf63, 0xf69, 0xf6e, 0xf74, 0xf7a, 0xf7f, 0xf85, 0xf8a, 0xf8f, 0xf95, 0xf9a, 0xf9f, 0xfa5, 0xfaa, 0xfaf, 
		0xfb4, 0xfba, 0xfbf, 0xfc4, 0xfc9, 0xfce, 0xfd3, 0xfd8, 0xfdd, 0xfe2, 0xfe7, 0xfec, 0xff1, 0xff5, 0xffa, 0xfff, 
		0xfff, 
	},
	//[5]
	{
		0x0,   0xe,    0x20, 0x35,  0x4d, 0x68, 0x85,  0xa5,  0xc7, 0xeb,  0x110,0x138,0x162,0x18d,0x1b9,0x1e6,
		0x215,0x244,0x274,0x2a5,0x2d6,0x308,0x33a,0x36b,0x39d,0x3ce,0x3ff,0x42f,0x45f,0x48d,0x4bb,0x4e8,
		0x515,0x540,0x56b,0x595,0x5bd,0x5e5,0x60c,0x633,0x658,0x67c,0x69f,0x6c1,0x6e2,0x702,0x721,0x73f,
		0x75c,0x778,0x792,0x7ac,0x7c5,0x7de,0x7f5,0x80c,0x822,0x838,0x84d,0x861,0x876,0x88a,0x89e,0x8b1,
		0x8c5,0x8d8,0x8eb,0x8ff,0x912,0x926,0x93a,0x94e,0x962,0x975,0x989,0x99d,0x9b1,0x9c5,0x9d9,0x9ec,
		0xa00,0xa13,0xa27,0xa3a,0xa4d,0xa5f,0xa72,0xa84,0xa97,0xaa8,0xaba,0xacb,0xadc,0xaed,0xafd,0xb0d,
		0xb1d,0xb2c,0xb3b,0xb49,0xb57,0xb64,0xb71,0xb7d,0xb89,0xb95,0xb9f,0xba9,0xbb3,0xbbc,0xbc4,0xbcc,
		0xbd3,0xbd9,0xbdf,0xbeb,0xbf8,0xc04,0xc10,0xc1c,0xc29,0xc35,0xc41,0xc4c,0xc58,0xc64,0xc70,0xc7b,
		0xc87,0xc92,0xc9e,0xca9,0xcb4,0xcbf,0xccb,0xcd6,0xce1,0xceb,0xcf6,0xd01,0xd0c,0xd16,0xd21,0xd2b,
		0xd36,0xd40,0xd4a,0xd54,0xd5e,0xd68,0xd72,0xd7c,0xd86,0xd90,0xd99,0xda3,0xdac,0xdb6,0xdbf,0xdc8,
		0xdd2,0xddb,0xde4,0xded,0xdf6,0xdff,0xe07,0xe10,0xe19,0xe21,0xe2a,0xe32,0xe3b,0xe43,0xe4b,0xe53,
		0xe5b,0xe63,0xe6b,0xe73,0xe7b,0xe83,0xe8a,0xe92,0xe9a,0xea1,0xea8,0xeb0,0xeb7,0xebe,0xec5,0xecc,
		0xed3,0xeda,0xee1,0xee7,0xeee,0xef5,0xefb,0xf02,0xf08,0xf0e,0xf15,0xf1b,0xf21,0xf27,0xf2d,0xf33,
		0xf39,0xf3e,0xf44,0xf4a,0xf4f,0xf55,0xf5a,0xf5f,0xf65,0xf6a,0xf6f,0xf74,0xf79,0xf7e,0xf83,0xf87,
		0xf8c,0xf91,0xf95,0xf9a,0xf9e,0xfa3,0xfa7,0xfab,0xfaf,0xfb3,0xfb7,0xfbb,0xfbf,0xfc3,0xfc7,0xfcb,
		0xfce,0xfd2,0xfd5,0xfd9,0xfdc,0xfdf,0xfe2,0xfe5,0xfe8,0xfeb,0xfee,0xff1,0xff4,0xff7,0xff9,0xffc,
		0xffe,
	},
	//18e v200 ar0130 p2-2 daylight   [6]
	{
		0x0,0x10F,0x17C,0x1CF,0x216,0x253,0x28B,0x2BE,0x2ED,0x31A,0x344,0x36C,0x392,0x3B7,0x3DA,0x3FC,
		0x41D,0x43C,0x45B,0x479,0x496,0x4B3,0x4CE,0x4E9,0x504,0x51E,0x537,0x550,0x569,0x581,0x598,0x5AF,
		0x5C6,0x5DD,0x5F3,0x609,0x61E,0x633,0x648,0x65D,0x671,0x685,0x699,0x6AD,0x6C0,0x6D3,0x6E6,0x6F9,
		0x70B,0x71D,0x730,0x741,0x753,0x765,0x776,0x787,0x799,0x7AA,0x7BA,0x7CB,0x7DB,0x7EC,0x7FC,0x80C,
		0x81C,0x82C,0x83C,0x84B,0x85B,0x86A,0x879,0x888,0x897,0x8A6,0x8B5,0x8C4,0x8D2,0x8E1,0x8EF,0x8FE,
		0x90C,0x91A,0x928,0x936,0x944,0x952,0x95F,0x96D,0x97B,0x988,0x996,0x9A3,0x9B0,0x9BD,0x9CA,0x9D7,
		0x9E4,0x9F1,0x9FE,0xA0B,0xA18,0xA24,0xA31,0xA3D,0xA4A,0xA56,0xA62,0xA6F,0xA7B,0xA87,0xA93,0xA9F,
		0xAAB,0xAB7,0xAC3,0xACF,0xADA,0xAE6,0xAF2,0xAFD,0xB09,0xB14,0xB20,0xB2B,0xB37,0xB42,0xB4D,0xB59,
		0xB64,0xB6F,0xB7A,0xB85,0xB90,0xB9B,0xBA6,0xBB1,0xBBC,0xBC6,0xBD1,0xBDC,0xBE7,0xBF1,0xBFC,0xC06,
		0xC11,0xC1B,0xC26,0xC30,0xC3B,0xC45,0xC4F,0xC5A,0xC64,0xC6E,0xC78,0xC82,0xC8D,0xC97,0xCA1,0xCAB,
		0xCB5,0xCBF,0xCC8,0xCD2,0xCDC,0xCE6,0xCF0,0xCFA,0xD03,0xD0D,0xD17,0xD20,0xD2A,0xD34,0xD3D,0xD47,
		0xD50,0xD5A,0xD63,0xD6C,0xD76,0xD7F,0xD89,0xD92,0xD9B,0xDA4,0xDAE,0xDB7,0xDC0,0xDC9,0xDD2,0xDDC,
		0xDE5,0xDEE,0xDF7,0xE00,0xE09,0xE12,0xE1B,0xE24,0xE2C,0xE35,0xE3E,0xE47,0xE50,0xE59,0xE61,0xE6A,
		0xE73,0xE7C,0xE84,0xE8D,0xE96,0xE9E,0xEA7,0xEAF,0xEB8,0xEC0,0xEC9,0xED1,0xEDA,0xEE2,0xEEB,0xEF3,
		0xEFC,0xF04,0xF0C,0xF15,0xF1D,0xF25,0xF2E,0xF36,0xF3E,0xF46,0xF4F,0xF57,0xF5F,0xF67,0xF6F,0xF77,
		0xF80,0xF88,0xF90,0xF98,0xFA0,0xFA8,0xFB0,0xFB8,0xFC0,0xFC8,0xFD0,0xFD8,0xFE0,0xFE7,0xFEF,0xFF7,
		0xFFF,
	},
	//18e v200 ar0130 night [7]
	{
			0x0,0x42,0x85,0xC9,0x10E,0x151,0x195,0x1D7,0x217,0x255,0x291,0x2C4,0x2F7,0x327,0x356,0x385,
		0x3B2,0x3DE,0x409,0x435,0x45F,0x48A,0x4B4,0x4DE,0x506,0x52E,0x556,0x57D,0x5A3,0x5CA,0x5F1,0x617,
		0x63F,0x65A,0x675,0x691,0x6AD,0x6C8,0x6E4,0x700,0x71C,0x737,0x752,0x76D,0x788,0x7A1,0x7BB,0x7D3,
		0x7EC,0x803,0x81A,0x830,0x847,0x85C,0x871,0x886,0x89B,0x8AF,0x8C3,0x8D6,0x8EA,0x8FC,0x90F,0x921,
		0x934,0x945,0x957,0x968,0x978,0x989,0x999,0x9A8,0x9B8,0x9C7,0x9D6,0x9E5,0x9F3,0xA01,0xA0F,0xA1D,
		0xA2B,0xA38,0xA45,0xA51,0xA5E,0xA6A,0xA75,0xA81,0xA8C,0xA97,0xAA3,0xAAE,0xAB8,0xAC3,0xACE,0xAD9,
		0xAE5,0xAF0,0xAFB,0xB06,0xB11,0xB1C,0xB27,0xB32,0xB3D,0xB48,0xB52,0xB5D,0xB67,0xB72,0xB7C,0xB86,
		0xB90,0xB99,0xBA2,0xBAC,0xBB5,0xBBE,0xBC6,0xBCF,0xBD7,0xBE0,0xBE8,0xBF1,0xBF9,0xC01,0xC0A,0xC12,
		0xC1B,0xC23,0xC2C,0xC34,0xC3D,0xC45,0xC4E,0xC56,0xC5E,0xC67,0xC6F,0xC77,0xC80,0xC88,0xC90,0xC98,
		0xCA0,0xCA7,0xCAF,0xCB7,0xCBE,0xCC5,0xCCD,0xCD4,0xCDB,0xCE3,0xCEA,0xCF1,0xCF8,0xCFF,0xD06,0xD0D,
		0xD15,0xD1C,0xD23,0xD2A,0xD32,0xD39,0xD40,0xD47,0xD4F,0xD56,0xD5D,0xD64,0xD6A,0xD71,0xD77,0xD7D,
		0xD83,0xD88,0xD8D,0xD92,0xD96,0xD9B,0xD9F,0xDA3,0xDA7,0xDAB,0xDAF,0xDB3,0xDB6,0xDBA,0xDBE,0xDC2,
		0xDC6,0xDC9,0xDCD,0xDD1,0xDD5,0xDD9,0xDDD,0xDE1,0xDE5,0xDE9,0xDED,0xDF0,0xDF4,0xDF8,0xDFB,0xDFE,
		0xE02,0xE05,0xE08,0xE0B,0xE0D,0xE10,0xE13,0xE15,0xE18,0xE1A,0xE1D,0xE1F,0xE21,0xE24,0xE26,0xE28,
		0xE2B,0xE2D,0xE2F,0xE31,0xE32,0xE34,0xE36,0xE38,0xE39,0xE3B,0xE3D,0xE3F,0xE40,0xE42,0xE44,0xE46,
		0xE49,0xE4B,0xE4D,0xE50,0xE52,0xE55,0xE58,0xE5A,0xE5D,0xE60,0xE63,0xE66,0xE68,0xE6B,0xE6E,0xE71,
		0xE74,

	},
		//[8]
	{
		0x0,0x78,0xDC,0x136,0x186,0x1D6,0x21C,0x262,0x29E,0x2DA,0x312,0x34A,0x37E,0x3B0,0x3E2,0x41A,
		0x448,0x472,0x49A,0x4C2,0x4E6,0x500,0x522,0x542,0x562,0x580,0x59E,0x5BB,0x5D5,0x5EF,0x607,0x620,
		0x638,0x64F,0x666,0x67D,0x693,0x6A9,0x6BE,0x6D4,0x6E9,0x6FD,0x712,0x726,0x739,0x74D,0x760,0x773,
		0x786,0x799,0x7AB,0x7BD,0x7CF,0x7E1,0x7F2,0x804,0x815,0x826,0x836,0x847,0x858,0x868,0x878,0x888,
		0x898,0x8A8,0x8B7,0x8C7,0x8D6,0x8E5,0x8F4,0x903,0x912,0x921,0x92F,0x93E,0x94C,0x95A,0x968,0x976,
		0x984,0x992,0x9A0,0x9AD,0x9BB,0x9C8,0x9D6,0x9E3,0x9F0,0x9FD,0xA0A,0xA17,0xA24,0xA31,0xA3D,0xA4A,
		0xA56,0xA63,0xA6F,0xA7B,0xA88,0xA94,0xAA0,0xAAC,0xAB8,0xAC4,0xACF,0xADB,0xAE7,0xAF2,0xAFE,0xB09,
		0xB15,0xB20,0xB2B,0xB37,0xB42,0xB4D,0xB58,0xB63,0xB6E,0xB79,0xB84,0xB8F,0xB99,0xBA4,0xBAF,0xBB9,
		0xBC4,0xBCF,0xBD9,0xBE3,0xBEE,0xBF8,0xC02,0xC0D,0xC17,0xC21,0xC2B,0xC35,0xC3F,0xC49,0xC53,0xC5D,
		0xC67,0xC71,0xC7A,0xC84,0xC8E,0xC98,0xCA1,0xCAB,0xCB4,0xCBE,0xCC7,0xCD1,0xCDA,0xCE4,0xCED,0xCF6,
		0xCFF,0xD09,0xD12,0xD1B,0xD24,0xD2D,0xD36,0xD3F,0xD48,0xD51,0xD5A,0xD63,0xD6C,0xD75,0xD7E,0xD87,
		0xD8F,0xD98,0xDA1,0xDAA,0xDB2,0xDBB,0xDC3,0xDCC,0xDD4,0xDDD,0xDE5,0xDEE,0xDF6,0xDFF,0xE07,0xE10,
		0xE18,0xE20,0xE28,0xE31,0xE39,0xE41,0xE49,0xE51,0xE5A,0xE62,0xE6A,0xE72,0xE7A,0xE82,0xE8A,0xE92,
		0xE9A,0xEA2,0xEAA,0xEB2,0xEB9,0xEC1,0xEC9,0xED1,0xED9,0xEE0,0xEE8,0xEF0,0xEF8,0xEFF,0xF07,0xF0F,
		0xF16,0xF1E,0xF25,0xF2D,0xF34,0xF3C,0xF43,0xF4B,0xF52,0xF5A,0xF61,0xF69,0xF70,0xF77,0xF7F,0xF86,
		0xF8D,0xF95,0xF9C,0xFA3,0xFAA,0xFB2,0xFB9,0xFC0,0xFC7,0xFCE,0xFD6,0xFDD,0xFE4,0xFEB,0xFF2,0xFF9,
		0xFFF,
	},
	//[9]  2035 daylight
	{	0x0,0x78,0xDC,0x136,0x186,0x1D6,0x21C,0x262,0x29E,0x2DA,0x312,0x34A,0x37E,0x3B0,0x3E2,0x41A,
		0x448,0x472,0x49A,0x4C2,0x4E6,0x500,0x522,0x542,0x562,0x580,0x59E,0x5BB,0x5D5,0x5EF,0x607,0x620,
		0x638,0x64F,0x666,0x67D,0x693,0x6A9,0x6BE,0x6D4,0x6E9,0x6FD,0x712,0x726,0x739,0x74D,0x760,0x773,
		0x786,0x799,0x7AB,0x7BD,0x7CF,0x7E1,0x7F2,0x804,0x815,0x826,0x836,0x847,0x858,0x868,0x878,0x888,
		0x898,0x8A8,0x8B7,0x8C7,0x8D6,0x8E5,0x8F4,0x903,0x912,0x921,0x92F,0x93E,0x94C,0x95A,0x968,0x976,
		0x984,0x992,0x9A0,0x9AD,0x9BB,0x9C8,0x9D6,0x9E3,0x9F0,0x9FD,0xA0A,0xA17,0xA24,0xA31,0xA3D,0xA4A,
		0xA56,0xA63,0xA6F,0xA7B,0xA88,0xA94,0xAA0,0xAAC,0xAB8,0xAC4,0xACF,0xADB,0xAE7,0xAF2,0xAFE,0xB09,
		0xB15,0xB20,0xB2B,0xB37,0xB42,0xB4D,0xB58,0xB63,0xB6E,0xB79,0xB84,0xB8F,0xB99,0xBA4,0xBAF,0xBB9,
		0xBC4,0xBCF,0xBD9,0xBE3,0xBEE,0xBF8,0xC02,0xC0D,0xC17,0xC21,0xC2B,0xC35,0xC3F,0xC49,0xC53,0xC5D,
		0xC67,0xC71,0xC7A,0xC84,0xC8E,0xC98,0xCA1,0xCAB,0xCB4,0xCBE,0xCC7,0xCD1,0xCDA,0xCE4,0xCED,0xCF6,
		0xCFF,0xD09,0xD12,0xD1B,0xD24,0xD2D,0xD36,0xD3F,0xD48,0xD51,0xD5A,0xD63,0xD6C,0xD75,0xD7E,0xD87,
		0xD8F,0xD98,0xDA1,0xDAA,0xDB2,0xDBB,0xDC3,0xDCC,0xDD4,0xDDD,0xDE5,0xDEE,0xDF6,0xDFF,0xE07,0xE10,
		0xE18,0xE20,0xE28,0xE31,0xE39,0xE41,0xE49,0xE51,0xE5A,0xE62,0xE6A,0xE72,0xE7A,0xE82,0xE8A,0xE92,
		0xE9A,0xEA2,0xEAA,0xEB2,0xEB9,0xEC1,0xEC9,0xED1,0xED9,0xEE0,0xEE8,0xEF0,0xEF8,0xEFF,0xF07,0xF0F,
		0xF16,0xF1E,0xF25,0xF2D,0xF34,0xF3C,0xF43,0xF4B,0xF52,0xF5A,0xF61,0xF69,0xF70,0xF77,0xF7F,0xF86,
		0xF8D,0xF95,0xF9C,0xFA3,0xFAA,0xFB2,0xFB9,0xFC0,0xFC7,0xFCE,0xFD6,0xFDD,0xFE4,0xFEB,0xFF2,0xFF9,
		0xFFF,

	},	
	//[10] 2035 night
	{
		0x0,0x62,0xC5,0x129,0x18B,0x1EB,0x247,0x271,0x29A,0x2C4,0x2ED,0x316,0x33E,0x365,0x38C,0x3B1,
		0x3D6,0x3F9,0x41B,0x43B,0x45A,0x477,0x492,0x4AC,0x4C5,0x4DD,0x4F5,0x50C,0x522,0x538,0x54E,0x564,
		0x57A,0x58C,0x59E,0x5AF,0x5C0,0x5D1,0x5E1,0x5F1,0x601,0x611,0x621,0x631,0x641,0x651,0x661,0x672,
		0x682,0x693,0x6A3,0x6B4,0x6C5,0x6D6,0x6E6,0x6F7,0x708,0x719,0x729,0x73A,0x74A,0x75B,0x76B,0x77A,
		0x78A,0x799,0x7A8,0x7B7,0x7C6,0x7D4,0x7E3,0x7F1,0x7FF,0x80D,0x81B,0x829,0x837,0x845,0x854,0x862,
		0x870,0x87E,0x88D,0x89B,0x8AA,0x8B8,0x8C6,0x8D5,0x8E3,0x8F2,0x900,0x90E,0x91C,0x92A,0x938,0x946,
		0x954,0x961,0x96F,0x97C,0x98A,0x997,0x9A5,0x9B2,0x9BF,0x9CC,0x9D9,0x9E6,0x9F3,0xA00,0xA0D,0xA1A,
		0xA27,0xA34,0xA40,0xA4D,0xA5A,0xA66,0xA73,0xA7F,0xA8B,0xA98,0xAA4,0xAB0,0xABD,0xAC9,0xAD5,0xAE1,
		0xAED,0xAF9,0xB05,0xB11,0xB1D,0xB29,0xB34,0xB40,0xB4C,0xB57,0xB63,0xB6F,0xB7A,0xB86,0xB91,0xB9D,
		0xBA8,0xBB4,0xBBF,0xBCA,0xBD5,0xBE1,0xBEC,0xBF7,0xC02,0xC0D,0xC18,0xC23,0xC2E,0xC39,0xC44,0xC4F,
		0xC5A,0xC65,0xC70,0xC7B,0xC85,0xC90,0xC9B,0xCA6,0xCB0,0xCBB,0xCC5,0xCD0,0xCDB,0xCE5,0xCEF,0xCFA,
		0xD04,0xD0F,0xD19,0xD23,0xD2E,0xD38,0xD42,0xD4D,0xD57,0xD61,0xD6B,0xD75,0xD7F,0xD8A,0xD94,0xD9E,
		0xDA8,0xDB2,0xDBC,0xDC6,0xDD0,0xDDA,0xDE3,0xDED,0xDF7,0xE01,0xE0B,0xE14,0xE1E,0xE28,0xE32,0xE3B,
		0xE45,0xE4F,0xE58,0xE62,0xE6C,0xE75,0xE7F,0xE88,0xE92,0xE9B,0xEA5,0xEAE,0xEB8,0xEC1,0xECA,0xED4,
		0xEDD,0xEE6,0xEF0,0xEF9,0xF02,0xF0C,0xF15,0xF1E,0xF27,0xF30,0xF3A,0xF43,0xF4C,0xF55,0xF5E,0xF67,
		0xF70,0xF79,0xF82,0xF8B,0xF94,0xF9D,0xFA6,0xFAF,0xFB8,0xFC1,0xFCA,0xFD3,0xFDC,0xFE5,0xFED,0xFF6,
		0xFFF,	
	},
	//[11] 1035 day
	{
		0x0,0x4F,0x9F,0xF1,0x143,0x193,0x1E2,0x22D,0x274,0x2B6,0x2F2,0x329,0x35C,0x38C,0x3BA,0x3E6,
		0x412,0x43D,0x46A,0x487,0x4A4,0x4C1,0x4DD,0x4F9,0x515,0x530,0x54B,0x566,0x581,0x59C,0x5B6,0x5D0,
		0x5EA,0x601,0x617,0x62D,0x643,0x659,0x66E,0x684,0x699,0x6AE,0x6C3,0x6D8,0x6EC,0x701,0x715,0x72A,
		0x73E,0x752,0x766,0x77A,0x78E,0x7A2,0x7B6,0x7CA,0x7DD,0x7F0,0x803,0x816,0x829,0x83B,0x84D,0x85F,
		0x870,0x881,0x892,0x8A2,0x8B2,0x8C1,0x8D0,0x8E0,0x8EF,0x8FD,0x90C,0x91B,0x929,0x938,0x946,0x955,
		0x964,0x973,0x982,0x991,0x9A0,0x9B0,0x9BF,0x9CE,0x9DD,0x9EC,0x9FA,0xA09,0xA17,0xA25,0xA33,0xA41,
		0xA4E,0xA5B,0xA67,0xA73,0xA7F,0xA8B,0xA96,0xAA1,0xAAC,0xAB7,0xAC2,0xACD,0xAD8,0xAE3,0xAEE,0xAF9,
		0xB05,0xB11,0xB1D,0xB29,0xB35,0xB41,0xB4D,0xB5A,0xB66,0xB72,0xB7E,0xB8A,0xB96,0xBA2,0xBAD,0xBB9,
		0xBC4,0xBCF,0xBDA,0xBE4,0xBEF,0xBF9,0xC04,0xC0E,0xC18,0xC22,0xC2C,0xC36,0xC40,0xC4A,0xC53,0xC5D,
		0xC67,0xC71,0xC7B,0xC84,0xC8E,0xC98,0xCA1,0xCAB,0xCB4,0xCBE,0xCC7,0xCD0,0xCDA,0xCE3,0xCEC,0xCF6,
		0xCFF,0xD08,0xD11,0xD1B,0xD24,0xD2D,0xD36,0xD3F,0xD48,0xD51,0xD5A,0xD63,0xD6C,0xD75,0xD7D,0xD86,
		0xD8F,0xD98,0xDA1,0xDA9,0xDB2,0xDBB,0xDC3,0xDCC,0xDD4,0xDDD,0xDE5,0xDEE,0xDF6,0xDFF,0xE07,0xE10,
		0xE18,0xE20,0xE29,0xE31,0xE39,0xE41,0xE4A,0xE52,0xE5A,0xE62,0xE6A,0xE72,0xE7A,0xE82,0xE8A,0xE92,
		0xE9A,0xEA2,0xEAA,0xEB2,0xEB9,0xEC1,0xEC9,0xED1,0xED9,0xEE0,0xEE8,0xEF0,0xEF8,0xEFF,0xF07,0xF0F,
		0xF16,0xF1E,0xF25,0xF2D,0xF34,0xF3C,0xF43,0xF4B,0xF52,0xF5A,0xF61,0xF69,0xF70,0xF77,0xF7F,0xF86,
		0xF8D,0xF95,0xF9C,0xFA3,0xFAA,0xFB2,0xFB9,0xFC0,0xFC7,0xFCE,0xFD6,0xFDD,0xFE4,0xFEB,0xFF2,0xFF9,
		0xFFF,
	},
	//[12] 1035 night
	{
		0x0,0xAE,0x102,0x145,0x17F,0x1B2,0x1E2,0x20E,0x238,0x25F,0x285,0x2A9,0x2CC,0x2ED,0x30D,0x32D,
		0x34B,0x369,0x386,0x3A2,0x3BE,0x3D9,0x3F3,0x40D,0x426,0x43F,0x458,0x470,0x488,0x49F,0x4B6,0x4CD,
		0x4E4,0x4FA,0x510,0x525,0x53B,0x550,0x564,0x579,0x58D,0x5A2,0x5B6,0x5C9,0x5DD,0x5F0,0x603,0x616,
		0x629,0x63C,0x64E,0x661,0x673,0x685,0x697,0x6A8,0x6BA,0x6CB,0x6DD,0x6EE,0x6FF,0x710,0x721,0x732,
		0x742,0x753,0x763,0x773,0x783,0x794,0x7A4,0x7B3,0x7C3,0x7D3,0x7E2,0x7F2,0x801,0x811,0x820,0x82F,
		0x83E,0x84D,0x85C,0x86B,0x87A,0x888,0x897,0x8A6,0x8B4,0x8C2,0x8D1,0x8DF,0x8ED,0x8FB,0x909,0x917,
		0x925,0x933,0x941,0x94F,0x95C,0x96A,0x978,0x985,0x993,0x9A0,0x9AD,0x9BB,0x9C8,0x9D5,0x9E2,0x9EF,
		0x9FC,0xA09,0xA16,0xA23,0xA30,0xA3D,0xA49,0xA56,0xA63,0xA6F,0xA7C,0xA89,0xA95,0xAA1,0xAAE,0xABA,
		0xAC6,0xAD3,0xADF,0xAEB,0xAF7,0xB03,0xB0F,0xB1B,0xB27,0xB33,0xB3F,0xB4B,0xB57,0xB63,0xB6F,0xB7A,
		0xB86,0xB92,0xB9D,0xBA9,0xBB4,0xBC0,0xBCB,0xBD7,0xBE2,0xBEE,0xBF9,0xC04,0xC10,0xC1B,0xC26,0xC31,
		0xC3D,0xC48,0xC53,0xC5E,0xC69,0xC74,0xC7F,0xC8A,0xC95,0xCA0,0xCAB,0xCB6,0xCC0,0xCCB,0xCD6,0xCE1,
		0xCEB,0xCF6,0xD01,0xD0C,0xD16,0xD21,0xD2B,0xD36,0xD40,0xD4B,0xD55,0xD60,0xD6A,0xD75,0xD7F,0xD89,
		0xD94,0xD9E,0xDA8,0xDB3,0xDBD,0xDC7,0xDD1,0xDDB,0xDE5,0xDF0,0xDFA,0xE04,0xE0E,0xE18,0xE22,0xE2C,
		0xE36,0xE40,0xE4A,0xE54,0xE5E,0xE68,0xE71,0xE7B,0xE85,0xE8F,0xE99,0xEA2,0xEAC,0xEB6,0xEC0,0xEC9,
		0xED3,0xEDD,0xEE6,0xEF0,0xEF9,0xF03,0xF0C,0xF16,0xF20,0xF29,0xF33,0xF3C,0xF45,0xF4F,0xF58,0xF62,
		0xF6B,0xF74,0xF7E,0xF87,0xF90,0xF9A,0xFA3,0xFAC,0xFB6,0xFBF,0xFC8,0xFD1,0xFDA,0xFE4,0xFED,0xFF6,
		0xFFF,

	},
	//[13] 1045 night
	{
		0x0,0x78,0xF1,0x168,0x1D9,0x22F,0x281,0x2D0,0x31E,0x369,0x39E,0x3D1,0x403,0x434,0x465,0x495,
		0x4C4,0x4E8,0x50C,0x52F,0x552,0x574,0x596,0x5B9,0x5DC,0x600,0x619,0x633,0x64D,0x667,0x682,0x69C,
		0x6B7,0x6D1,0x6EB,0x704,0x71D,0x736,0x74D,0x766,0x77E,0x796,0x7AC,0x7C3,0x7D9,0x7EF,0x804,0x81A,
		0x82F,0x844,0x85A,0x86D,0x87F,0x891,0x8A4,0x8B6,0x8C8,0x8DA,0x8EC,0x8FE,0x910,0x921,0x932,0x943,
		0x954,0x962,0x971,0x97F,0x98D,0x99B,0x9A8,0x9B6,0x9C3,0x9D0,0x9DE,0x9EB,0x9F8,0xA05,0xA12,0xA1E,
		0xA2B,0xA38,0xA44,0xA51,0xA5D,0xA6A,0xA76,0xA82,0xA8E,0xA9A,0xAA6,0xAB2,0xABE,0xAC9,0xAD4,0xADF,
		0xAEA,0xAF5,0xAFF,0xB09,0xB13,0xB1D,0xB26,0xB30,0xB39,0xB42,0xB4B,0xB54,0xB5D,0xB66,0xB70,0xB79,
		0xB82,0xB8B,0xB95,0xB9E,0xBA7,0xBB0,0xBB9,0xBC2,0xBCB,0xBD5,0xBDE,0xBE7,0xBF0,0xBF9,0xC02,0xC0B,
		0xC14,0xC1D,0xC26,0xC2F,0xC39,0xC42,0xC4B,0xC54,0xC5D,0xC66,0xC70,0xC79,0xC82,0xC8B,0xC93,0xC9C,
		0xCA5,0xCAE,0xCB6,0xCBF,0xCC7,0xCCF,0xCD8,0xCE0,0xCE8,0xCF1,0xCF9,0xD01,0xD09,0xD11,0xD1A,0xD22,
		0xD2A,0xD32,0xD3B,0xD43,0xD4B,0xD54,0xD5C,0xD65,0xD6D,0xD75,0xD7E,0xD86,0xD8E,0xD96,0xD9E,0xDA6,
		0xDAE,0xDB6,0xDBD,0xDC5,0xDCC,0xDD4,0xDDB,0xDE2,0xDEA,0xDF1,0xDF8,0xDFF,0xE07,0xE0E,0xE15,0xE1D,
		0xE24,0xE2C,0xE33,0xE3B,0xE42,0xE4A,0xE52,0xE59,0xE61,0xE69,0xE70,0xE78,0xE80,0xE87,0xE8F,0xE96,
		0xE9E,0xEA6,0xEAD,0xEB5,0xEBC,0xEC4,0xECB,0xED3,0xEDA,0xEE2,0xEE9,0xEF1,0xEF8,0xEFF,0xF07,0xF0E,
		0xF15,0xF1C,0xF23,0xF2A,0xF31,0xF38,0xF3F,0xF45,0xF4C,0xF53,0xF5A,0xF61,0xF68,0xF6F,0xF76,0xF7D,
		0xF84,0xF8B,0xF93,0xF9A,0xFA2,0xFAA,0xFB1,0xFB9,0xFC1,0xFC9,0xFD0,0xFD8,0xFE0,0xFE8,0xFF0,0xFF7,
		0xFFF,
	
	},
	//[14] 1045 night
	{
		0x0,0x3C,0x7A,0xB9,0xF8,0x135,0x16F,0x1A6,0x1D8,0x22A,0x26E,0x2AB,0x2EB,0x318,0x346,0x374,
		0x3A1,0x3CC,0x3F6,0x423,0x44C,0x474,0x49F,0x4D1,0x4EF,0x50F,0x530,0x553,0x577,0x59B,0x5C1,0x5E7,
		0x60F,0x625,0x63C,0x654,0x66D,0x686,0x69F,0x6B8,0x6D2,0x6EC,0x705,0x71E,0x737,0x750,0x768,0x780,
		0x797,0x7AD,0x7C3,0x7D8,0x7EE,0x803,0x818,0x82C,0x841,0x855,0x869,0x87C,0x890,0x8A3,0x8B6,0x8C9,
		0x8DC,0x8EE,0x900,0x912,0x924,0x936,0x948,0x959,0x96A,0x97B,0x98B,0x99C,0x9AC,0x9BC,0x9CC,0x9DB,
		0x9EB,0x9FA,0xA08,0xA17,0xA25,0xA33,0xA41,0xA4F,0xA5C,0xA6A,0xA77,0xA84,0xA90,0xA9D,0xAA9,0xAB5,
		0xAC2,0xACD,0xAD9,0xAE4,0xAEF,0xAFA,0xB05,0xB0F,0xB19,0xB23,0xB2E,0xB38,0xB42,0xB4C,0xB55,0xB5F,
		0xB6A,0xB74,0xB7D,0xB87,0xB91,0xB9B,0xBA4,0xBAE,0xBB7,0xBC1,0xBCA,0xBD4,0xBDD,0xBE7,0xBF0,0xBFA,
		0xC04,0xC0D,0xC17,0xC20,0xC2A,0xC34,0xC3D,0xC47,0xC51,0xC5A,0xC64,0xC6E,0xC77,0xC81,0xC8A,0xC93,
		0xC9D,0xCA6,0xCAF,0xCB8,0xCC1,0xCC9,0xCD2,0xCDB,0xCE4,0xCED,0xCF5,0xCFE,0xD07,0xD0F,0xD18,0xD21,
		0xD2A,0xD32,0xD3B,0xD44,0xD4D,0xD56,0xD5F,0xD68,0xD70,0xD79,0xD82,0xD8B,0xD94,0xD9C,0xDA5,0xDAD,
		0xDB6,0xDBE,0xDC6,0xDCE,0xDD6,0xDDE,0xDE6,0xDED,0xDF5,0xDFD,0xE05,0xE0C,0xE14,0xE1C,0xE24,0xE2C,
		0xE34,0xE3C,0xE44,0xE4C,0xE54,0xE5C,0xE65,0xE6D,0xE75,0xE7E,0xE86,0xE8E,0xE96,0xE9E,0xEA6,0xEAE,
		0xEB6,0xEBD,0xEC4,0xECB,0xED3,0xEDA,0xEE1,0xEE7,0xEEE,0xEF5,0xEFC,0xF02,0xF09,0xF10,0xF17,0xF1E,
		0xF25,0xF2B,0xF32,0xF39,0xF40,0xF47,0xF4E,0xF55,0xF5C,0xF63,0xF6A,0xF71,0xF78,0xF7F,0xF86,0xF8D,
		0xF94,0xF9A,0xFA1,0xFA8,0xFAF,0xFB5,0xFBC,0xFC3,0xFC9,0xFD0,0xFD7,0xFDD,0xFE4,0xFEA,0xFF1,0xFF8,
		0xFFF,
	
	},
		//[15] 2045 daylight P3
	{

			0x0,0x10F,0x17C,0x1CF,0x216,0x253,0x28B,0x2BE,0x2ED,0x31A,0x344,0x36C,0x392,0x3B7,0x3DA,0x3FC,
			0x41D,0x43C,0x45B,0x479,0x496,0x4B3,0x4CE,0x4E9,0x504,0x51E,0x537,0x550,0x569,0x581,0x598,0x5AF,
			0x5C6,0x5DD,0x5F3,0x609,0x61E,0x633,0x648,0x65D,0x671,0x685,0x699,0x6AD,0x6C0,0x6D3,0x6E6,0x6F9,
			0x70B,0x71D,0x730,0x741,0x753,0x765,0x776,0x787,0x799,0x7AA,0x7BA,0x7CB,0x7DB,0x7EC,0x7FC,0x80C,
			0x81C,0x82C,0x83C,0x84B,0x85B,0x86A,0x879,0x888,0x897,0x8A6,0x8B5,0x8C4,0x8D2,0x8E1,0x8EF,0x8FE,
			0x90C,0x91A,0x928,0x936,0x944,0x952,0x95F,0x96D,0x97B,0x988,0x996,0x9A3,0x9B0,0x9BD,0x9CA,0x9D7,
			0x9E4,0x9F1,0x9FE,0xA0B,0xA18,0xA24,0xA31,0xA3D,0xA4A,0xA56,0xA62,0xA6F,0xA7B,0xA87,0xA93,0xA9F,
			0xAAB,0xAB7,0xAC3,0xACF,0xADA,0xAE6,0xAF2,0xAFD,0xB09,0xB14,0xB20,0xB2B,0xB37,0xB42,0xB4D,0xB59,
			0xB64,0xB6F,0xB7A,0xB85,0xB90,0xB9B,0xBA6,0xBB1,0xBBC,0xBC6,0xBD1,0xBDC,0xBE7,0xBF1,0xBFC,0xC06,
			0xC11,0xC1B,0xC26,0xC30,0xC3B,0xC45,0xC4F,0xC5A,0xC64,0xC6E,0xC78,0xC82,0xC8D,0xC97,0xCA1,0xCAB,
			0xCB5,0xCBF,0xCC8,0xCD2,0xCDC,0xCE6,0xCF0,0xCFA,0xD03,0xD0D,0xD17,0xD20,0xD2A,0xD34,0xD3D,0xD47,
			0xD50,0xD5A,0xD63,0xD6C,0xD76,0xD7F,0xD89,0xD92,0xD9B,0xDA4,0xDAE,0xDB7,0xDC0,0xDC9,0xDD2,0xDDC,
			0xDE5,0xDEE,0xDF7,0xE00,0xE09,0xE12,0xE1B,0xE24,0xE2C,0xE35,0xE3E,0xE47,0xE50,0xE59,0xE61,0xE6A,
			0xE73,0xE7C,0xE84,0xE8D,0xE96,0xE9E,0xEA7,0xEAF,0xEB8,0xEC0,0xEC9,0xED1,0xEDA,0xEE2,0xEEB,0xEF3,
			0xEFC,0xF04,0xF0C,0xF15,0xF1D,0xF25,0xF2E,0xF36,0xF3E,0xF46,0xF4F,0xF57,0xF5F,0xF67,0xF6F,0xF77,
			0xF80,0xF88,0xF90,0xF98,0xFA0,0xFA8,0xFB0,0xFB8,0xFC0,0xFC8,0xFD0,0xFD8,0xFE0,0xFE7,0xFEF,0xFF7,
			0xFFF,	
	},
	
	//[16] 2045 night light P3
	{
			0x0,0x2C,0x56,0x81,0xB2,0xEE,0x10E,0x131,0x155,0x17C,0x1A4,0x1CD,0x1F7,0x222,0x24D,0x278,
			0x2A3,0x2C0,0x2DF,0x2FE,0x31E,0x33E,0x35E,0x37F,0x39F,0x3C0,0x3E0,0x400,0x420,0x43F,0x45D,
			0x47B,0x498,0x4B3,0x4CF,0x4EA,0x504,0x51E,0x538,0x551,0x56A,0x583,0x59B,0x5B3,0x5CA,0x5E2,
			0x5F9,0x60F,0x626,0x63B,0x651,0x666,0x67A,0x68F,0x6A3,0x6B6,0x6C9,0x6DC,0x6EF,0x702,0x714,
			0x727,0x739,0x74B,0x75E,0x770,0x782,0x794,0x7A6,0x7B7,0x7C9,0x7DA,0x7EB,0x7FC,0x80D,0x81E,
			0x82E,0x83F,0x84F,0x85F,0x86F,0x87E,0x88D,0x89C,0x8AB,0x8BA,0x8C8,0x8D6,0x8E4,0x8F2,0x900,
			0x90E,0x91C,0x929,0x937,0x945,0x953,0x961,0x96E,0x97C,0x989,0x997,0x9A4,0x9B1,0x9BF,0x9CC,
			0x9D9,0x9E6,0x9F3,0xA00,0xA0D,0xA1A,0xA26,0xA33,0xA40,0xA4C,0xA59,0xA66,0xA72,0xA7F,0xA8B,
			0xA97,0xAA4,0xAB0,0xABC,0xAC8,0xAD4,0xAE0,0xAEC,0xAF8,0xB04,0xB10,0xB1C,0xB28,0xB34,0xB40,
			0xB4B,0xB57,0xB63,0xB6E,0xB7A,0xB85,0xB91,0xB9C,0xBA8,0xBB3,0xBBE,0xBCA,0xBD5,0xBE0,0xBEB,
			0xBF7,0xC02,0xC0D,0xC18,0xC23,0xC2E,0xC39,0xC44,0xC4F,0xC5A,0xC65,0xC6F,0xC7A,0xC85,0xC90,
			0xC9A,0xCA5,0xCB0,0xCBA,0xCC5,0xCCF,0xCDA,0xCE5,0xCEF,0xCF9,0xD04,0xD0E,0xD19,0xD23,0xD2D,
			0xD38,0xD42,0xD4C,0xD56,0xD61,0xD6B,0xD75,0xD7F,0xD89,0xD93,0xD9D,0xDA7,0xDB1,0xDBB,0xDC5,
			0xDCF,0xDD9,0xDE3,0xDED,0xDF7,0xE00,0xE0A,0xE14,0xE1E,0xE27,0xE31,0xE3B,0xE45,0xE4E,0xE58,
			0xE61,0xE6B,0xE75,0xE7E,0xE88,0xE91,0xE9B,0xEA4,0xEAE,0xEB7,0xEC0,0xECA,0xED3,0xEDD,0xEE6,
			0xEEF,0xEF8,0xF02,0xF0B,0xF14,0xF1D,0xF27,0xF30,0xF39,0xF42,0xF4B,0xF54,0xF5E,0xF67,0xF70,
			0xF79,0xF82,0xF8B,0xF94,0xF9D,0xFA6,0xFAF,0xFB8,0xFC1,0xFC9,0xFD2,0xFDB,0xFE4,0xFED,0xFF6,
			0xFFF,
	},
	
		//[17] PS5230-night
	{
		0x0,0xD8,0x138,0x183,0x1C3,0x1FC,0x230,0x25F,0x28C,0x2B6,0x2DE,0x304,0x328,0x34B,0x36D,0x38E,
		0x3AE,0x3CC,0x3EA,0x407,0x424,0x440,0x45B,0x475,0x48F,0x4A9,0x4C2,0x4DB,0x4F3,0x50B,0x522,0x539,
		0x550,0x566,0x57C,0x592,0x5A7,0x5BD,0x5D1,0x5E6,0x5FB,0x60F,0x623,0x636,0x64A,0x65D,0x670,0x683,
		0x696,0x6A8,0x6BB,0x6CD,0x6DF,0x6F1,0x702,0x714,0x725,0x737,0x748,0x759,0x76A,0x77A,0x78B,0x79B,
		0x7AC,0x7BC,0x7CC,0x7DC,0x7EC,0x7FB,0x80B,0x81B,0x82A,0x839,0x849,0x858,0x867,0x876,0x885,0x893,
		0x8A2,0x8B1,0x8BF,0x8CE,0x8DC,0x8EA,0x8F9,0x907,0x915,0x923,0x931,0x93E,0x94C,0x95A,0x967,0x975,
		0x982,0x990,0x99D,0x9AA,0x9B8,0x9C5,0x9D2,0x9DF,0x9EC,0x9F9,0xA06,0xA13,0xA1F,0xA2C,0xA39,0xA45,
		0xA52,0xA5E,0xA6B,0xA77,0xA83,0xA90,0xA9C,0xAA8,0xAB4,0xAC0,0xACC,0xAD8,0xAE4,0xAF0,0xAFC,0xB08,
		0xB14,0xB1F,0xB2B,0xB37,0xB42,0xB4E,0xB59,0xB65,0xB70,0xB7C,0xB87,0xB92,0xB9D,0xBA9,0xBB4,0xBBF,
		0xBCA,0xBD5,0xBE0,0xBEB,0xBF6,0xC01,0xC0C,0xC17,0xC22,0xC2D,0xC38,0xC42,0xC4D,0xC58,0xC62,0xC6D,
		0xC78,0xC82,0xC8D,0xC97,0xCA2,0xCAC,0xCB6,0xCC1,0xCCB,0xCD5,0xCE0,0xCEA,0xCF4,0xCFE,0xD09,0xD13,
		0xD1D,0xD27,0xD31,0xD3B,0xD45,0xD4F,0xD59,0xD63,0xD6D,0xD77,0xD81,0xD8B,0xD94,0xD9E,0xDA8,0xDB2,
		0xDBB,0xDC5,0xDCF,0xDD8,0xDE2,0xDEC,0xDF5,0xDFF,0xE08,0xE12,0xE1B,0xE25,0xE2E,0xE38,0xE41,0xE4A,
		0xE54,0xE5D,0xE66,0xE70,0xE79,0xE82,0xE8B,0xE95,0xE9E,0xEA7,0xEB0,0xEB9,0xEC2,0xECC,0xED5,0xEDE,
		0xEE7,0xEF0,0xEF9,0xF02,0xF0B,0xF14,0xF1D,0xF25,0xF2E,0xF37,0xF40,0xF49,0xF52,0xF5B,0xF63,0xF6C,
		0xF75,0xF7E,0xF86,0xF8F,0xF98,0xFA0,0xFA9,0xFB2,0xFBA,0xFC3,0xFCB,0xFD4,0xFDC,0xFE5,0xFEE,0xFF6,
		0xFFF,

	},
	//[18] IMX225-v200-PX
	{
		0x0,0x2C,0x56,0x81,0xB2,0xEE,0x10E,0x131,0x155,0x17C,0x1A4,0x1CD,0x1F7,0x222,0x24D,0x278,
		0x2A3,0x2C0,0x2DF,0x2FE,0x31E,0x33E,0x35E,0x37F,0x39F,0x3C0,0x3E0,0x400,0x420,0x43F,0x45D,0x47B,
		0x498,0x4B3,0x4CF,0x4EA,0x504,0x51E,0x538,0x551,0x56A,0x583,0x59B,0x5B3,0x5CA,0x5E2,0x5F9,0x60F,
		0x626,0x63B,0x651,0x666,0x67A,0x68F,0x6A3,0x6B6,0x6C9,0x6DC,0x6EF,0x702,0x714,0x727,0x739,0x74B,
		0x75E,0x770,0x782,0x794,0x7A6,0x7B7,0x7C9,0x7DA,0x7EB,0x7FC,0x80D,0x81E,0x82E,0x83F,0x84F,0x85F,
		0x86F,0x87E,0x88D,0x89C,0x8AB,0x8BA,0x8C8,0x8D6,0x8E4,0x8F2,0x900,0x90E,0x91C,0x929,0x937,0x945,
		0x953,0x961,0x96E,0x97C,0x989,0x997,0x9A4,0x9B1,0x9BF,0x9CC,0x9D9,0x9E6,0x9F3,0xA00,0xA0D,0xA1A,
		0xA26,0xA33,0xA40,0xA4C,0xA59,0xA66,0xA72,0xA7F,0xA8B,0xA97,0xAA4,0xAB0,0xABC,0xAC8,0xAD4,0xAE0,
		0xAEC,0xAF8,0xB04,0xB10,0xB1C,0xB28,0xB34,0xB40,0xB4B,0xB57,0xB63,0xB6E,0xB7A,0xB85,0xB91,0xB9C,
		0xBA8,0xBB3,0xBBE,0xBCA,0xBD5,0xBE0,0xBEB,0xBF7,0xC02,0xC0D,0xC18,0xC23,0xC2E,0xC39,0xC44,0xC4F,
		0xC5A,0xC65,0xC6F,0xC7A,0xC85,0xC90,0xC9A,0xCA5,0xCB0,0xCBA,0xCC5,0xCCF,0xCDA,0xCE5,0xCEF,0xCF9,
		0xD04,0xD0E,0xD19,0xD23,0xD2D,0xD38,0xD42,0xD4C,0xD56,0xD61,0xD6B,0xD75,0xD7F,0xD89,0xD93,0xD9D,
		0xDA7,0xDB1,0xDBB,0xDC5,0xDCF,0xDD9,0xDE3,0xDED,0xDF7,0xE00,0xE0A,0xE14,0xE1E,0xE27,0xE31,0xE3B,
		0xE45,0xE4E,0xE58,0xE61,0xE6B,0xE75,0xE7E,0xE88,0xE91,0xE9B,0xEA4,0xEAE,0xEB7,0xEC0,0xECA,0xED3,
		0xEDD,0xEE6,0xEEF,0xEF8,0xF02,0xF0B,0xF14,0xF1D,0xF27,0xF30,0xF39,0xF42,0xF4B,0xF54,0xF5E,0xF67,
		0xF70,0xF79,0xF82,0xF8B,0xF94,0xF9D,0xFA6,0xFAF,0xFB8,0xFC1,0xFC9,0xFD2,0xFDB,0xFE4,0xFED,0xFF6,
		0xFFF,
	
	},		
    //[19] sc2135
	{
		0x0,0x5D,0xBD,0x11E,0x17E,0x1DC,0x237,0x28E,0x2DE,0x328,0x36E,0x3AF,0x3ED,
		0x428,0x460,0x496,0x4CB,0x4FD,0x52A,0x555,0x57D,0x5A4,0x5CB,0x5F3,0x61C,0x646,
		0x66F,0x698,0x6C0,0x6EA,0x715,0x741,0x76F,0x787,0x7A0,0x7BA,0x7D5,0x7F0,0x80B,
		0x827,0x842,0x85E,0x879,0x894,0x8AF,0x8C9,0x8E2,0x8FB,0x912,0x928,0x93E,0x954,
		0x968,0x97C,0x990,0x9A4,0x9B7,0x9C9,0x9DC,0x9EE,0xA00,0xA13,0xA25,0xA37,0xA49,
		0xA5B,0xA6C,0xA7D,0xA8E,0xA9E,0xAAE,0xABE,0xACE,0xADF,0xAEF,0xB00,0xB11,0xB22,
		0xB34,0xB47,0xB5A,0xB69,0xB77,0xB85,0xB93,0xBA0,0xBAD,0xBBA,0xBC7,0xBD3,0xBE0,
		0xBEC,0xBF8,0xC03,0xC0F,0xC1A,0xC25,0xC30,0xC3B,0xC46,0xC50,0xC5A,0xC64,0xC6E,
		0xC78,0xC82,0xC8B,0xC95,0xC9E,0xCA7,0xCB0,0xCB9,0xCC2,0xCCA,0xCD3,0xCDB,0xCE4,
		0xCEC,0xCF4,0xCFC,0xD04,0xD0C,0xD13,0xD1B,0xD23,0xD2A,0xD32,0xD39,0xD40,0xD48,
		0xD4F,0xD56,0xD5D,0xD64,0xD6B,0xD72,0xD79,0xD7F,0xD86,0xD8D,0xD93,0xD9A,0xDA1,
		0xDA7,0xDAE,0xDB4,0xDBB,0xDC1,0xDC7,0xDCE,0xDD4,0xDDA,0xDE1,0xDE7,0xDED,0xDF3,
		0xDF9,0xE00,0xE06,0xE0C,0xE12,0xE18,0xE1E,0xE24,0xE2A,0xE30,0xE36,0xE3C,0xE42,
		0xE48,0xE4E,0xE54,0xE5A,0xE60,0xE66,0xE6C,0xE72,0xE78,0xE7E,0xE84,0xE89,0xE8F,
		0xE95,0xE9B,0xEA1,0xEA7,0xEAD,0xEB2,0xEB8,0xEBE,0xEC4,0xECA,0xECF,0xED5,0xEDB,
		0xEE1,0xEE6,0xEEC,0xEF2,0xEF7,0xEFD,0xF03,0xF08,0xF0E,0xF13,0xF19,0xF1E,0xF24,
		0xF29,0xF2F,0xF34,0xF3A,0xF3F,0xF44,0xF4A,0xF4F,0xF54,0xF59,0xF5F,0xF64,0xF69,
		0xF6E,0xF73,0xF78,0xF7D,0xF82,0xF86,0xF8B,0xF90,0xF94,0xF99,0xF9E,0xFA2,0xFA6,
		0xFAB,0xFAF,0xFB3,0xFB7,0xFBB,0xFBF,0xFC3,0xFC7,0xFCA,0xFCE,0xFD2,0xFD5,0xFD8,
		0xFDB,0xFDF,0xFE2,0xFE4,0xFE7,0xFEA,0xFEC,0xFEF,0xFF5,0xFFF,

	},
	//[20] sc1235
	{
		0x0,0x78,0xDC,0x136,0x186,0x1D6,0x21C,0x262,0x29E,0x2DA,0x312,0x34A,0x37E,0x3B0,0x3E2,0x41A,
        0x448,0x472,0x49A,0x4C2,0x4E6,0x500,0x522,0x542,0x562,0x580,0x59E,0x5BB,0x5D5,0x5EF,0x607,0x620,
        0x638,0x64F,0x666,0x67D,0x693,0x6A9,0x6BE,0x6D4,0x6E9,0x6FD,0x712,0x726,0x739,0x74D,0x760,0x773,
        0x786,0x799,0x7AB,0x7BD,0x7CF,0x7E1,0x7F2,0x804,0x815,0x826,0x836,0x847,0x858,0x868,0x878,0x888,
        0x898,0x8A8,0x8B7,0x8C7,0x8D6,0x8E5,0x8F4,0x903,0x912,0x921,0x92F,0x93E,0x94C,0x95A,0x968,0x976,
        0x984,0x992,0x9A0,0x9AD,0x9BB,0x9C8,0x9D6,0x9E3,0x9F0,0x9FD,0xA0A,0xA17,0xA24,0xA31,0xA3D,0xA4A,
        0xA56,0xA63,0xA6F,0xA7B,0xA88,0xA94,0xAA0,0xAAC,0xAB8,0xAC4,0xACF,0xADB,0xAE7,0xAF2,0xAFE,0xB09,
        0xB15,0xB20,0xB2B,0xB37,0xB42,0xB4D,0xB58,0xB63,0xB6E,0xB79,0xB84,0xB8F,0xB99,0xBA4,0xBAF,0xBB9,
        0xBC4,0xBCF,0xBD9,0xBE3,0xBEE,0xBF8,0xC02,0xC0D,0xC17,0xC21,0xC2B,0xC35,0xC3F,0xC49,0xC53,0xC5D,
        0xC67,0xC71,0xC7A,0xC84,0xC8E,0xC98,0xCA1,0xCAB,0xCB4,0xCBE,0xCC7,0xCD1,0xCDA,0xCE4,0xCED,0xCF6,
        0xCFF,0xD09,0xD12,0xD1B,0xD24,0xD2D,0xD36,0xD3F,0xD48,0xD51,0xD5A,0xD63,0xD6C,0xD75,0xD7E,0xD87,
        0xD8F,0xD98,0xDA1,0xDAA,0xDB2,0xDBB,0xDC3,0xDCC,0xDD4,0xDDD,0xDE5,0xDEE,0xDF6,0xDFF,0xE07,0xE10,
        0xE18,0xE20,0xE28,0xE31,0xE39,0xE41,0xE49,0xE51,0xE5A,0xE62,0xE6A,0xE72,0xE7A,0xE82,0xE8A,0xE92,
        0xE9A,0xEA2,0xEAA,0xEB2,0xEB9,0xEC1,0xEC9,0xED1,0xED9,0xEE0,0xEE8,0xEF0,0xEF8,0xEFF,0xF07,0xF0F,
        0xF16,0xF1E,0xF25,0xF2D,0xF34,0xF3C,0xF43,0xF4B,0xF52,0xF5A,0xF61,0xF69,0xF70,0xF77,0xF7F,0xF86,
        0xF8D,0xF95,0xF9C,0xFA3,0xFAA,0xFB2,0xFB9,0xFC0,0xFC7,0xFCE,0xFD6,0xFDD,0xFE4,0xFEB,0xFF2,0xFF9,
        0xFFF,
	},
	//[21] imx291
	{
		0x0,0x49,0x92,0xDB,0x125,0x16E,0x1B8,0x203,0x23D,0x277,0x2B0,0x2EA,0x325,0x363,0x39D,0x3DA,
		0x41F,0x447,0x472,0x4A0,0x4CF,0x4FE,0x52D,0x55B,0x587,0x5B2,0x5DC,0x606,0x62F,0x657,0x67F,0x6A5,
		0x6C9,0x6EB,0x70B,0x729,0x746,0x763,0x781,0x7A0,0x7C1,0x7D9,0x7F1,0x80B,0x825,0x83F,0x85A,0x875,
		0x88F,0x8A9,0x8C2,0x8DA,0x8F1,0x907,0x91B,0x92F,0x942,0x955,0x967,0x979,0x98B,0x99D,0x9B0,0x9C3,
		0x9D7,0x9E7,0x9F6,0xA07,0xA17,0xA28,0xA39,0xA4A,0xA5B,0xA6C,0xA7C,0xA8D,0xA9E,0xAAE,0xABE,0xACD,
		0xADC,0xAEB,0xAF9,0xB07,0xB15,0xB23,0xB31,0xB3E,0xB4B,0xB58,0xB65,0xB72,0xB7F,0xB8B,0xB97,0xBA3,
		0xBAF,0xBBB,0xBC6,0xBD1,0xBDD,0xBE7,0xBF2,0xBFD,0xC07,0xC11,0xC1C,0xC26,0xC2F,0xC39,0xC43,0xC4C,
		0xC56,0xC5F,0xC69,0xC72,0xC7B,0xC83,0xC8C,0xC94,0xC9D,0xCA5,0xCAD,0xCB6,0xCBE,0xCC6,0xCCE,0xCD7,
		0xCDF,0xCE7,0xCF0,0xCF8,0xD00,0xD09,0xD11,0xD19,0xD22,0xD2A,0xD32,0xD3A,0xD42,0xD4A,0xD52,0xD59,
		0xD61,0xD69,0xD70,0xD77,0xD7F,0xD86,0xD8D,0xD94,0xD9B,0xDA2,0xDA9,0xDB0,0xDB6,0xDBD,0xDC4,0xDCA,
		0xDD1,0xDD8,0xDDE,0xDE4,0xDEB,0xDF1,0xDF7,0xDFD,0xE03,0xE09,0xE0F,0xE15,0xE1C,0xE22,0xE28,0xE2E,
		0xE34,0xE3A,0xE40,0xE46,0xE4D,0xE53,0xE59,0xE5F,0xE65,0xE6B,0xE71,0xE78,0xE7E,0xE84,0xE8A,0xE91,
		0xE97,0xE9D,0xEA4,0xEAB,0xEB1,0xEB8,0xEBF,0xEC5,0xECC,0xED3,0xED9,0xEE0,0xEE7,0xEED,0xEF4,0xEFA,
		0xF00,0xF06,0xF0C,0xF12,0xF18,0xF1E,0xF23,0xF29,0xF2F,0xF34,0xF3A,0xF3F,0xF45,0xF4A,0xF4F,0xF55,
		0xF5A,0xF5F,0xF64,0xF69,0xF6E,0xF73,0xF78,0xF7C,0xF81,0xF86,0xF8B,0xF8F,0xF94,0xF99,0xF9E,0xFA3,
		0xFA8,0xFAD,0xFB2,0xFB8,0xFBD,0xFC3,0xFC8,0xFCD,0xFD3,0xFD8,0xFDE,0xFE4,0xFE9,0xFEF,0xFF4,0xFFA,
		0xFFF,
	},

};

static combo_dev_attr_t MIPI_CMOS3V3_ATTR =
{
    /* input mode */
    .input_mode = INPUT_MODE_CMOS_33V,
    {
        
    }
};

static combo_dev_attr_t MIPI_CMOS1V8_ATTR =
{
    /* input mode */
    .input_mode = INPUT_MODE_CMOS_18V,
    {
        
    }
};

static combo_dev_attr_t MIPI_CMOSPS5270_ATTR =
{
    /* input mode */
    .input_mode = INPUT_MODE_MIPI,
    {
        .mipi_attr =
        {
            RAW_DATA_14BIT,
            {0, 1, -1, -1, -1, -1, -1, -1}
        }
    }
};

static combo_dev_attr_t HISPI_4lane_SENSOR_AR0230_12BIT_ATTR = 
{
    /* input mode */
    .input_mode = INPUT_MODE_HISPI,
    {
        .lvds_attr = 
        {
            .img_size = {1920, 1080},
            HI_WDR_MODE_NONE,
            LVDS_SYNC_MODE_SOL,
            RAW_DATA_12BIT,
            LVDS_ENDIAN_LITTLE,
            LVDS_ENDIAN_LITTLE,
            .lane_id = {0, 1, 2, 3, -1, -1, -1, -1},
            .sync_code = 
            { 
                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},
                
                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},

                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},
                
                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},
                
                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},
                    
                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},

                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}},
                
                {{0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}, 
                {0x003, 0x007, 0x001, 0x005}} 
            }
        }
    }
};

static combo_dev_attr_t LVDS_4lane_IMX291_12BIT_ATTR = 
{
    /* input mode */
    .input_mode = INPUT_MODE_SUBLVDS,
    {
        .lvds_attr = 
        {   
        	.img_size = {1920, 1080},
            HI_WDR_MODE_NONE,
            LVDS_SYNC_MODE_SAV,
            RAW_DATA_12BIT,
            LVDS_ENDIAN_BIG,
            LVDS_ENDIAN_BIG,
            .lane_id = {3, 1, 0, 2, -1, -1, -1, -1},
			.sync_code = 
		   { 
			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},
			   
			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},

			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},
			   
			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},
			   
			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},
				   
			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},

			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},
			   
			   {{0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}, 
			   {0xab0,0xb60,0x800,0x9d0}},

		   }

        }
    }
};



#include "hi_i2c.h"
static int HI_SDK_ISP_set_isp_sensor_value(void);

static int _hi_sdk_isp_set_slow_framerate(uint8_t bValue);//Declaration


int HI_SDK_ISP_set_wdr_mode_ini(uint8_t mode);

static inline int
SYSTEM(const char *fmt, ...)
{
	char command[4 * 1024];
	int ret = 0;
	va_list var;

	va_start(var, fmt);
	vsnprintf(command, sizeof(command), fmt, var);
	va_end(var);

	return system(command);
}

static HI_S32 hi_isp_SetMipiAttr()
{
    HI_S32 fd;
    combo_dev_attr_t *pstcomboDevAttr;

    /* mipi reset unrest */
    fd = open("/dev/hi_mipi", O_RDWR);
    if (fd < 0)
    {
        printf("warning: open hi_mipi dev failed\n");
        return -1;
    }

	if (_isp_attr.sensor_type == SENSOR_MODEL_APTINA_AR0130)
	 {
			 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	 }
	if (_isp_attr.sensor_type == SENSOR_MODEL_APTINA_AR0230)
	 {
			 pstcomboDevAttr = &HISPI_4lane_SENSOR_AR0230_12BIT_ATTR;
	 }
	
	if (_isp_attr.sensor_type == SENSOR_MODEL_SONY_IMX122)
	 {
			 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	 }
	
	if (_isp_attr.sensor_type == SENSOR_MODEL_SMARTSENS_SC2035 || _isp_attr.sensor_type == SENSOR_MODEL_SC2135 || _isp_attr.sensor_type == SENSOR_MODEL_SC2235 ||  _isp_attr.sensor_type == SENSOR_MODEL_SC2232)
	 {
			 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	 }
	if (_isp_attr.sensor_type == SENSOR_MODEL_APTINA_AR0237)
	 {
			 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	 }
	if (_isp_attr.sensor_type == SENSOR_MODEL_SMARTSENS_SC2045)
	 {
			 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	 }
	if (_isp_attr.sensor_type == SENSOR_MODEL_SC1035)
	{
			pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	}
	if (_isp_attr.sensor_type == SENSOR_MODEL_SC1045)
	{
			pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	}
	if (_isp_attr.sensor_type == SENSOR_MODEL_SC1135 || _isp_attr.sensor_type == SENSOR_MODEL_SC1235)
	{
		 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	}
	if (_isp_attr.sensor_type == SENSOR_MODEL_SC1145 || _isp_attr.sensor_type == SENSOR_MODEL_SC3035 )
	{
		pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	}
	if (_isp_attr.sensor_type == SENSOR_MODEL_PS5230)
	{
			pstcomboDevAttr = &MIPI_CMOS1V8_ATTR;
	}
	if (_isp_attr.sensor_type == SENSOR_MODEL_IMX225)
	 {
			 pstcomboDevAttr = &MIPI_CMOS3V3_ATTR;
	 }
	if (_isp_attr.sensor_type == SENSOR_MODEL_PS5270 )
	{
			pstcomboDevAttr = &MIPI_CMOSPS5270_ATTR;
	}
    if (_isp_attr.sensor_type == SENSOR_MODEL_IMX291)
    {
        pstcomboDevAttr = &LVDS_4lane_IMX291_12BIT_ATTR;
    }
    if (ioctl(fd, HI_MIPI_SET_DEV_ATTR, pstcomboDevAttr))
    {
        printf("set mipi attr failed\n");
        close(fd);
        return -1;
    }
    close(fd);

    return HI_SUCCESS;
}




static uint32_t isp_gpio_get_dir_addr(int gpio_group)
{
	uint32_t ret_val;
	ret_val = GPIO_BASE_ADDR + gpio_group*0x10000 + 0x400;
	return ret_val;
}

static uint32_t isp_gpio_get_data_addr(int gpio_group)
{
	uint32_t ret_val;
	ret_val = GPIO_BASE_ADDR + gpio_group*0x10000 + 0x3fc;
	return ret_val;
}

//remove warning
/*static uint32_t isp_gpio_pin_read(int gpio_group, int gpio_pin)
{
	uint32_t reg_val = 0;

	//pin dir :in
	sdk_sys->read_reg(isp_gpio_get_dir_addr(gpio_group), &reg_val);
	reg_val &= ~(1<<gpio_pin);
	sdk_sys->write_reg(isp_gpio_get_dir_addr(gpio_group), reg_val);

	//read pin
	sdk_sys->read_reg(isp_gpio_get_data_addr(gpio_group), &reg_val);
	reg_val &= (1<<gpio_pin);
	return reg_val;
}*/

static void isp_gpio_pin_write(int gpio_group, int gpio_pin, uint8_t val)
{
	uint32_t reg_val = 0;
	
	//pin dir :out
	sdk_sys->read_reg(isp_gpio_get_dir_addr(gpio_group), &reg_val);
	reg_val |= (1<<gpio_pin);
	sdk_sys->write_reg(isp_gpio_get_dir_addr(gpio_group), reg_val);
	
	sdk_sys->read_reg(isp_gpio_get_data_addr(gpio_group), &reg_val);
	reg_val &= ~(1<<gpio_pin);
	reg_val |= (val<<gpio_pin);
	sdk_sys->write_reg(isp_gpio_get_data_addr(gpio_group), reg_val);
}

static void isp_ircut_switch(uint8_t bEnable)//0:daytime   1:night
{
	static uint32_t old_saturation = 0;
	ISP_WB_INFO_S pstWBInfo;
	ISP_SATURATION_ATTR_S pstSatAttr;
	ISP_WB_ATTR_S pstWBAttr;	
	if(!old_saturation){
			SOC_CHECK(HI_MPI_ISP_QueryWBInfo(0,&pstWBInfo));//	pstWBInfo.u16Saturation
			printf("old saturation =%d \n",pstWBInfo.u16Saturation);
//			old_saturation = pstWBInfo.u16Saturation;
			
		
		}
	if(!bEnable){
		printf("daylight mode!\r\n");	

		SOC_CHECK(HI_MPI_ISP_GetSaturationAttr(0,&pstSatAttr));
		pstSatAttr.enOpType = OP_TYPE_AUTO;		
		SOC_CHECK(HI_MPI_ISP_SetSaturationAttr(0,&pstSatAttr));

		SOC_CHECK(HI_MPI_ISP_GetWBAttr(0, &pstWBAttr));
		pstWBAttr.enOpType = OP_TYPE_AUTO;
		SOC_CHECK(HI_MPI_ISP_SetWBAttr(0, &pstWBAttr));		
		//isp_gpio_pin_write(IRCUT_LED_GPIO_GROUP, IRCUT_LED_GPIO_PIN, 0);//IR LED off
		//isp_gpio_pin_write(IRCUT_CTRL_GPIO_GROUP, IRCUT_CTRL_GPIO_PIN, 0);//IR-CUT off
		//isp_gpio_pin_write(NEW_IRCUT_CTRL_GPIO_GROUP, NEW_IRCUT_CTRL_GPIO_PIN, 1);	

		_isp_attr.bsp_api.BSP_SET_IR_LED(false);
		_isp_attr.bsp_api.BSP_IRCUT_SWITCH(ISP_GPIO_DAYLIGHT);
		_isp_attr.gpio_status_old = ISP_GPIO_DAYLIGHT;
		//usleep(1000*150);

		
		SOC_CHECK(HI_MPI_ISP_QueryWBInfo(0,&pstWBInfo));				
	    printf("new saturation =%d \r\n",pstWBInfo.u16Saturation);

		//isp_ircut_control_daylight();
		
		if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_ALLDAY){
			_hi_sdk_isp_set_slow_framerate(true);
		}else{			
			_hi_sdk_isp_set_slow_framerate(false);
		}
		
	}else{			
		printf("night mode!\r\n");
		SOC_CHECK(HI_MPI_ISP_GetSaturationAttr(0,&pstSatAttr));
		pstSatAttr.enOpType = OP_TYPE_MANUAL;
     	pstSatAttr.stManual.u8Saturation = 0;

		SOC_CHECK(HI_MPI_ISP_SetSaturationAttr(0,&pstSatAttr));

		SOC_CHECK(HI_MPI_ISP_GetWBAttr(0, &pstWBAttr));
		pstWBAttr.enOpType = OP_TYPE_MANUAL;
		SOC_CHECK(HI_MPI_ISP_SetWBAttr(0, &pstWBAttr));

		//isp_gpio_pin_write(IRCUT_LED_GPIO_GROUP, IRCUT_LED_GPIO_PIN, 1);//IR LED on
		//isp_gpio_pin_write(IRCUT_CTRL_GPIO_GROUP, IRCUT_CTRL_GPIO_PIN, 1);//IR-CUT on
		//isp_gpio_pin_write(NEW_IRCUT_CTRL_GPIO_GROUP, NEW_IRCUT_CTRL_GPIO_PIN, 0);
		if(_isp_attr.ircut_control_mode != ISP_IRCUT_CONTROL_MODE_HARDWARE){
			_isp_attr.bsp_api.BSP_SET_IR_LED(true);
		}
		_isp_attr.bsp_api.BSP_IRCUT_SWITCH(ISP_GPIO_NIGHT);
		_isp_attr.gpio_status_old = ISP_GPIO_NIGHT;
		//usleep(1000*150);

		SOC_CHECK(HI_MPI_ISP_QueryWBInfo(0,&pstWBInfo));				
	    printf("new saturation =%d \r\n",pstWBInfo.u16Saturation);
		
		//isp_ircut_control_night();
		if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_CLOSE){
			_hi_sdk_isp_set_slow_framerate(false);
		}else{
			_hi_sdk_isp_set_slow_framerate(true);
		}

	}
	HI_SDK_ISP_set_isp_sensor_value();

	if(_isp_attr.ispCfgAttr){
		HI_ISP_cfg_set_all(_isp_attr.gpio_status_old, 1, _isp_attr.ispCfgAttr);
	}
}

static void isp_white_light_switch(uint8_t bEnable)
{
	if(bEnable){
		_isp_attr.bsp_api.BSP_SET_WHITE_LIGHT_LED(true);       
	}else{
		_isp_attr.bsp_api.BSP_SET_WHITE_LIGHT_LED(false);
	}
}

static void isp_smartmode_isp_switch(uint8_t bEnable)
{
	ISP_SATURATION_ATTR_S pstSatAttr;
	ISP_WB_ATTR_S pstWBAttr;
	SOC_CHECK(HI_MPI_ISP_GetSaturationAttr(0,&pstSatAttr));
	SOC_CHECK(HI_MPI_ISP_GetWBAttr(0, &pstWBAttr));
	if(bEnable){
		//printf("[WHITELIGHT]daylight mode!\r\n");
		pstSatAttr.enOpType = OP_TYPE_AUTO;
		SOC_CHECK(HI_MPI_ISP_SetSaturationAttr(0,&pstSatAttr)); 
		pstWBAttr.enOpType = OP_TYPE_AUTO;
		SOC_CHECK(HI_MPI_ISP_SetWBAttr(0, &pstWBAttr));

		_isp_attr.bsp_api.BSP_IRCUT_SWITCH(ISP_GPIO_DAYLIGHT);
		_isp_attr.gpio_status_old = ISP_GPIO_DAYLIGHT;

		if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_ALLDAY){
			_hi_sdk_isp_set_slow_framerate(true);
		}else{          
			_hi_sdk_isp_set_slow_framerate(false);
		}

	}else{          
		//printf("[WHITELIGHT]night mode!\r\n");
		pstSatAttr.enOpType = OP_TYPE_MANUAL;
		pstSatAttr.stManual.u8Saturation = 0;
		SOC_CHECK(HI_MPI_ISP_SetSaturationAttr(0,&pstSatAttr));
		pstWBAttr.enOpType = OP_TYPE_MANUAL;
		SOC_CHECK(HI_MPI_ISP_SetWBAttr(0, &pstWBAttr));

		_isp_attr.bsp_api.BSP_IRCUT_SWITCH(ISP_GPIO_NIGHT);
		_isp_attr.gpio_status_old = ISP_GPIO_NIGHT;

		if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_CLOSE){
			_hi_sdk_isp_set_slow_framerate(false);
		}else{
			_hi_sdk_isp_set_slow_framerate(true);
		}
	}

	HI_SDK_ISP_set_isp_sensor_value();
	if(_isp_attr.ispCfgAttr){
		HI_ISP_cfg_set_all(_isp_attr.gpio_status_old, 1, _isp_attr.ispCfgAttr);
	}
}

static uint32_t gains_calculate(void)
{
	uint32_t ret_iso = 1;

	ISP_DEV IspDev = 0;
    ISP_EXP_INFO_S stExpInfo ;	
 	SOC_CHECK(HI_MPI_ISP_QueryExposureInfo(IspDev,&stExpInfo));
//	ret_iso = (stExpInfo.u32AGain* ((stExpInfo.u32DGain* (stExpInfo.u32ISPDGain>> 10))>>4))>>6;
	ret_iso = (uint32_t)((unsigned long long)stExpInfo.u32AGain* (unsigned long long)stExpInfo.u32DGain* (unsigned long long)stExpInfo.u32ISPDGain >> 20);

	return ret_iso;
}

static uint32_t isp_get_iso()
{
	ISP_DEV IspDev = 0;
    ISP_EXP_INFO_S stExpInfo ;
 	SOC_CHECK(HI_MPI_ISP_QueryExposureInfo(IspDev,&stExpInfo));
	return stExpInfo.u32AGain*stExpInfo.u32DGain*100;

}

static uint8_t sdk_isp_calculate_exposure(uint32_t old_state)
{

	uint8_t ret_val = 0;
	//HI_U32 switch_area[2] = {0x20fa, 0x2544}; 
	HI_U32 switch_area[2] = {0x2844, 0x67};

	ISP_DEV IspDev = 0;
    ISP_EXP_INFO_S stExpInfo ;		
 	SOC_CHECK(HI_MPI_ISP_QueryExposureInfo(IspDev,&stExpInfo));
	//u32Exposure[0x400,0xFFFFFFF];
	
	printf("aveLum = 0x%04x/%02x\r\n",stExpInfo.u32Exposure, stExpInfo.u8AveLum);
	if(!old_state){
		if(stExpInfo.u32Exposure > switch_area[0]){
			ret_val = 1;
		}else{
			ret_val = 0;
		}
		if(stExpInfo.u32Exposure < switch_area[1]){
			ret_val = 0;
		}else{
			ret_val = 1;
		}
	}

	printf("old_state:%d/%d\r\n", old_state, ret_val);
	

	return ret_val;//0:daytime 1:night
}

static int isp_get_isp_strength_value(lpHiIspStrength val)
{
	int ret_val = 0;
	switch(_isp_attr.gpio_status_old){
		default:
		case ISP_GPIO_DAYLIGHT:
		{
			ret_val = val->daylight_val + val->daylight_val*(val->strength - 3)/2;
		}
		break;
		case ISP_GPIO_NIGHT:
		{
			ret_val = val->night_val + val->night_val*(val->strength - 3)/2;
		}
		break;
	}
	if(ret_val> 255){
		ret_val = 255;
	}
	if(ret_val < 0){
		ret_val = 0;
	}
	return ret_val;
}

//remove warning
/*static int isp_get_denoise3d_global_strength_value(lpHiIspStrength val)
{
	int ret_val = 0;
	switch(_isp_attr.gpio_status_old){
		default:
		case ISP_GPIO_DAYLIGHT:
		{
			ret_val = val->daylight_val + val->daylight_val*(val->strength - 3)/2;
		}
		break;
		case ISP_GPIO_NIGHT:
		{
			ret_val = val->night_val + val->night_val*(val->strength - 3)/2;
		}
		break;
	}
	if(ret_val> 1408){
		ret_val = 1408;
	}
	if(ret_val < 0){
		ret_val = 0;
	}

	return ret_val;
}*/

static int isp_get_3DNR_YPK_strength_value(lpHiIspStrength val)
{
	int ret_val = 0;
	switch(_isp_attr.gpio_status_old){
		default:
		case ISP_GPIO_DAYLIGHT:
		{
			ret_val = val->daylight_val + val->daylight_val*(val->strength - 3)/2;
		}
		break;
		case ISP_GPIO_NIGHT:
		{
			ret_val = val->night_val + val->night_val*(val->strength - 3)/2;
		}
		break;
	}
	if(ret_val> 63){
		ret_val = 63;
	}
	if(ret_val < 0){
		ret_val = 0;
	}
	return ret_val;
}

static int isp_get_3DNR_YSF_strength_value(lpHiIspStrength val)
{
	int ret_val = 0;
	switch(_isp_attr.gpio_status_old){
		default:
		case ISP_GPIO_DAYLIGHT:
		{
			ret_val = val->daylight_val + val->daylight_val*(val->strength - 3)/2;
		}
		break;
		case ISP_GPIO_NIGHT:
		{
			ret_val = val->night_val + val->night_val*(val->strength - 3)/2;
		}
		break;
	}
	if(ret_val> 200){
		ret_val = 200;
	}
	if(ret_val < 0){
		ret_val = 0;
	}
	return ret_val;
}

static int isp_get_3DNR_YTF_strength_value(lpHiIspStrength val)
{
	int ret_val = 0;
	switch(_isp_attr.gpio_status_old){
		default:
		case ISP_GPIO_DAYLIGHT:
		{
			ret_val = val->daylight_val + val->daylight_val*(val->strength - 3)/2;
		}
		break;
		case ISP_GPIO_NIGHT:
		{
			ret_val = val->night_val + val->night_val*(val->strength - 3)/2;
		}
		break;
	}
	if(ret_val> 128){
		ret_val = 128;
	}
	if(ret_val < 0){
		ret_val = 0;
	}
	return ret_val;
}


int HI_SDK_ISP_sensor_flicker(uint8_t bEnable, uint8_t frequency, uint8_t mode)
{	
	ISP_EXPOSURE_ATTR_S pstExpAttr;	
	ISP_DEV IspDev = 0;
	SOC_CHECK(HI_MPI_ISP_GetExposureAttr(IspDev,&pstExpAttr));
	if(bEnable != 0xff){
		pstExpAttr.stAuto.stAntiflicker.bEnable = bEnable;
	}else{
		//printf("pstAntiflicker.bEnable = %d\r\n", pstExpAttr.stAuto.stAntiflicker.bEnable);
		pstExpAttr.stAuto.stAntiflicker.bEnable = HI_TRUE;
	}
	pstExpAttr.stAuto.stAntiflicker.bEnable = HI_FALSE;//HI_TRUE;
	
	if(frequency){
		pstExpAttr.stAuto.stAntiflicker.u8Frequency = frequency;
		_isp_attr.filter_frequency = frequency;
		if(_isp_attr.ispCfgAttr){			
			_isp_attr.ispCfgAttr->impCfgAttr.flick_frequency = _isp_attr.filter_frequency;
		}
	}else{
		pstExpAttr.stAuto.stAntiflicker.u8Frequency = _isp_attr.filter_frequency;
	}
	//printf("%s---%d:%d\r\n", __FUNCTION__, frequency, bEnable);
	pstExpAttr.stAuto.stAntiflicker.enMode = mode ? ISP_ANTIFLICKER_AUTO_MODE:ISP_ANTIFLICKER_NORMAL_MODE;
	SOC_CHECK(HI_MPI_ISP_SetExposureAttr(IspDev,&pstExpAttr));
	//printf("%s-%d:%d/%d\r\n", __FUNCTION__, __LINE__, pstExpAttr.stAuto.stAntiflicker.bEnable,pstExpAttr.stAuto.stAntiflicker.u8Frequency);
	return 0;

}

emSENSOR_MODEL HI_SDK_ISP_sensor_check()
{
	//save file for sensor check in case of saving time for checking sensor
	FILE* fd = NULL;
	char sensor_type[4] = {0};
	char cmd[32];
	fd = fopen(SENSOR_TYPE_FILE, "rb");

	if(fd){
		fread(sensor_type, sizeof(sensor_type), 1, fd);
		_isp_attr.sensor_type = atoi(sensor_type);
		fclose(fd);
		if(_isp_attr.sensor_type < SENSOR_MODEL_CNT){
			printf("get sensor type from file:%d\n", _isp_attr.sensor_type);
			goto reset_sensor;
		}
	}else{
		//need to check sensor by I2C
	}

	do{   
		if(SENSOR_IMX225_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_IMX225;
            break;
        }
		if(SENSOR_PS5270_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_PS5270;
			break;
		}
        if(SENSOR_PS5230_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_PS5230;
            break;
        }
		if(SENSOR_AR0130_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_APTINA_AR0130;
            break;
        }
        if(SENSOR_AR0237_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_APTINA_AR0237;
            break;
        }
		if(SENSOR_IMX291_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_IMX291;
            break;
        }
		if(SENSOR_SC2135_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_SC2135;
            break;
        }
        if(SENSOR_SC1135_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_SC1135;
            break;
        }
		if(SENSOR_SC1145_probe()){
			_isp_attr.sensor_type = SENSOR_MODEL_SC1145;
			break;
		}
		if(SENSOR_SC1235_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_SC1235;
            break;
        }		
		if(SENSOR_SC2235_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_SC2235;
            break;
        }
		if(SENSOR_SC3035_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_SC3035;
			break;
		}
		if(SENSOR_SC2045_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_SMARTSENS_SC2045;
			break;
		}
		if(SENSOR_SC2035_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_SMARTSENS_SC2035;
			break;
		}
		if(SENSOR_AR0230_probe()){
            _isp_attr.sensor_type = SENSOR_MODEL_APTINA_AR0230;
            break;
        }
		if(SENSOR_SC1045_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_SC1045;
            break;
        }
		if(SENSOR_SC1035_probe()){
            _isp_attr.sensor_type =SENSOR_MODEL_SC1035;
            break;
        }
		if(SENSOR_SC2232_probe()){
			_isp_attr.sensor_type = SENSOR_MODEL_SC2232;
			break;

		}

	}while(0);
	printf("%s-%d--%d\n", __FUNCTION__, __LINE__, _isp_attr.sensor_type);
	//set a file for for sensor check in case of saving time for checking sensor
	snprintf(cmd, sizeof(cmd), "echo %d > %s", _isp_attr.sensor_type, SENSOR_TYPE_FILE);
	system(cmd);

reset_sensor:
	isp_gpio_pin_write(0, 5, 1); //reset sensor  GPIO0_5
	usleep(2000);
	isp_gpio_pin_write(0, 5, 0); //reset sensor 
	usleep(2000);
	isp_gpio_pin_write(0, 5, 1); //reset sensor 
	usleep(2000);

	//init mipi interface
	hi_isp_SetMipiAttr();

	return _isp_attr.sensor_type;
}

static stSwitchIrcutInfo ircut_state_info;

static void isp_ircut_contrl_init()
{	
	stIspIrcutSwitch isp_ircut_control={
		.isp_ircut_switch = isp_ircut_switch,
		.isp_white_light_switch	= isp_white_light_switch,
		.isp_smartmode_isp_switch = isp_smartmode_isp_switch,
	};
	sdk_isp_ircut_switch_init(isp_ircut_control);


	int i;

	if(_isp_attr.ispCfgAttr){
		memcpy(ircut_state_info.IrcutColorTemp,_isp_attr.ispCfgAttr->impCfgAttr.IrcutColorTemp,sizeof(ircut_state_info.IrcutColorTemp));
		memcpy(ircut_state_info.IrcutDayToNight,_isp_attr.ispCfgAttr->impCfgAttr.IrcutDayToNight,sizeof(ircut_state_info.IrcutDayToNight));
		memcpy(ircut_state_info.IrcutNightToDay,_isp_attr.ispCfgAttr->impCfgAttr.IrcutNightToDay,sizeof(ircut_state_info.IrcutNightToDay));
		memcpy(ircut_state_info.IrcutRDG,_isp_attr.ispCfgAttr->impCfgAttr.IrcutRDG,sizeof(ircut_state_info.IrcutRDG));
		memcpy(ircut_state_info.IrcutBDG,_isp_attr.ispCfgAttr->impCfgAttr.IrcutBDG,sizeof(ircut_state_info.IrcutBDG));
		ircut_state_info.night_to_day_factor = ircut_state_info.IrcutNightToDay[IRCUT_DEFAULT_SCENE];

	}else{
		ircut_state_info.IrcutDayToNight[IRCUT_D2N_GAIN_JUDGE] = 30;
		ircut_state_info.IrcutDayToNight[IRCUT_D2N_LUM_JUDGE] = 0;
		ircut_state_info.IrcutColorTemp[0] = 2650; 
		ircut_state_info.IrcutColorTemp[1] = 3680;
		ircut_state_info.IrcutNightToDay[IRCUT_DEFAULT_SCENE] = 6;
		ircut_state_info.IrcutRDG[IRCUT_DEFAULT_SCENE] = 0.936;
		ircut_state_info.IrcutBDG[IRCUT_DEFAULT_SCENE] = 0.908;

		ircut_state_info.IrcutNightToDay[IRCUT_OVER_EXPOSE_SCENE] = 2;
		ircut_state_info.IrcutRDG[IRCUT_OVER_EXPOSE_SCENE] = 0.968;
		ircut_state_info.IrcutBDG[IRCUT_OVER_EXPOSE_SCENE] = 0.965;

		ircut_state_info.IrcutNightToDay[IRCUT_LOW_COLORTEMP_SCENE] = 4;
		ircut_state_info.IrcutRDG[IRCUT_LOW_COLORTEMP_SCENE] = 0.980;
		ircut_state_info.IrcutBDG[IRCUT_LOW_COLORTEMP_SCENE] = 0.960;

		ircut_state_info.IrcutNightToDay[IRCUT_MID_COLORTEMP_SCENE] = 4;
		ircut_state_info.IrcutRDG[IRCUT_MID_COLORTEMP_SCENE] = 0.960;
		ircut_state_info.IrcutBDG[IRCUT_MID_COLORTEMP_SCENE] = 0.890;

		ircut_state_info.IrcutNightToDay[IRCUT_HIGH_COLORTEMP_SCENE] = 5;
		ircut_state_info.IrcutRDG[IRCUT_HIGH_COLORTEMP_SCENE] = 0.970;
		ircut_state_info.IrcutBDG[IRCUT_HIGH_COLORTEMP_SCENE] = 0.913;

		ircut_state_info.night_to_day_factor = ircut_state_info.IrcutNightToDay[IRCUT_DEFAULT_SCENE];

	}


	ircut_state_info.daynight_mode_state = _isp_attr.gpio_status_old;
	ircut_state_info.pre_daynight_mode_state = _isp_attr.gpio_status_old;
	
	ircut_state_info.night_stable_cnt = 0;
	ircut_state_info.day_stable_cnt = 0;
	ircut_state_info.detect_to_day_cnt  = 0;
	ircut_state_info.detect_to_night_cnt = 0;

	ircut_state_info.md_alarm_state  = false;
	ircut_state_info.md_alarm_switch = false;
	ircut_state_info.md_alarm_lock	 = false;
	ircut_state_info.md_alarm_open_light = false;
	ircut_state_info.md_alarm_stop = false;

}

static void* isp_md_alarm_cal(void* param)
{
	uint32_t alarm_keep_count = 0;
	pthread_detach(pthread_self());
	while(_isp_attr.md_alarm_thread_trigger){
		isp_md_alarm_delay_cal(&ircut_state_info, &alarm_keep_count, _isp_attr.md_lock);
		usleep(10000);
	}
	pthread_exit(0);
}

int HI_SDK_ISP_ircut_auto_switch(int vin, uint8_t type)//1:software   0: hardware 
{	
	if(type != ISP_IRCUT_CONTROL_MODE_HARDWARE && type != ISP_IRCUT_CONTROL_MODE_SOFTWARE)
	{
		return -1;
	}

	ircut_state_info.daynight_mode_state = _isp_attr.gpio_status_old;
	if(sdk_vin){
		sdk_vin->get_md_alarm_state(&(ircut_state_info.md_alarm_state));
	}
	if(_isp_attr.ircut_auto_switch_enable){
		if(_isp_attr.ircut_control_mode == ISP_IRCUT_CONTROL_MODE_HARDWARE)
	  	{
			uint32_t gpio_status_cur;
			gpio_status_cur = _isp_attr.bsp_api.BSP_GET_PHOTOSWITCH();
			if(_isp_attr.ircut_switch_control_mode == IRLED_CONTROL_MODE){
				isp_ircut_switch_hardware_control(&_isp_attr.gpio_status_old, gpio_status_cur);
			}else if(_isp_attr.ircut_switch_control_mode == LIGHT_CONTROL_MODE){
				ISP_EXP_INFO_S stExpInfo;
				ISP_PUB_ATTR_S stPubAttr;

				SOC_CHECK(HI_MPI_ISP_QueryExposureInfo(0,&stExpInfo));
				SOC_CHECK(HI_MPI_ISP_GetPubAttr(0,&stPubAttr));

				float max_exposure_time = 1/stPubAttr.f32FrameRate * 1000;
				float cur_exposure_time = stExpInfo.u32ExpTime/1000;
				float cur_gain = gains_calculate()/1024;

				ircut_state_info.cur_expose_factor = cur_exposure_time / max_exposure_time * cur_gain;
				isp_ircut_switch_hardware_control_lightmode(gpio_status_cur, &ircut_state_info);
				_isp_attr.gpio_status_old = ircut_state_info.daynight_mode_state;
			}else if(_isp_attr.ircut_switch_control_mode == SMART_CONTROL_MODE){
				isp_ircut_switch_hardware_control_smartmode(&_isp_attr.gpio_status_old, gpio_status_cur, &ircut_state_info);
			}

		} else if(_isp_attr.ircut_control_mode == ISP_IRCUT_CONTROL_MODE_SOFTWARE) {	
			//isp_ircut_switch_ircut_control_param();						
			isp_ircut_switch_sofeware_control(&ircut_state_info);
			_isp_attr.gpio_status_old = ircut_state_info.daynight_mode_state;
			ircut_state_info.Bayer_flag = false;
		}

	}else{
			//do nothing
	}
	return 0;
}

int HI_SDK_ISP_set_mirror(int vin, bool mirror)

{
	if(_isp_attr.sensor_set_mirror){		
		printf("******%s***mirror =%d**\n",__FUNCTION__,mirror);
		_isp_attr.sensor_set_mirror(mirror);///
	}

	return 0;
}

int HI_SDK_ISP_set_flip(int vin, bool flip)

{  
	if(_isp_attr.sensor_set_flip){
		printf("******%s**flip =%d ***\n",__FUNCTION__,flip);
		_isp_attr.sensor_set_flip(flip);//
	}
	return 0;
}


int HI_SDK_ISP_set_saturation(int vin, uint16_t val)
{
	VI_CSC_ATTR_S pstCSCAttr;
	SOC_CHECK(HI_MPI_VI_GetCSCAttr(vin, &pstCSCAttr));
	pstCSCAttr.u32SatuVal = val;
	SOC_CHECK(HI_MPI_VI_SetCSCAttr(vin, &pstCSCAttr));
	//printf("saturation set:%d\r\n", val);

	return 0;
}

int HI_SDK_ISP_get_saturation(int vin, uint16_t *val)
{

	ISP_WB_INFO_S pstWBInfo;
	SOC_CHECK(HI_MPI_ISP_QueryWBInfo(0,&pstWBInfo));//	pstWBInfo.u16Saturation
	printf("saturation get:%d\r\n", pstWBInfo.u16Saturation);
	*val = pstWBInfo.u16Saturation;
	return 0;
}


int HI_SDK_ISP_set_contrast(int vin, uint16_t val)
{
	VI_CSC_ATTR_S pstCSCAttr;
	SOC_CHECK(HI_MPI_VI_GetCSCAttr(vin, &pstCSCAttr));
	pstCSCAttr.u32ContrVal = val;
	SOC_CHECK(HI_MPI_VI_SetCSCAttr(vin, &pstCSCAttr));
	//printf("contrast set:%d\r\n", val);
	return 0;
}

int HI_SDK_ISP_set_brightness(int vin, uint16_t val)
{
	VI_CSC_ATTR_S pstCSCAttr;
	SOC_CHECK(HI_MPI_VI_GetCSCAttr(vin, &pstCSCAttr));
	pstCSCAttr.u32LumaVal= val;
	SOC_CHECK(HI_MPI_VI_SetCSCAttr(vin, &pstCSCAttr));
	//printf("brightness set:%d\r\n", val);
	return 0;
}

int HI_SDK_ISP_set_hue(int vin, uint16_t val)
{
	VI_CSC_ATTR_S pstCSCAttr;
	SOC_CHECK(HI_MPI_VI_GetCSCAttr(vin, &pstCSCAttr));
	pstCSCAttr.u32HueVal = val;
	SOC_CHECK(HI_MPI_VI_SetCSCAttr(vin, &pstCSCAttr));
	//printf("hue set:%d\r\n", val);
	return 0;
}


int HI_SDK_ISP_set_advance_lowlight_enable(uint8_t bEnable)
{
	//printf("%s:%d\r\n", __FUNCTION__, bEnable);     // 0   1   2  3 
	
	_isp_attr.lowlight_mode = bEnable;

	if(_isp_attr.ispCfgAttr){
		_isp_attr.ispCfgAttr->impCfgAttr.AutoSlowFrameRate = _isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_AUTO ? true : false;
		_isp_attr.ispCfgAttr->impCfgAttr.src_framerate = _isp_attr.src_framerate ;
		
		//printf("AutoSlowFrameRate:%d\r\n", _isp_attr.ispCfgAttr->impCfgAttr.AutoSlowFrameRate);
	}

	if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_ALLDAY ){
		_isp_attr.isp_framerate_status = true;		
		_hi_sdk_isp_set_slow_framerate(true);
		
	}else if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_NIGHT && _isp_attr.gpio_status_old == ISP_GPIO_NIGHT ){
		_isp_attr.isp_framerate_status = true;
		_hi_sdk_isp_set_slow_framerate(true);

	}else if(_isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_AUTO && _isp_attr.gpio_status_old == ISP_GPIO_NIGHT ){
		if( _isp_attr.sensor_type == SENSOR_MODEL_SMARTSENS_SC2035 ||
			_isp_attr.sensor_type == SENSOR_MODEL_SMARTSENS_SC2045){
				_isp_attr.isp_framerate_status = true;
				_hi_sdk_isp_set_slow_framerate(true);
			}
	}else{
		_isp_attr.isp_framerate_status = false;
		_hi_sdk_isp_set_slow_framerate(false);
	}
	
	return 0;
}


int HI_SDK_ISP_set_src_framerate(unsigned int framerate)
{
	ISP_DEV IspDev = 0;
	ISP_PUB_ATTR_S stPubAttr;	
	ISP_EXPOSURE_ATTR_S stExpAttr;
	
	SOC_CHECK(HI_MPI_ISP_GetPubAttr(IspDev,&stPubAttr));
	
	if(framerate <= 25){
		stPubAttr.f32FrameRate = 25;
		_isp_attr.filter_frequency = 50;
	}else{
		stPubAttr.f32FrameRate= 30;
		_isp_attr.filter_frequency = 60;
	}
	
	if(_isp_attr.sensor_type == SENSOR_MODEL_SMARTSENS_SC2035 ||
		_isp_attr.sensor_type == SENSOR_MODEL_SMARTSENS_SC2045||
		_isp_attr.sensor_type == SENSOR_MODEL_PS5230){
		stPubAttr.f32FrameRate= 25;
	}	
	if(_isp_attr.sensor_type == SENSOR_MODEL_SC3035 ){
		stPubAttr.f32FrameRate=13;
	}

	SOC_CHECK(HI_MPI_ISP_GetExposureAttr(IspDev,&stExpAttr));
	stExpAttr.stAuto.stAntiflicker.bEnable = HI_TRUE; 
	stExpAttr.stAuto.stAntiflicker.u8Frequency = _isp_attr.filter_frequency;	
	SOC_CHECK(HI_MPI_ISP_SetExposureAttr(IspDev,&stExpAttr));
	
	usleep(100000);

	return 0;
}

int HI_SDK_ISP_get_sharpen(uint8_t *val)
{	
	
    ISP_DEV IspDev = 0;
    ISP_SHARPEN_ATTR_S SharpenAttr;
	SOC_CHECK(HI_MPI_ISP_GetSharpenAttr(IspDev,&SharpenAttr));
	
	int iso = isp_get_iso();
	if(iso < 200){
		*val = SharpenAttr.stAuto.au8SharpenUd[0];
	}else if(iso < 400){
		*val = SharpenAttr.stAuto.au8SharpenUd[1];
	}else if(iso < 800){
		*val = SharpenAttr.stAuto.au8SharpenUd[2];
	}else if(iso < 1600){
		*val = SharpenAttr.stAuto.au8SharpenUd[3];
	}else if(iso < 3200){
		*val = SharpenAttr.stAuto.au8SharpenUd[4];
	}else if(iso < 6400){
		*val = SharpenAttr.stAuto.au8SharpenUd[5];
	}else if(iso < 12800){
		*val = SharpenAttr.stAuto.au8SharpenUd[6];
	}else if(iso < 25600){
		*val = SharpenAttr.stAuto.au8SharpenUd[7];
	}else if(iso < 51200){
		*val = SharpenAttr.stAuto.au8SharpenUd[8];
	}else if(iso < 102400){
		*val = SharpenAttr.stAuto.au8SharpenUd[9];
	}else if(iso < 204800){
		*val = SharpenAttr.stAuto.au8SharpenUd[10];
	}else if(iso < 409600){	
	    *val = SharpenAttr.stAuto.au8SharpenUd[11];
	}else if(iso < 819200){
		*val = SharpenAttr.stAuto.au8SharpenUd[12];
	}else if(iso < 1638400){
		*val = SharpenAttr.stAuto.au8SharpenUd[13];
	}else if(iso < 3276800){
		*val = SharpenAttr.stAuto.au8SharpenUd[14];
	}else {
		*val = SharpenAttr.stAuto.au8SharpenUd[15];
	};

	return 0;
}


int HI_SDK_ISP_set_sharpen(uint8_t val, uint8_t bManual)
{
	
	ISP_SHARPEN_ATTR_S   stSharpenAttr;
	
	SOC_CHECK(HI_MPI_ISP_GetSharpenAttr(0,&stSharpenAttr));
	stSharpenAttr.bEnable = HI_TRUE;
	if(bManual){
		stSharpenAttr.enOpType =  OP_TYPE_MANUAL;
		stSharpenAttr.stManual.u8SharpenD = val / 3;	
		stSharpenAttr.stManual.u8SharpenUd = val / 3;
	}else{
		stSharpenAttr.enOpType =  OP_TYPE_AUTO;
	}
	
 	SOC_CHECK(HI_MPI_ISP_SetSharpenAttr(0,&stSharpenAttr)); 
	return 0;
}

int HI_SDK_ISP_set_scene_mode(uint32_t mode)
{
	//printf("%s:%d\r\n", __FUNCTION__, mode);
    ISP_DRC_ATTR_S pstDRC;
	
	SOC_CHECK(HI_MPI_ISP_GetDRCAttr(0,&pstDRC));
	switch(mode){
		default:
		case ISP_SCENE_MODE_AUTO:
			HI_SDK_ISP_sensor_flicker(0xff,0,1);
			pstDRC.bEnable = HI_TRUE;
			break;
		case ISP_SCENE_MODE_INDOOR:
			HI_SDK_ISP_sensor_flicker(0xff,0,0);
			pstDRC.bEnable = HI_TRUE;
			break;
		case ISP_SCENE_MODE_OUTDOOR:
			HI_SDK_ISP_sensor_flicker(0xff,0,1);
			pstDRC.bEnable = HI_FALSE;
			break;
	}
	_isp_attr.isp_auto_drc_enabled = pstDRC.bEnable;
	SOC_CHECK(HI_MPI_ISP_SetDRCAttr(0,&pstDRC));
	return 0;

}

int HI_SDK_ISP_set_WB_mode(uint32_t mode)
{
	ISP_AWB_ATTR_EX_S  pstAWBAttrEx;
	SOC_CHECK(HI_MPI_ISP_GetAWBAttrEx(0,&pstAWBAttrEx));
	switch(mode){
	default:
	case ISP_SCENE_MODE_AUTO:
		pstAWBAttrEx.u8ZoneRadius = 16;
		break;
	case ISP_SCENE_MODE_INDOOR:		
		pstAWBAttrEx.u8ZoneRadius = 8;
		break;
	case ISP_SCENE_MODE_OUTDOOR:
		
		pstAWBAttrEx.u8ZoneRadius = 16;
		break;
	}
    pstAWBAttrEx.stInOrOut.enOpType = OP_TYPE_MANUAL;
    pstAWBAttrEx.stInOrOut.bOutdoorStatus = HI_FALSE;
	SOC_CHECK(HI_MPI_ISP_SetAWBAttrEx(0,&pstAWBAttrEx));

	return 0;
}

int HI_SDK_ISP_set_ircut_control_mode(uint32_t mode)
{
	//printf("%s:%d\r\n", __FUNCTION__, mode);
	_isp_attr.ircut_control_mode = mode;
	return 0;
}

int HI_SDK_ISP_set_ircut_mode(uint32_t mode)
{
	//printf("%s:%d\r\n", __FUNCTION__, mode);
	_isp_attr.md_lock = HI_TRUE;
	isp_white_light_switch(0);
	if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){
		isp_smartmode_isp_switch(1);
	}else{
		isp_smartmode_isp_switch(0);
	}
	switch(mode){
		default:
		case ISP_IRCUT_MODE_AUTO:
			_isp_attr.ircut_auto_switch_enable = HI_TRUE;
			_isp_attr.ircut_switch_control_mode = IRLED_CONTROL_MODE;
			break;
		case ISP_IRCUT_MODE_DAYLIGHT:
			_isp_attr.ircut_auto_switch_enable = HI_FALSE;
			isp_ircut_switch(0);
			break;
		case ISP_IRCUT_MODE_NIGHT:
			_isp_attr.ircut_auto_switch_enable = HI_FALSE;
			isp_ircut_switch(1);
			break;
		case ISP_IRCUT_MODE_LIGHTMODE:
			_isp_attr.ircut_auto_switch_enable = HI_TRUE;
			isp_ircut_switch(0);
			_isp_attr.ircut_switch_control_mode = LIGHT_CONTROL_MODE;
			break;
		case ISP_IRCUT_MODE_SMARTMODE:
			_isp_attr.ircut_auto_switch_enable = HI_TRUE;
			_isp_attr.ircut_switch_control_mode = SMART_CONTROL_MODE;
			_isp_attr.md_lock = HI_FALSE;
			break;
	}
	return 0;
}

int HI_SDK_ISP_set_WDR_enable(uint8_t bEnable)
{
	return 0;
	printf("\n\n\n%s enable=%d\n",__FUNCTION__,bEnable);
 
	ISP_DRC_ATTR_S pstDRC;
	SOC_CHECK(HI_MPI_ISP_GetDRCAttr(0,&pstDRC));
	pstDRC.bEnable = bEnable;
	_isp_attr.isp_auto_drc_enabled = bEnable;			
	SOC_CHECK(HI_MPI_ISP_SetDRCAttr(0,&pstDRC));
	
	  return 0;
}

int HI_SDK_ISP_set_WDR_strength(uint8_t val)
{
	return 0;
	printf("%s:%d\r\n", __FUNCTION__, val);

	/////////FIXme
	ISP_DRC_ATTR_S pstDRC;
	
	SOC_CHECK(HI_MPI_ISP_GetDRCAttr(0,&pstDRC));

	if(val >5){
		val = 5;
	}
	if(val < 1){
		val = 1;
	}
	_isp_attr.wdr.strength = val;
	
//	pstDRC.bEnable = _isp_attr.isp_auto_drc_enabled;
	pstDRC.bEnable = HI_FALSE;//HI_TRUE
	pstDRC.enOpType = OP_TYPE_AUTO;//OP_TYPE_MANUAL;
//	pstDRC.stManual.u8Strength = drc_value;
	SOC_CHECK(HI_MPI_ISP_SetDRCAttr(0,&pstDRC));

	return 0;
}



int HI_SDK_ISP_get_denoise_strength(uint8_t *val)
{		
	*val = _isp_attr.YPKStrength.strength;
	return 0;
}



int HI_SDK_ISP_set_denoise_strength(uint8_t val)
{		
	return 0;
}

int HI_SDK_ISP_set_advance_anti_fog_enable(uint8_t bEnable)
{
	ISP_DEFOG_ATTR_S pstDefogAttr;
	SOC_CHECK(HI_MPI_ISP_GetDeFogAttr(0,&pstDefogAttr));
	pstDefogAttr.bEnable = bEnable;
	SOC_CHECK(HI_MPI_ISP_SetDeFogAttr(0,&pstDefogAttr));
	return 0;
}


int HI_SDK_ISP_set_advance_gamma_table(uint8_t val)
{
	return 0;
}

int HI_SDK_ISP_set_advance_defect_pixel_enable(uint8_t bEnable)
{
	return 0;
}

int HI_SDK_ISP_get_color_max_value(stSensorColorMaxValue *ret_value)
{
	memcpy(ret_value, &_isp_attr.color_max_value, sizeof(stSensorColorMaxValue));
	return 0;
}


emSENSOR_MODEL HI_SDK_ISP_get_sensor_model(char *sensor_name)
{
	_isp_attr.sensor_get_name(sensor_name);
	return  _isp_attr.sensor_type;
}

int HI_SDK_ISP_set_sensor_resolution(uint32_t width, uint32_t height)
{
	if(0 == width || 0 == height){
		//set default resolution
		if(_isp_attr.sensor_get_resolution){
			_isp_attr.sensor_get_resolution(&_isp_attr.sensor_resolution_width, &_isp_attr.sensor_resolution_height);
			printf("%s-%d:%dx%d\n", __FUNCTION__, __LINE__, _isp_attr.sensor_resolution_width, _isp_attr.sensor_resolution_height);
		}
	}
	else{
		_isp_attr.sensor_resolution_width = width;
		_isp_attr.sensor_resolution_height = height;
	}
	return 0;
}

int HI_SDK_ISP_get_sensor_resolution(uint32_t *ret_width, uint32_t *ret_height)
{
	*ret_width = _isp_attr.sensor_resolution_width;
	*ret_height = _isp_attr.sensor_resolution_height;
	return 0;
}


int HI_SDK_ISP_get_sensor_defect_pixel_table(void )
{
	return -1;
}

int HI_SDK_ISP_set_sensor_defect_pixel_table(void )
{
	return -1;	
}

int HI_SDK_ISP_get_daynight_mode()
{
    return _isp_attr.gpio_status_old;
}

	 

static void do_isp_common(uint32_t iso)
{
	if(_isp_attr.sensor_type == SENSOR_MODEL_PS5270)
	{
		HI_ISP_cfg_set_awb_single(_isp_attr.gpio_status_old, _isp_attr.ispCfgAttr);	
		HI_ISP_cfg_set_ae_single(_isp_attr.gpio_status_old, _isp_attr.ispCfgAttr);
	}
	HI_ISP_cfg_set_imp_single(_isp_attr.gpio_status_old, _isp_attr.ispCfgAttr);
}


static void do_isp_sensor(uint32_t iso){
	switch(_isp_attr.sensor_type){
		default:
		case SENSOR_MODEL_APTINA_AR0130:		
		case SENSOR_MODEL_APTINA_AR0230:
		case SENSOR_MODEL_SONY_IMX122:
		case SENSOR_MODEL_SMARTSENS_SC2035:
		case SENSOR_MODEL_APTINA_AR0237:
		case SENSOR_MODEL_SMARTSENS_SC2045:
		case SENSOR_MODEL_SC1035:
		case SENSOR_MODEL_SC1045:
		case SENSOR_MODEL_SC1135:
		case SENSOR_MODEL_SC1145:
		case SENSOR_MODEL_SC1235:
		case SENSOR_MODEL_SC2235:
			break;
		case SENSOR_MODEL_PS5230:
#if defined(PX_720)
                SOC_CHECK(HI_MPI_ISP_GetDRCAttr(0,&stDRCAttr));
                if(m_iso<5)
                {
                    stDRCAttr.bEnable = HI_TRUE;
                    stDRCAttr.enOpType = 1;//OP_TYPE_MANUAL
                    stDRCAttr.stManual.u8Strength = 30;
                }
                else
                {
                    stDRCAttr.bEnable = HI_FALSE;
                }
                SOC_CHECK(HI_MPI_ISP_SetDRCAttr(0,&stDRCAttr));
#endif
			break;
		}
}



uint32_t HI_SDK_ISP_get_gain(void)
{
	uint32_t ret_gain;
	ret_gain = gains_calculate();

	//all the sensor
	do_isp_common(ret_gain);
	
	//the own isp setting for each sensor
	do_isp_sensor(ret_gain);
	return ret_gain;
}


void HI_SDK_ISP_set_AF_attr(stSensorAfAttr *pAfAttr)
{
	if(_isp_attr.AfAttr.param){
		free(_isp_attr.AfAttr.param);
		_isp_attr.AfAttr.param = NULL;
	}
	_isp_attr.AfAttr.param = pAfAttr->param;
	_isp_attr.AfAttr.af_callback = pAfAttr->af_callback;
	
}


static int _hi_sdk_isp_set_slow_framerate(uint8_t bValue)
{
	uint8_t Value = bValue ? 0x1:0x0;
	VENC_CHN_ATTR_S vencChannelAttr;
	ISP_PUB_ATTR_S stPubAttr;	
	int actual_fps;
	int ret = 0;
	
	_isp_attr.isp_framerate_status = Value;
	SOC_CHECK(HI_MPI_ISP_GetPubAttr(0,&stPubAttr));
	ret = HI_MPI_VENC_GetChnAttr(0,&vencChannelAttr);
	if(ret != 0){
		return -1;
	}
	printf("old_FRate = %f\n",stPubAttr.f32FrameRate);

	actual_fps = _isp_attr.src_framerate/(1 << Value);
	switch(vencChannelAttr.stRcAttr.enRcMode){
		default:
		case VENC_RC_MODE_H264VBR:
			if(bValue == true){//slow framerate			
				stPubAttr.f32FrameRate = actual_fps;
				if(actual_fps < vencChannelAttr.stRcAttr.stAttrH264Vbr.fr32DstFrmRate){
					vencChannelAttr.stRcAttr.stAttrH264Vbr.u32SrcFrmRate  = vencChannelAttr.stRcAttr.stAttrH264Vbr.fr32DstFrmRate; 
				}else{
					vencChannelAttr.stRcAttr.stAttrH264Vbr.u32SrcFrmRate =  actual_fps;
				}	

			}else{//actual framerate		
				stPubAttr.f32FrameRate = actual_fps;
				if(actual_fps < vencChannelAttr.stRcAttr.stAttrH264Vbr.fr32DstFrmRate){
					vencChannelAttr.stRcAttr.stAttrH264Vbr.u32SrcFrmRate  = vencChannelAttr.stRcAttr.stAttrH264Vbr.fr32DstFrmRate; 
				}else{
					vencChannelAttr.stRcAttr.stAttrH264Vbr.u32SrcFrmRate =  actual_fps;
				}
			}
			break;
		
		case VENC_RC_MODE_H264CBR:
			if(bValue == true){//slow framerate
				stPubAttr.f32FrameRate = actual_fps;
				if(actual_fps < vencChannelAttr.stRcAttr.stAttrH264Cbr.fr32DstFrmRate){
					vencChannelAttr.stRcAttr.stAttrH264Cbr.u32SrcFrmRate  = vencChannelAttr.stRcAttr.stAttrH264Cbr.fr32DstFrmRate; 
				}else{
					vencChannelAttr.stRcAttr.stAttrH264Cbr.u32SrcFrmRate =  actual_fps;
				}		
				
			}else{//actual framerate	
				stPubAttr.f32FrameRate = actual_fps;
				if(actual_fps < vencChannelAttr.stRcAttr.stAttrH264Cbr.fr32DstFrmRate){
					vencChannelAttr.stRcAttr.stAttrH264Cbr.u32SrcFrmRate  = vencChannelAttr.stRcAttr.stAttrH264Cbr.fr32DstFrmRate; 
				}else{
					vencChannelAttr.stRcAttr.stAttrH264Cbr.u32SrcFrmRate =  actual_fps;
				}
			}
			break;		
		}
	
	HI_MPI_VENC_SetChnAttr(0,&vencChannelAttr);
	SOC_CHECK(HI_MPI_ISP_SetPubAttr(0,&stPubAttr));
	
	printf("new_FRate = %f\n",stPubAttr.f32FrameRate);
	
	return 0;

}


int HI_SDK_ISP_set_isp_sensor_value(void)////mode  0:daytime   1:night
{
	ISP_EXPOSURE_ATTR_S stExpAttr;
	ISP_GAMMA_ATTR_S GammaAttr;
	VPSS_NR_PARAM_U unNrParam;
	ISP_NR_ATTR_S stNRAttr;
	ISP_DEMOSAIC_ATTR_S stDemosaicAttr;
	ISP_DP_DYNAMIC_ATTR_S stDPDynamicAttr;
	ISP_SHARPEN_ATTR_S stSharpenAttr;
	ISP_CR_ATTR_S stCRAttr;
	ISP_SHADING_ATTR_S stShadingAttr;
	ISP_ANTI_FALSECOLOR_S stAntiFalseColorAttr;
	ISP_SATURATION_ATTR_S stSaturationAttr;
	ISP_AWB_ATTR_EX_S stAWBAttrEx;
	ISP_WB_ATTR_S stWBAttr;
	VI_DCI_PARAM_S stDCIAttr;
	ISP_DRC_ATTR_S stDRCAttr;
	ISP_DEFOG_ATTR_S stDefogAttr;
	
	ISP_COLOR_TONE_ATTR_S stColorToneAttr;
	VI_DCI_PARAM_S stDciParam;

	SOC_CHECK(HI_MPI_ISP_GetExposureAttr(0,&stExpAttr));
	SOC_CHECK(HI_MPI_ISP_GetGammaAttr(0, &GammaAttr));
    SOC_CHECK(HI_MPI_VPSS_GetNRParam(0, &unNrParam));
    SOC_CHECK(HI_MPI_ISP_GetNRAttr(0, &stNRAttr));
	SOC_CHECK(HI_MPI_ISP_GetDemosaicAttr(0,&stDemosaicAttr));
	SOC_CHECK(HI_MPI_ISP_GetDPDynamicAttr(0,&stDPDynamicAttr));
	SOC_CHECK(HI_MPI_ISP_GetSharpenAttr(0,&stSharpenAttr));
	SOC_CHECK(HI_MPI_ISP_GetCrosstalkAttr(0,&stCRAttr));
	SOC_CHECK(HI_MPI_ISP_GetMeshShadingAttr(0,&stShadingAttr));
	SOC_CHECK(HI_MPI_ISP_GetAntiFalseColorAttr(0,&stAntiFalseColorAttr));
	SOC_CHECK(HI_MPI_ISP_GetSaturationAttr(0,&stSaturationAttr));
	SOC_CHECK(HI_MPI_ISP_GetAWBAttrEx(0,&stAWBAttrEx));
	SOC_CHECK(HI_MPI_ISP_GetWBAttr(0,&stWBAttr));
	SOC_CHECK(HI_MPI_VI_GetDCIParam(0, &stDCIAttr));
	SOC_CHECK(HI_MPI_ISP_GetDRCAttr(0,&stDRCAttr));
	SOC_CHECK(HI_MPI_ISP_GetDeFogAttr(0,&stDefogAttr));
	SOC_CHECK(HI_MPI_ISP_GetColorToneAttr(0,&stColorToneAttr));
	SOC_CHECK(HI_MPI_VI_GetDCIParam(0, &stDciParam));
	
	switch(_isp_attr.sensor_type){
		default:
		case SENSOR_MODEL_APTINA_AR0130:		
			{	
				stNRAttr.enOpType = OP_TYPE_AUTO;
				stExpAttr.enOpType = OP_TYPE_AUTO;		
				stExpAttr.stAuto.u8Speed = 8;
				stDPDynamicAttr.enOpType = OP_TYPE_AUTO;
				stCRAttr.bEnable = HI_FALSE;
				
				HI_U8 au8VarStrength[16] = {10,20,20,20,30,30,30,30,30,30,30,30,30,30,30,30};			
				HI_U16 au16Threshold[16] = {1250,1250,1250,1250,1250,1250,1250,1250,1250,1250,1250,1250,1250,1250,1250,1250};
				HI_U8 au8LowFreqSlope[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};			

				HI_U16 au16Slope[16] = {0,0,0,245,252,253,254,254,0,0,0,0,0,0,0,0};
				HI_U16 au16BlendRatio[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
				
				memcpy(stNRAttr.stAuto.au8VarStrength,au8VarStrength,sizeof(HI_U8)*16);
				memcpy(stNRAttr.stAuto.au16Threshold,au16Threshold,sizeof(HI_U16)* 16);
				memcpy(stNRAttr.stAuto.au8LowFreqSlope,au8LowFreqSlope,sizeof(HI_U8)*16);
				
				memcpy(stDPDynamicAttr.stAuto.au16Slope,au16Slope,sizeof(HI_U16)*16);
				memcpy(stDPDynamicAttr.stAuto.au16BlendRatio,au16BlendRatio,sizeof(HI_U16)*16);

					
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[6], sizeof(gs_Gamma[6]));

					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
					unNrParam.stNRParam_V1.s32YSmthStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSmthStrength);


				//	stExpAttr.stAuto.stAGainRange.u32Max = 1024;
				//	stExpAttr.stAuto.stDGainRange.u32Max = 1024;
					stExpAttr.stAuto.stISPDGainRange.u32Max = 1024;
					stExpAttr.stAuto.stSysGainRange.u32Max = 40960;
					stExpAttr.stAuto.u16HistRatioSlope = 128;
					stExpAttr.stAuto.u8MaxHistOffset =  16;

					stDemosaicAttr.u16UuSlope = 500;


				//	HI_U8 au8SharpenUd[16] = {119,118,117,116,115,110,85,85,85,85,85,85,85,85,85,85};
				//	memcpy(stSharpenAttr.stAuto.au8SharpenUd,au8SharpenUd,sizeof(HI_U8)*16);
	
				}else{//night
				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[7], sizeof(gs_Gamma[7]));
					
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
					unNrParam.stNRParam_V1.s32YSmthStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSmthStrength);

					stExpAttr.stAuto.stISPDGainRange.u32Max = 1024;
					stExpAttr.stAuto.stSysGainRange.u32Max = 40960;
					stExpAttr.stAuto.u16HistRatioSlope = 256;
					stExpAttr.stAuto.u8MaxHistOffset =  32;
					
					stDemosaicAttr.u16UuSlope = 400;

				//	HI_U8 au8SharpenUd[16] = {119,118,117,116,115,110,85,85,85,85,85,85,85,85,85,85};
				//	memcpy(stSharpenAttr.stAuto.au8SharpenUd,au8SharpenUd,sizeof(HI_U8)*16);

				}
			}
	    break;
		case SENSOR_MODEL_APTINA_AR0230:
			{
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[6], sizeof(gs_Gamma[6]));

					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);


				
				}else{
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[6], sizeof(gs_Gamma[6]));
					
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}
			}
		break;
		case SENSOR_MODEL_SONY_IMX122:
			{
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[6], sizeof(gs_Gamma[6]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);

				
				}else{				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[6], sizeof(gs_Gamma[6]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);



				}

			}
		break;	
		case SENSOR_MODEL_SMARTSENS_SC2035:
			{
				/*2D-NR*/
				HI_U8 au8VarStrength_0[16]={130,140,160,160,180,200,200,200,200,200,200,200,200,200,200,200};
				HI_U8 au8VarStrength_1[16]={130,140,160,160,160,160,180,180,180,180,180,180,180,180,180,180};
				
				HI_U16 au16Threshold_0[16]={1500,1500,1500,1500,1500,1500,1500,2000,2000,2000,2000,2000,2000,2000,2000,2000};
				HI_U16 au16Threshold_1[16]={1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500,1500};
				/*Sharpen*/
			 	HI_U8 au8SharpenD_0[16]= {95,90,85,80,70,30,20,20,20,20,20,20,20,20,20,20};
			 	HI_U8 au8SharpenD_1[16]= {90,85,83,60,30,10,10,10,10,10,10,10,10,10,10,10};

				HI_U8 au8SharpenUd_0[16]={105,95,85,80,75,30,20,20,20,20,20,20,20,20,20,20};
				HI_U8 au8SharpenUd_1[16]={90,85,83,60,30,10,10,10,10,10,10,10,10,10,10,10};

				HI_U8 au8OverShoot_0[16]= {95,95,90,90,80,60,60,60,60,60,60,60,60,60,60,60};
				HI_U8 au8OverShoot_1[16]= {90,90,80,70,40,20,20,20,20,20,20,20,20,20,20,20};

				HI_U8 au8UnderShoot_0[16]= {110,100,90,90,90,60,60,60,60,60,60,60,60,60,60,60};
				HI_U8 au8UnderShoot_1[16]= {100,98,95,65,40,20,20,20,20,20,20,20,20,20,20,20};
				
				HI_U8 au8TextureNoiseThd_0[16]= {5,12,18,20,20,25,25,25,25,25,25,25,25,25,25,25};
				HI_U8 au8TextureNoiseThd_1[16]= {0,0,0,0,0,2,5,10,10,10,10,10,10,10,10,10};

				HI_U8 au8EdgeNoiseThd_0[16]= {5,12,18,20,20,25,25,25,25,25,25,25,25,25,25,25};
				HI_U8 au8EdgeNoiseThd_1[16]= {0,0,0,0,0,2,5,10,10,10,10,10,10,10,10,10};

				HI_U8 au8FixStrength_0[16]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
				HI_U8 au8FixStrength_1[16]={0,0,0,30,40,50,50,50,0,0,0,0,0,0,0,0};
				
				HI_U16 au16BlendRatio_0[16]={0,0,0,0,0,30,60,60,0,0,0,0,0,0,0,0};
				HI_U16 au16BlendRatio_1[16]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
			
				HI_U16 au16Slope_0[16]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
				HI_U16 au16Slope_1[16]={0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
				

				/*DPCAttr*/
				stDPDynamicAttr.bEnable=HI_TRUE;
				stDPDynamicAttr.enOpType = OP_TYPE_AUTO;
				/*AEAttr*/
				stExpAttr.stAuto.u16HistRatioSlope=128;
				stExpAttr.stAuto.u8MaxHistOffset=16;
				stExpAttr.stAuto.stAGainRange.u32Max=65536;
				stExpAttr.stAuto.stDGainRange.u32Max=1024;
				stExpAttr.stAuto.stISPDGainRange.u32Max=2048;
				stExpAttr.stAuto.stSysGainRange.u32Max=102400;					
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));

					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
					/*copy sharpen data */
					memcpy(stSharpenAttr.stAuto.au8SharpenD,au8SharpenD_0,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8SharpenUd,au8SharpenUd_0,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8OverShoot,au8OverShoot_0,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8UnderShoot,au8UnderShoot_0,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8TextureNoiseThd,au8TextureNoiseThd_0,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8EdgeNoiseThd,au8EdgeNoiseThd_0,sizeof(HI_U8)*16);
					/*copy 2D-NR data */
					memcpy(stNRAttr.stAuto.au8VarStrength,au8VarStrength_0,sizeof(HI_U8)*16);
					memcpy(stNRAttr.stAuto.au16Threshold,au16Threshold_0,sizeof(HI_U16)*16);					
					memcpy(stNRAttr.stAuto.au8FixStrength,au8FixStrength_0,sizeof(HI_U8)*16);
					memcpy(stDPDynamicAttr.stAuto.au16BlendRatio,au16BlendRatio_0,sizeof(HI_U16)*16);
					memcpy(stDPDynamicAttr.stAuto.au16Slope,au16Slope_0,sizeof(HI_U16)*16);
				
				}else{
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[10], sizeof(gs_Gamma[10]));
					
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
					/*copy sharpen data */
					memcpy(stSharpenAttr.stAuto.au8SharpenD,au8SharpenD_1,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8SharpenUd,au8SharpenUd_1,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8OverShoot,au8OverShoot_1,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8UnderShoot,au8UnderShoot_1,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8TextureNoiseThd,au8TextureNoiseThd_1,sizeof(HI_U8)*16);
					memcpy(stSharpenAttr.stAuto.au8EdgeNoiseThd,au8EdgeNoiseThd_1,sizeof(HI_U8)*16);
					/*copy 2D-NR data */
					memcpy(stNRAttr.stAuto.au8VarStrength,au8VarStrength_1,sizeof(HI_U8)*16);
					memcpy(stNRAttr.stAuto.au16Threshold,au16Threshold_1,sizeof(HI_U16)*16);			
					memcpy(stNRAttr.stAuto.au8FixStrength,au8FixStrength_1,sizeof(HI_U8)*16);
					memcpy(stDPDynamicAttr.stAuto.au16BlendRatio,au16BlendRatio_1,sizeof(HI_U16)*16);
					memcpy(stDPDynamicAttr.stAuto.au16Slope,au16Slope_1,sizeof(HI_U16)*16);

				}
			}
		break;
		case SENSOR_MODEL_APTINA_AR0237:
			{
				stExpAttr.enOpType=OP_TYPE_AUTO;
				stNRAttr.enOpType=OP_TYPE_AUTO;
				stSharpenAttr.enOpType=OP_TYPE_AUTO;
				stDPDynamicAttr.enOpType=OP_TYPE_AUTO;
				stShadingAttr.bEnable=HI_TRUE;
				stShadingAttr.enOpType=OP_TYPE_AUTO;
				stAntiFalseColorAttr.bEnable=HI_FALSE;
				
				/*2D-NR*/
				HI_U8 au8VarStrength[16]={64,64,64,64,100,100,100,148,148,0,0,0,0,0,0,0};
				HI_U16 au16Threshold[16]={1500,1500,1500,1500,1500,1500,1500,5898,5898,0,0,0,0,0,0,0};
				/*Sharpen*/
			 	HI_U8 au8SharpenD[16]= {138,120,118,117,112,110,100,100,100,0,0,0,0,0,0,0};
				HI_U8 au8SharpenUd[16]={120,120,118,117,117,110,100,100,100,0,0,0,0,0,0,0};
				HI_U8 au8OverShoot[16]= {60,60,30,30,30,30,30,30,30,0,0,0,0,0,0,0};
				HI_U8 au8UnderShoot[16]= {73,73,73,73,73,73,73,73,73,0,0,0,0,0,0,0};
				HI_U8 au8TextureNoiseThd[16]= {15,15,25,25,25,25,25,25,25,0,0,0,0,0,0,0};
				HI_U8 au8EdgeNoiseThd[16]= {15,15,25,25,25,25,25,25,25,0,0,0,0,0,0,0};
				/*DPC-Dynamic*/
				HI_U16	au16Slope[16]= {248,248,248,248,248,248,248,248,248,0,0,0,0,0,0,0};

				/*AEAttr*/
				stExpAttr.stAuto.stAGainRange.u32Max=28672;
				stExpAttr.stAuto.stDGainRange.u32Max=4096;
				stExpAttr.stAuto.stISPDGainRange.u32Max=1167;
				stExpAttr.stAuto.stSysGainRange.u32Max=131072;
				stExpAttr.stAuto.u8Tolerance=4;
				stExpAttr.stAuto.u8Speed=48;
				stExpAttr.stAuto.u8Compensation=70;
				stExpAttr.stAuto.u16HistRatioSlope=128;
				stExpAttr.stAuto.u8MaxHistOffset=15;
				/*DemosaicAttr*/
				stDemosaicAttr.u16UuSlope=0;//solve the net problem by hisilicon
				stDemosaicAttr.u16VhSlope=48;
				stDemosaicAttr.u8VhLimit=48;
				stDemosaicAttr.u8VhOffset=24;
				
				/*copy 2D-NR data */
				memcpy(stNRAttr.stAuto.au8VarStrength,au8VarStrength,sizeof(HI_U8)*16);
				memcpy(stNRAttr.stAuto.au16Threshold,au16Threshold,sizeof(HI_U16)*16);

				/*copy sharpen data */
				memcpy(stSharpenAttr.stAuto.au8SharpenD,au8SharpenD,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8SharpenUd,au8SharpenUd,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8OverShoot,au8OverShoot,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8UnderShoot,au8UnderShoot,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8TextureNoiseThd,au8TextureNoiseThd,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8EdgeNoiseThd,au8EdgeNoiseThd,sizeof(HI_U8)*16);
				/*copy sharpen data */
				memcpy(stDPDynamicAttr.stAuto.au16Slope,au16Slope,sizeof(HI_U16)*16);
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[8], sizeof(gs_Gamma[8]));

					//stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				
				}else{
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[8], sizeof(gs_Gamma[8]));
					
				//	stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}
			}
		break;
		case SENSOR_MODEL_SMARTSENS_SC2045:
			{	
				/*SaturationAttr*/
				 HI_U8 au8Sat[16]={128,128,125,120,120,110,80,70,70,0,0,0,0,0,0,0}; 
				/*2D-NR*/
				HI_U8 au8VarStrength[16]={160,170,180,180,180,180,180,180,0,0,0,0,0,0,0,0};
				HI_U16 au16Threshold[16]={1500,1500,1500,1800,1800,1800,1800,1800,0,0,0,0,0,0,0,0};
				HI_U8 au8FixStrength_0[16]={30,40,45,60,70,70,70,70,70,70,70,70,70,70,70,70};
				HI_U8 au8FixStrength_1[16]={55,55,55,60,70,70,70,70,70,70,70,70,70,70,70,70};

				/*Sharpen*/
			 	HI_U8 au8SharpenD[16]= {138,120,118,117,112,110,60,60,0,0,0,0,0,0,0,0};
				HI_U8 au8SharpenUd[16]={110,110,110,110,110,100,60,60,0,0,0,0,0,0,0,0};
				HI_U8 au8OverShoot[16]= {69,69,69,69,69,69,69,69,0,0,0,0,0,0,0,0};
				HI_U8 au8UnderShoot[16]= {69,69,69,69,69,69,69,69,0,0,0,0,0,0,0,0};
				HI_U8 au8TextureNoiseThd[16]= {5,5,5,10,10,15,15,25,25,0,0,0,0,0,0,0};
				HI_U8 au8EdgeNoiseThd[16]= {5,5,5,10,10,15,15,25,25,0,0,0,0,0,0,0};
				HI_BOOL abEnLowLumaShoot[16]={0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0};;

				/*AEAttr*/
				stExpAttr.stAuto.stExpTimeRange.u32Max=90000;
				stExpAttr.stAuto.stAGainRange.u32Max=49152;
				//stExpAttr.stAuto.stDGainRange.u32Max=4096;
				stExpAttr.stAuto.stISPDGainRange.u32Max=1024;
				//stExpAttr.stAuto.stSysGainRange.u32Max=131072;
				stExpAttr.stAuto.u8Tolerance=4;
				stExpAttr.stAuto.u8Speed=48;
				stExpAttr.stAuto.u8Compensation=75;
				
				/*copy 2D-NR data */
				memcpy(stNRAttr.stAuto.au8VarStrength,au8VarStrength,sizeof(HI_U8)*16);
				memcpy(stNRAttr.stAuto.au16Threshold,au16Threshold,sizeof(HI_U16)*16);

				/*copy sharpen data */
				memcpy(stSharpenAttr.stAuto.au8SharpenD,au8SharpenD,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8SharpenUd,au8SharpenUd,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8OverShoot,au8OverShoot,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8UnderShoot,au8UnderShoot,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8TextureNoiseThd,au8TextureNoiseThd,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.au8EdgeNoiseThd,au8EdgeNoiseThd,sizeof(HI_U8)*16);
				memcpy(stSharpenAttr.stAuto.abEnLowLumaShoot,abEnLowLumaShoot,sizeof(HI_BOOL)*16);

				/*copy Saturation data */
				memcpy(stSaturationAttr.stAuto.au8Sat,au8Sat,sizeof(HI_U8)*16);

				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[7], sizeof(gs_Gamma[7]));
					memcpy(stNRAttr.stAuto.au8FixStrength,au8FixStrength_0,sizeof(HI_U8)*16);

					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);

					stExpAttr.stAuto.u16HistRatioSlope=128;
					stExpAttr.stAuto.u8MaxHistOffset=16;

				
				}else{
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[7], sizeof(gs_Gamma[7]));
					memcpy(stNRAttr.stAuto.au8FixStrength,au8FixStrength_1,sizeof(HI_U8)*16);

					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
					stExpAttr.stAuto.u16HistRatioSlope=1024;
					stExpAttr.stAuto.u8MaxHistOffset=64;
					
				}
			}
		break;
		case SENSOR_MODEL_SC1035:
			{
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}else{				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}
			}
		break;
		case SENSOR_MODEL_SC1045:
			{
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}else{				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}
			}
		break;

		case SENSOR_MODEL_SC1235:
		{
			stExpAttr.u8AERunInterval = 3;
			
			stAntiFalseColorAttr.enOpType = OP_TYPE_MANUAL;
			stAntiFalseColorAttr.stManual.u8Strength = 16;
			stAntiFalseColorAttr.stManual.u8Threshold = 48;

			stDciParam.bEnable = true;
			stDciParam.u32BlackGain = 0;
			stDciParam.u32ContrastGain = 30;
			stDciParam.u32LightGain = 0;

			stColorToneAttr.u16BlueCastGain = 256;
			stColorToneAttr.u16GreenCastGain = 256;
			stColorToneAttr.u16RedCastGain = 256;
			
			stDRCAttr.u8SecondPole = 170;
			stDRCAttr.u8Stretch = 36;
            stDRCAttr.stManual.u8LocalMixingBright = 50;
            stDRCAttr.stManual.u8LocalMixingDark = 70;
			stDefogAttr.bEnable = 1;
			stDefogAttr.enOpType = OP_TYPE_MANUAL;
			stDefogAttr.stManual.u8strength = 60;

			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));

			}else{
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));

			}
		}
		break;
		case SENSOR_MODEL_SC1135:
		{
			HI_U8 au8FixStrength_0[16]={32,32,35,35,35,35,35,35,35,35,35,35,35,35,35,35};
			HI_U8 au8FixStrength_1[16]={30,30,35,35,35,35,35,35,35,35,35,35,35,35,35,35};

			//2016.07.05 add awb extralight 
			stAWBAttrEx.bExtraLightEn=1;
			stAWBAttrEx.stLightInfo[0].u8LightStatus=1; //shuiyindeng
			stAWBAttrEx.stLightInfo[0].u16WhiteRgain=456;
			stAWBAttrEx.stLightInfo[0].u16WhiteBgain=490;
			stAWBAttrEx.stLightInfo[0].u16ExpQuant=256;

			stAWBAttrEx.stLightInfo[1].u8LightStatus=1; //6500 and shiwai
			stAWBAttrEx.stLightInfo[1].u16WhiteRgain=446;
			stAWBAttrEx.stLightInfo[1].u16WhiteBgain=386;
			stAWBAttrEx.stLightInfo[1].u16ExpQuant=256;
			
			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				memcpy(stNRAttr.stAuto.au8FixStrength,au8FixStrength_0,sizeof(HI_U8)*16);

			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				memcpy(stNRAttr.stAuto.au8FixStrength,au8FixStrength_1,sizeof(HI_U8)*16);

			}
		}
		break;
		case SENSOR_MODEL_SC1145:
		{
			
			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}
		}
		break;
		case SENSOR_MODEL_SC3035:
			{
				
				if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}else{				
					GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
					memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
					stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
					unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
					unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
					unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
				}
			}
		break;
		case SENSOR_MODEL_PS5230:
		{
			
			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}
		}
		break;
		case SENSOR_MODEL_SC2235:
		{
		//	stExpAttr.u8AERunInterval = 3;

			HI_U8 au8Strength[16]={16,16,16,16,8,8,8,8,3,0,0,0,0,0,0,0};
			HI_U8 au8Threshold[16]={48,48,48,48,24,24,24,24,24,24,24,24,24,24,24,24};

			stAntiFalseColorAttr.enOpType = OP_TYPE_AUTO;
			memcpy(stAntiFalseColorAttr.stAuto.au8Strength,au8Strength,sizeof(HI_U8)*16);
			memcpy(stAntiFalseColorAttr.stAuto.au8Threshold,au8Threshold,sizeof(HI_U8)*16);

			stWBAttr.stAuto.u16Speed = 512;

			stDciParam.bEnable = true;
			stDciParam.u32BlackGain = 0;
			stDciParam.u32ContrastGain = 30;
			stDciParam.u32LightGain = 0;

			stDRCAttr.u8SecondPole = 150;
			stDRCAttr.u8Stretch = 37;

		//	stColorToneAttr.u16BlueCastGain = 256;
		//	stColorToneAttr.u16GreenCastGain = 259;
		//	stColorToneAttr.u16RedCastGain = 256;

			stDefogAttr.bEnable = 1;
			stDefogAttr.enOpType = OP_TYPE_MANUAL;
			stDefogAttr.stManual.u8strength = 50;

			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[20], sizeof(gs_Gamma[20]));
			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
			}

		}
		break;
		case SENSOR_MODEL_IMX225:
		{
			stWBAttr.stAuto.bShiftLimitEn =1;
			stWBAttr.stAuto.u8ShiftLimit =90;
			stDCIAttr.bEnable = HI_FALSE;
			
			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}
		}
		break;
		case SENSOR_MODEL_SC2135:
		{
            HI_U16 au16CbMax[16]={0x150,0x150,0x150,0x150,0x150,0x150,0x170,0x1B0,0x230,0x330,0x400,0x400,0x400,0x400,0x400,0x400};
            HI_U16 au16CbMin[16]={0x40,0x40,0x40,0x40,0x40,0x40,0x3D,0x37,0x2B,0x18,0x18,0x18,0x18,0x18,0x18,0x18};
            memcpy(stWBAttr.stAuto.stCbCrTrack.au16CbMax,au16CbMax,sizeof(HI_U16)*16);
            memcpy(stWBAttr.stAuto.stCbCrTrack.au16CbMin,au16CbMin,sizeof(HI_U16)*16);

			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[10], sizeof(gs_Gamma[10]));
			}
		}
		break;
		case SENSOR_MODEL_PS5270:
		{
            stColorToneAttr.u16RedCastGain = 256;
            stColorToneAttr.u16GreenCastGain = 266;
            stColorToneAttr.u16BlueCastGain = 272;

			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}else{
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}
		}
		break;
		case SENSOR_MODEL_IMX291:
		{
			
			if(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT){//daytime	
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}else{				
				GammaAttr.enCurveType = ISP_GAMMA_CURVE_USER_DEFINE;
				memcpy(GammaAttr.u16Table, gs_Gamma[9], sizeof(gs_Gamma[9]));
				stExpAttr.stAuto.u8Compensation = isp_get_isp_strength_value(&_isp_attr.aeCompensition);			
				unNrParam.stNRParam_V1.s32YPKStr = isp_get_3DNR_YPK_strength_value(&_isp_attr.YPKStrength);
				unNrParam.stNRParam_V1.s32YSFStr = isp_get_3DNR_YSF_strength_value(&_isp_attr.YSFStrength);
				unNrParam.stNRParam_V1.s32YTFStr = isp_get_3DNR_YTF_strength_value(&_isp_attr.YTFStrength);
			}
		}
		break;
		case SENSOR_MODEL_SC2232:
		{
			stDefogAttr.bEnable = HI_TRUE;
			stDefogAttr.enOpType = OP_TYPE_MANUAL;
			stDefogAttr.stManual.u8strength = 50;
		}

		break;
		
	}
	
	SOC_CHECK(HI_MPI_ISP_SetExposureAttr(0,&stExpAttr));
    SOC_CHECK(HI_MPI_VPSS_SetNRParam(0, &unNrParam));
	SOC_CHECK(HI_MPI_ISP_SetGammaAttr(0, &GammaAttr));
	SOC_CHECK(HI_MPI_ISP_SetNRAttr(0, &stNRAttr));
	SOC_CHECK(HI_MPI_ISP_SetDemosaicAttr(0,&stDemosaicAttr));
	SOC_CHECK(HI_MPI_ISP_SetDPDynamicAttr(0,&stDPDynamicAttr));
	SOC_CHECK(HI_MPI_ISP_SetSharpenAttr(0,&stSharpenAttr));
	SOC_CHECK(HI_MPI_ISP_SetCrosstalkAttr(0,&stCRAttr));
	SOC_CHECK(HI_MPI_ISP_SetMeshShadingAttr(0,&stShadingAttr));
	SOC_CHECK(HI_MPI_ISP_SetAntiFalseColorAttr(0,&stAntiFalseColorAttr));
	SOC_CHECK(HI_MPI_ISP_SetSaturationAttr(0,&stSaturationAttr));	
	SOC_CHECK(HI_MPI_ISP_SetAWBAttrEx(0,&stAWBAttrEx));
	SOC_CHECK(HI_MPI_ISP_SetWBAttr(0,&stWBAttr));
	SOC_CHECK(HI_MPI_VI_SetDCIParam(0, &stDCIAttr));
	SOC_CHECK(HI_MPI_ISP_SetDRCAttr(0,&stDRCAttr));
	SOC_CHECK(HI_MPI_ISP_SetDeFogAttr(0,&stDefogAttr));
	SOC_CHECK(HI_MPI_ISP_SetColorToneAttr(0,&stColorToneAttr));
	SOC_CHECK(HI_MPI_VI_SetDCIParam(0, &stDciParam));
	
	return 0;
}

int HI_SDK_ISP_ini_load(const char *filepath)
{
	if(NULL == _isp_attr.ispCfgAttr){
		_isp_attr.ispCfgAttr = (LpIspCfgAttr)calloc(sizeof(StIspCfgAttr), 1);
	}
	if(-1 == HI_ISP_cfg_load(filepath, _isp_attr.ispCfgAttr)){
		if(_isp_attr.ispCfgAttr){
			free(_isp_attr.ispCfgAttr);
		}
		_isp_attr.ispCfgAttr = NULL;
		return -1;
	}else{
		_isp_attr.ispCfgAttr->impCfgAttr.AutoSlowFrameRate = _isp_attr.lowlight_mode == ISP_LOWLIGHT_MODE_AUTO ? true : false;
		_isp_attr.ispCfgAttr->impCfgAttr.flick_frequency = _isp_attr.filter_frequency;
		isp_ircut_contrl_init();
		return HI_ISP_cfg_set_all(_isp_attr.gpio_status_old == ISP_GPIO_DAYLIGHT ? 0 : 1, 1, _isp_attr.ispCfgAttr);
	}
	
}


int HI_SDK_ISP_get_wdr_mode(uint8_t *bEnable)
{
	ISP_WDR_MODE_S stWdrMode;
	ISP_DRC_ATTR_S pstDRC;
			    
	if(_isp_attr.sensor_type == SENSOR_MODEL_OV_OV4689 
		|| _isp_attr.sensor_type == SENSOR_MODEL_MN34220)
	{		
		SOC_CHECK(HI_MPI_ISP_GetWDRMode(HI3518A_VIN_DEV, &stWdrMode));
		if (stWdrMode.enWDRMode)  //wdr mode
		{	
			*bEnable = 1;
		}else{
			*bEnable = 0;
		}
	}else{	
		SOC_CHECK(HI_MPI_ISP_GetDRCAttr(0,&pstDRC));		
		*bEnable = pstDRC.bEnable;
	}
	
	return 0;

}

static int float2int(float fVal)
{
    float retVal = 0.0f;

    retVal = fVal + ((fVal >= 0.0f) ? (0.50f) : (-0.50f));

    return (int)retVal;

}

int HI_SDK_ISP_get_cur_fps()
{
    float vi_fps;
    ISP_EXP_INFO_S stExpInfo;
    ISP_PUB_ATTR_S stPubAttr;
    VENC_CHN_ATTR_S venc_ch_attr;
    int i_cur_fps;
    float f_cur_fps;
    float val;
    float dstFrmRate;
    float srcFrmRate;
    SOC_CHECK(HI_MPI_ISP_QueryExposureInfo(0, &stExpInfo));
    SOC_CHECK(HI_MPI_VENC_GetChnAttr(0, &venc_ch_attr));
    switch(venc_ch_attr.stRcAttr.enRcMode) {
        default:
        case VENC_RC_MODE_H264VBR:
        {
            dstFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264Vbr.fr32DstFrmRate;
            srcFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264Vbr.u32SrcFrmRate;
            break;
        }
        case VENC_RC_MODE_H264CBR:
        {
            dstFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264Cbr.fr32DstFrmRate;
            srcFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264Cbr.u32SrcFrmRate;
            break;
        }
        case VENC_RC_MODE_H264ABR:
        {
           dstFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264Abr.fr32DstFrmRate;
           srcFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264Abr.u32SrcFrmRate;
        break;
        }
        case VENC_RC_MODE_H264FIXQP:
        {
            dstFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264FixQp.fr32DstFrmRate;
            srcFrmRate = (float)venc_ch_attr.stRcAttr.stAttrH264FixQp.u32SrcFrmRate;
        break;
        }
    }

    /* stExpInfo.u32Fps / 100 * (dstFrmRate / srcFrmRate) */
    val = dstFrmRate / srcFrmRate;
    vi_fps = stExpInfo.u32Fps / 100;
    if(srcFrmRate <= vi_fps) {
        f_cur_fps = srcFrmRate * val;
    }
    else {
        f_cur_fps = vi_fps * val;
    }
    i_cur_fps = float2int(f_cur_fps);

    return i_cur_fps;

}

static stHiIspAttr _isp_attr = {
	.api = {
		.SENSOR_MODEL_GET=hi_isp_api_get_sensor_model,
		.MIRROR_FLIP_SET=hi_isp_api_mirror_flip,
		.HUE_SET=hi_isp_api_set_hue,
		.CONTRAST_SET=hi_isp_api_set_contrast,
		.BRIGHTNESS_SET=hi_isp_api_set_brightness,
		.SATURATION_SET=hi_isp_api_set_saturation,
		.LIGHT_MODE_SET=hi_isp_api_light_mode,
		.TEST_MODE_SET=hi_isp_api_test_mode,
		.COLOR_MODE_SET=hi_isp_api_color_mode,
		.REG_READ=hi_isp_api_reg_read,
	 	.REG_WRITE=hi_isp_api_reg_write,
		.SPEC_RED_WRITE=hi_isp_api_spec_reg_write,
		.SPEC_REG_READ=hi_isp_api_spec_reg_read,
		.GET_COLOR_MAX_VALUE=hi_isp_api_get_color_max_value,
		.SHUTTER_SET=hi_isp_api_set_shutter,
		.IRCUT_AUTO_SWITCH=hi_isp_api_ircut_auto_switch,
		.VI_FLICKER=hi_isp_api_vi_flicker,
		.SHARPEN_SET=hi_isp_api_set_sharpen,
		.SHARPEN_GET=hi_isp_api_get_sharpen,
		.SCENE_MODE_SET=hi_isp_api_set_scene_mode,
		.WB_MODE_SET=hi_isp_api_set_WB_mode,
		.IRCUT_CONTROL_MODE_SET=hi_isp_api_set_ircut_control_mode,
		.IRCUT_MODE_SET=hi_isp_api_set_ircut_mode,
		.WDR_MODE_ENABLE=hi_isp_api_set_WDR_enable,
		.WDR_STRENGTH_SET=hi_isp_api_set_WDR_strength,
		.EXPOSURE_MODE_SET=hi_isp_api_set_exposure_mode,
		.AE_COMPENSATION_SET=hi_isp_api_set_AEcompensation,
		.DENOISE_ENABLE=hi_isp_api_set_denoise_enable,
		.DENOISE_STRENGTH_SET=hi_isp_api_set_denoise_strength,
		.DENOISE_STRENGTH_GET=hi_isp_api_get_denoise_strength,
		.ANTI_FOG_ENABLE=hi_isp_api_set_anti_fog_enable,
		.LOWLIGHT_ENABLE=hi_isp_api_set_lowlight_enable,
		.GAMMA_TABLE_SET=hi_isp_api_set_gamma_table,
		.DEFECT_PIXEL_ENABLE=hi_isp_api_set_defect_pixel_enable,
		.SRC_FRAMERATE_SET=hi_isp_api_set_src_framerate,
		.SENSOR_RESOLUTION_GET=hi_isp_api_get_sensor_resolution,
		.SENSOR_RESOLUTION_SET=hi_isp_api_set_sensor_resolution,
		.GAIN_GET=hi_isp_api_get_gain,
		.AF_CALLBACK_SET = hi_isp_api_set_af_attr,
		.INI_LOAD=hi_isp_api_ini_load,	
		.WDR_MODE_GET= hi_isp_api_get_wdr_mode,
		.GET_CUR_FPS = hi_isp_api_get_cur_fps,
		.DAYNIGHT_MODE_GET      = hi_isp_api_get_daynight_mode,
	},
	.sensor_type = SENSOR_MODEL_APTINA_AR0130,
	.gpio_status_old = ISP_GPIO_DAYLIGHT,// ISP_GPIO_DAYLIGHT;//daytime
	.color_max_value = {
		.HueMax = 100,
		.SaturationMax = 100,
		.ContrastMax = 100,
		.BrightnessMax = 100,
	},
	.ircut_auto_switch_enable = HI_TRUE,// HI_TRUE;
	.ircut_switch_control_mode = IRLED_CONTROL_MODE,
	.lowlight_mode = 0,
	.isp_auto_drc_enabled = HI_TRUE,
	.AfAttr.param = NULL,
	.AfAttr.af_callback = NULL,
	.isp_framerate_status = HI_FALSE,
	.filter_frequency = 50,
	.md_lock = HI_TRUE,
	.md_alarm_pid = NULL,
	.isp_run_pid = NULL,
	.awb_cal_pid = NULL,
};

static HI_VOID* ISP_Thread_Run(HI_VOID *param)
{
 //   ISP_DEV IspDev = 0;
    SOC_CHECK(HI_MPI_ISP_Run(HI3518A_VIN_DEV));

    return HI_NULL;
}

#if 0
static HI_S32 pfunction_af_init(HI_S32 s32Handle, const ISP_AF_PARAM_S *pstAfParam)
{
	if (HI_NULL == pstAfParam)
    {
        printf("null pointer when af init default value!\n");
        return -1;
    }

	return 0;
}

static HI_S32 pfunction_af_run(HI_S32 s32Handle, const ISP_AF_INFO_S *pstAfInfo, ISP_AF_RESULT_S *pstAfResult, HI_S32 s32Rsv)
{
	/*printf("u32FrameCnt = %d\r\n"
		"u16FocusMetrics = %d\r\n"
		"u16ThresholdRead = %d\r\n"
		"u16ThresholdWrite = %d\r\n"
		"u16FocusIntensity = %d\r\n"
		"u8MetricsShift = %d\r\n"
		"bChange = %d\r\n"
		"u16ThresholdWrite = %d\r\n"
		"u8MetricsShift = %d\r\n"
		"u8NpOffset = %d\r\n",
		pstAfInfo->u32FrameCnt,
		pstAfInfo->pstStatistics->u16FocusMetrics,
		pstAfInfo->pstStatistics->u16ThresholdRead, 
		pstAfInfo->pstStatistics->u16ThresholdWrite,
		pstAfInfo->pstStatistics->u16FocusIntensity,
		pstAfInfo->pstStatistics->u8MetricsShift,
		pstAfResult->stStatAttr.bChange,
		pstAfResult->stStatAttr.u16ThresholdWrite,
		pstAfResult->stStatAttr.u8MetricsShift,
		pstAfResult->stStatAttr.u8NpOffset);*/
	int ret = 0;
	if(NULL != _isp_attr.AfAttr.af_callback){
		//printf("sock=%d\r\n", *_isp_attr.AfAttr.param);
		ret = _isp_attr.AfAttr.af_callback((int)pstAfInfo->pstStatistics->u16FocusMetrics, _isp_attr.AfAttr.param);
		if(ret< 0){
			if(_isp_attr.AfAttr.param){
				free(_isp_attr.AfAttr.param);
				_isp_attr.AfAttr.param = NULL;
				_isp_attr.AfAttr.af_callback = NULL;
			}
		}
		
	}

		//printf("u16FocusMetrics =%d-%d\r\n", pstAfInfo->pstStatistics->u16FocusMetrics, pstAfResult->stStatAttr.bChange);
	return 0;
}

static HI_S32 pfunctin_af_ctrl(HI_S32 s32Handle, HI_U32 u32Cmd, HI_VOID *pValue)
{
	return 0;
}

static HI_S32 pfunction_af_exit(HI_S32 s32Handle)
{
	return 0;
}

static int isp_af_init_function(	ISP_AF_REGISTER_S *pAfRegister)
{
	memset(&pAfRegister->stAfExpFunc, 0, sizeof(ISP_AF_EXP_FUNC_S));
	pAfRegister->stAfExpFunc.pfn_af_init = pfunction_af_init;
	pAfRegister->stAfExpFunc.pfn_af_ctrl= pfunctin_af_ctrl;
	pAfRegister->stAfExpFunc.pfn_af_run = pfunction_af_run;
	pAfRegister->stAfExpFunc.pfn_af_exit = pfunction_af_exit;
}

#endif
#define ISP_AWB_CAL_STABLE_CNT (2)
#define ISP_AWB_CAL_VALUE_MIN	(40)
#define ISP_AWB_CAL_VALUE_INTERVAL	(100)
#define ISP_VALUE_IS_STABLE(src, dst) \
	ABS(((src)-(dst)))> ISP_AWB_CAL_VALUE_INTERVAL ? false:true

#define THRESHOLD_RGB (2500)
#define RGB_DEAL_AMOUNT (16)
#define RGB_DEAL_SLOPE (0.4)
#define WEIGHT_RGB(val, threshold, slope) \
						(val) > (threshold) ? ((val)*(slope)) : (val)
		
static HI_U16 isp_bayer_area_deal(HI_U16 rgb_val, uint8_t *count_val)
{
	if(rgb_val > THRESHOLD_RGB){
		if(*count_val < RGB_DEAL_AMOUNT){
			rgb_val = WEIGHT_RGB(rgb_val, THRESHOLD_RGB, RGB_DEAL_SLOPE);
			*count_val=*count_val + 1;
		}
	}
	return rgb_val;
}

static ISP_WB_BAYER_STATISTICS_INFO_S isp_deal_bayer_rgb(ISP_STATISTICS_S *RGB_VAL)
{
	uint8_t count_val_r = 0, count_val_g = 0, count_val_b = 0;
	long count_r = 0, count_g = 0, count_b = 0;
	int ii = 0, jj = 0;
	for (jj = 0; jj < AWB_ZONE_ROW; ++jj){
		for (ii = 0; ii < AWB_ZONE_COLUMN; ++ii){
			
			RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgR[jj][ii] = isp_bayer_area_deal(RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgR[jj][ii], &count_val_r);
			RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgG[jj][ii] = isp_bayer_area_deal(RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgG[jj][ii], &count_val_g);
			RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgB[jj][ii] = isp_bayer_area_deal(RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgB[jj][ii], &count_val_b);
			
			count_r += RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgR[jj][ii];
			count_g += RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgG[jj][ii];
			count_b += RGB_VAL->stWBStat.stBayerStatistics.au16ZoneAvgB[jj][ii];
		}
	}
	
	RGB_VAL->stWBStat.stBayerStatistics.u16GlobalR = count_r/(15*17);
	RGB_VAL->stWBStat.stBayerStatistics.u16GlobalG = count_g/(15*17);
	RGB_VAL->stWBStat.stBayerStatistics.u16GlobalB = count_b/(15*17);

	return RGB_VAL->stWBStat.stBayerStatistics;
}

static void* isp_awb_bayer_cal(void* param)
{
	//pthread_detach(pthread_self());
	ISP_STATISTICS_S stBayerInfo;
	int stable_cnt = 0;
	uint16_t globalR=0, globalG=0, globalB=0;
	uint8_t i = 2;
	ircut_state_info.Bayer_flag = false;

    ISP_EXP_INFO_S stIsoInfo;
	ISP_WB_INFO_S pstWBColorTempInfo;
	uint32_t globalISO = 0;
	uint16_t globalColorTemp = 0;
	uint8_t globalAveLum;
	ISP_PUB_ATTR_S stPubAttr;
	float max_exposure_time = 0, cur_exposure_time = 0, cur_gain = 0;	
	while(_isp_attr.awb_thread_trigger)
	{
		SOC_CHECK(HI_MPI_ISP_GetStatistics(0,&stBayerInfo));
		SOC_CHECK(HI_MPI_ISP_QueryExposureInfo(0,&stIsoInfo));
		SOC_CHECK(HI_MPI_ISP_QueryWBInfo(0,&pstWBColorTempInfo));
		SOC_CHECK(HI_MPI_ISP_GetPubAttr(0,&stPubAttr));
		isp_deal_bayer_rgb(&stBayerInfo);

		if(ISP_VALUE_IS_STABLE(stBayerInfo.stWBStat.stBayerStatistics.u16GlobalR, globalR) &&
			ISP_VALUE_IS_STABLE(stBayerInfo.stWBStat.stBayerStatistics.u16GlobalG, globalG) &&
			ISP_VALUE_IS_STABLE(stBayerInfo.stWBStat.stBayerStatistics.u16GlobalB, globalB) &&
			stBayerInfo.stWBStat.stBayerStatistics.u16GlobalR > ISP_AWB_CAL_VALUE_MIN &&
			stBayerInfo.stWBStat.stBayerStatistics.u16GlobalG > ISP_AWB_CAL_VALUE_MIN &&
			stBayerInfo.stWBStat.stBayerStatistics.u16GlobalB > ISP_AWB_CAL_VALUE_MIN){
			stable_cnt++;
		}else{
			stable_cnt = 0;
		}
		
		globalR = stBayerInfo.stWBStat.stBayerStatistics.u16GlobalR;
		globalG = stBayerInfo.stWBStat.stBayerStatistics.u16GlobalG;
		globalB = stBayerInfo.stWBStat.stBayerStatistics.u16GlobalB;
		globalISO = stIsoInfo.u32ISO;
		globalColorTemp = pstWBColorTempInfo.u16ColorTemp;
		globalAveLum = stIsoInfo.u8AveLum;

		max_exposure_time = 1/stPubAttr.f32FrameRate * 1000;
		cur_exposure_time = stIsoInfo.u32ExpTime/1000;
		cur_gain = gains_calculate()/1024;
		ircut_state_info.cur_expose_factor = cur_exposure_time / max_exposure_time * cur_gain;
		ircut_state_info.u8AveLum = globalAveLum;

		if(i == 2){
			i = 0;
			//SYSTEM("echo 'ISO<%d><GAIN:%f><LUM:%d>\tColorTemp<%d>\tR|%d|\tG|%d|\tB|%d|\tR/G[%f]\tB/G[%f]\r' > %s\n",globalISO,ircut_state_info.cur_expose_factor,globalAveLum,globalColorTemp,globalR,globalG,globalB,(float)globalR/globalG,(float)globalB/globalG,"/media/conf/bayer_log.txt");
		}

		if(stable_cnt >= ISP_AWB_CAL_STABLE_CNT){
			//bayer value is stable
			ircut_state_info.u16GlobalR = globalR;
			ircut_state_info.u16GlobalG = globalG;
			ircut_state_info.u16GlobalB = globalB;
			ircut_state_info.Bayer_flag = true;
		}
		ircut_state_info.u16ColorTemp = globalColorTemp;
		usleep(500000);//500ms
		i ++;
	}
	pthread_exit(0);
}

static void mpp_vb_conf_clear(VB_CONF_S* p_vb_conf)
{
	p_vb_conf->u32MaxPoolCnt = 0;
}

static int mpp_vb_conf_add_block(VB_CONF_S* p_vb_conf, int block_size, int block_count)
{
	if(p_vb_conf->u32MaxPoolCnt < VB_MAX_COMM_POOLS){
		p_vb_conf->astCommPool[p_vb_conf->u32MaxPoolCnt].u32BlkSize = block_size;
		p_vb_conf->astCommPool[p_vb_conf->u32MaxPoolCnt].u32BlkCnt = block_count;
		++p_vb_conf->u32MaxPoolCnt;
		return 0;
	}
	return -1;
}

static void hi_mpp_vb_destroy()
{
#if 1//fix audio niose in P2/P3/P4
	HI_U32 reg_val;
	char cmd[128];
	if(sdk_sys){
		sdk_sys->read_reg(0x201200c8, &reg_val);
	}
#endif
	HI_MPI_SYS_Exit();
#if 1//fix audio niose in P2/P3/P4
	snprintf(cmd, sizeof(cmd), "himm 0x201200c8 0x%x", (reg_val&0x00ffffff)|0x20000000);//bit[29] = 1
	system(cmd);
#endif

	HI_MPI_VB_Exit();
}

static void HI_SDK_mpp_vb_init(HI_U32 width, HI_U32 height)
{
	MPP_SYS_CONF_S sys_conf;
	VB_CONF_S vb_conf;
	hi_mpp_vb_destroy();
	memset(&vb_conf, 0, sizeof(vb_conf));
	mpp_vb_conf_clear(&vb_conf);

#if defined(HI3518E_V2)
	if(width * height <=  1280 * 960){
		mpp_vb_conf_add_block(&vb_conf, 1280 * 960 * 3/2 + 48, 3);//main stream&main jpeg
		mpp_vb_conf_add_block(&vb_conf, 720 * 576 * 3/2 + 100, 3);//sub stream&sub jpeg
		mpp_vb_conf_add_block(&vb_conf, 352 * 288 * 3/2 + 100, 4);//md
	}else if(width * height <=  1920 * 1080){
#if defined(HI3518EV2_MODEL)
		mpp_vb_conf_add_block(&vb_conf, 1920 * 1080 * 3/2 + 48, 2);//main stream&main jpeg
		mpp_vb_conf_add_block(&vb_conf, 720 * 576 * 3/2 + 100, 3);//sub stream&sub jpeg
		mpp_vb_conf_add_block(&vb_conf, 352 * 288 * 3/2 + 100, 4);//md
#else//PX product
		mpp_vb_conf_add_block(&vb_conf, 1920 * 1080 * 3/2 + 48, 1);//main stream
		mpp_vb_conf_add_block(&vb_conf, 640 * 480 * 3/2 + 100, 3);//sub stream&sub jpeg
		mpp_vb_conf_add_block(&vb_conf, 352 * 288 * 3/2 + 100, 4);//md
#endif
	}else if(width * height <=  1536 * 1536){
		mpp_vb_conf_add_block(&vb_conf, 1536 * 1536 * 3/2 + 48, 1);//main stream
		mpp_vb_conf_add_block(&vb_conf, 320 * 320 * 3/2 + 100, 6);//sub stream&sub jpeg&md
	}else{
		mpp_vb_conf_add_block(&vb_conf, 1920 * 1080 * 3/2 + 48, 2);//main stream&main jpeg
		mpp_vb_conf_add_block(&vb_conf, 720 * 576 * 3/2 + 100, 4);//sub stream&sub jpeg
		mpp_vb_conf_add_block(&vb_conf, 352 * 288 * 3/2, 4);//md
	}
#elif defined(HI3516C_V2)

	if(width * height <=  1920 * 1080){
		mpp_vb_conf_add_block(&vb_conf, 1920 * 1080 * 3/2 + 48, 5);
		mpp_vb_conf_add_block(&vb_conf, 720 * 576 * 3/2 + 100, 4);
		mpp_vb_conf_add_block(&vb_conf, 352 * 288 * 3/2 + 100, 4);
	
	}else{
		mpp_vb_conf_add_block(&vb_conf, 1920 * 1080 * 3/2 + 48, 5);
		mpp_vb_conf_add_block(&vb_conf, 720 * 576 * 3/2 + 100, 4);
		mpp_vb_conf_add_block(&vb_conf, 352 * 288 * 3/2 + 100, 4);
	}

#endif

	SOC_CHECK(HI_MPI_VB_SetConf(&vb_conf));
	SOC_CHECK(HI_MPI_VB_Init());
	memset(&sys_conf, 0, sizeof(sys_conf));
    sys_conf.u32AlignWidth = 64;
    SOC_CHECK(HI_MPI_SYS_SetConf(&sys_conf));
    SOC_CHECK(HI_MPI_SYS_Init());
}


int HI_SDK_ISP_init(lpSensorApi*api, lpBSPApi *bsp_api)
{
//	pthread_t isp_tid = 0;
	VI_DEV_ATTR_S vi_dev_attr_720p_30fps;
//	VI_DEV_ATTR_EX_S vi_dev_attr_720p_30fps;

	ISP_PUB_ATTR_S stPubAttr;
	VI_CHN_ATTR_S stChnAttr;
	VPSS_GRP_ATTR_S stVpssGrpAttr;
	VPSS_CHN_MODE_S stVpssChnMode;
	ISP_WDR_MODE_S stWdrMode;	
	memcpy(&_isp_attr.bsp_api, bsp_api, sizeof(stBSPApi));
	HI_SDK_ISP_sensor_check();
//	isp_af_init_function(&stAfRegister);

	memset(&stVpssGrpAttr, 0, sizeof(stVpssGrpAttr));
	//init sensor
	//printf("sensor type:%d\r\n", _isp_attr.sensor_type);
	switch(_isp_attr.sensor_type){
		default:
		case SENSOR_MODEL_APTINA_AR0130:
			APTINA_AR0130_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_AR0130(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution =AR0130_get_resolution;
			_isp_attr.sensor_get_name = AR0130_get_sensor_name;
			break;
		case SENSOR_MODEL_APTINA_AR0230:
			APTINA_AR0230_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_AR0230(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = AR0230_get_resolution;
			_isp_attr.sensor_get_name = AR0230_get_sensor_name;
			break;
		case SENSOR_MODEL_SMARTSENS_SC2035:
			SmartSens_SC2035_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC2035(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC2035_get_resolution;
			_isp_attr.sensor_get_name = SC2035_get_sensor_name;
			break;
		case SENSOR_MODEL_APTINA_AR0237:
			APTINA_AR0237_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_AR0237(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = AR0237_get_resolution;
			_isp_attr.sensor_get_name = AR0237_get_sensor_name;
			break;
		case SENSOR_MODEL_SMARTSENS_SC2045:
			SmartSens_SC2045_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC2045(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC2045_get_resolution;
			_isp_attr.sensor_get_name = SC2045_get_sensor_name;
			break;
		case SENSOR_MODEL_SC1035:
			SmartSens_SC1035_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC1035(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC1035_get_resolution;
			_isp_attr.sensor_get_name = SC1035_get_sensor_name;
			break;
		case SENSOR_MODEL_SC1045:
			SmartSens_SC1045_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC1045(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC1045_get_resolution;
			_isp_attr.sensor_get_name = SC1045_get_sensor_name;
			break;
		case SENSOR_MODEL_SC1235:
			SmartSens_SC1235_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC1235(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC1235_get_resolution;
			_isp_attr.sensor_get_name = SC1235_get_sensor_name;
			break;
		case SENSOR_MODEL_SC1135:
			SmartSens_SC1135_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC1135(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC1135_get_resolution;
			_isp_attr.sensor_get_name = SC1135_get_sensor_name;
			break;
		case SENSOR_MODEL_SC1145:
			SmartSens_SC1145_init(NULL, NULL); 
			SET_VI_DEV_ATTR_SC1145(vi_dev_attr_720p_30fps);

			_isp_attr.sensor_set_mirror = SC1145_set_mirror;  //mirror
			_isp_attr.sensor_set_flip = SC1145_set_flip;      // flip
			_isp_attr.sensor_get_resolution = SC1145_get_resolution;
			_isp_attr.sensor_get_name = SC1145_get_sensor_name;
			break;
		case SENSOR_MODEL_SC3035:
			SmartSens_SC3035_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC3035(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = SC3035_get_resolution;
			_isp_attr.sensor_get_name = SC3035_get_sensor_name;
			break;
		case SENSOR_MODEL_PS5270:
			SmartSens_PS5270_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_PS5270(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = PS5270_get_resolution;
			_isp_attr.sensor_get_name = PS5270_get_sensor_name;
			break;
		case SENSOR_MODEL_SC2135:
			SmartSens_SC2135_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_SC2135(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_set_mirror = SC2135_set_mirror;  //mirror
			_isp_attr.sensor_set_flip = SC2135_set_flip;      // flip
			_isp_attr.sensor_get_resolution = SC2135_get_resolution;
			_isp_attr.sensor_get_name = SC2135_get_sensor_name;
			break;
		case SENSOR_MODEL_SC2235:
			SmartSens_SC2235_init(NULL, NULL); 
			SET_VI_DEV_ATTR_SC2235(vi_dev_attr_720p_30fps);			
			_isp_attr.sensor_set_mirror = SC2235_set_mirror;  //mirror
			_isp_attr.sensor_set_flip = SC2235_set_flip;      // flip
			_isp_attr.sensor_get_resolution = SC2235_get_resolution;
			_isp_attr.sensor_get_name = SC2235_get_sensor_name;
			break;
		case SENSOR_MODEL_IMX225:
			SONY_IMX225_init(NULL, NULL);		
			SET_VI_DEV_ATTR_IMX225(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = IMX225_get_resolution;
			_isp_attr.sensor_get_name = IMX225_get_sensor_name;
			break;
		case SENSOR_MODEL_IMX291:
			SONY_IMX291_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_IMX291(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = IMX291_get_resolution;
			_isp_attr.sensor_get_name = IMX291_get_sensor_name;
			break;
		case SENSOR_MODEL_PS5230:
			PrimeSensor_PS5230_init(NULL, NULL); //&stAfRegister
			SET_VI_DEV_ATTR_PS5230(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_get_resolution = PS5230_get_resolution;
			_isp_attr.sensor_get_name = PS5230_get_sensor_name;
			break;
		case SENSOR_MODEL_SC2232:
			SmartSens_SC2232_init(NULL,NULL);
			SET_VI_DEV_ATTR_SC2232(vi_dev_attr_720p_30fps);
			_isp_attr.sensor_set_mirror = SC2232_set_mirror;  //mirror
			_isp_attr.sensor_set_flip = SC2232_set_flip;      // flip
			_isp_attr.sensor_get_resolution = SC2232_get_resolution;
			_isp_attr.sensor_get_name = SC2232_get_sensor_name;
			break;
	}

	HI_SDK_ISP_set_sensor_resolution(0, 0);//get sensor default resolution
	

	switch(_isp_attr.sensor_type){		
		default:
		case SENSOR_MODEL_APTINA_AR0130:
		case SENSOR_MODEL_APTINA_AR0230:
		case SENSOR_MODEL_APTINA_AR0237:
			stPubAttr.enBayer	   = BAYER_GRBG;
			stPubAttr.f32FrameRate			= 25;
        	break;
		case SENSOR_MODEL_SONY_IMX122:
			stPubAttr.enBayer	   = BAYER_RGGB;
			stPubAttr.f32FrameRate			= 25;
        	break;
		case SENSOR_MODEL_SC2135:
		case SENSOR_MODEL_SC1145:
		case SENSOR_MODEL_SC1135:
		case SENSOR_MODEL_SC1045:
		case SENSOR_MODEL_SC1035:	
		case SENSOR_MODEL_SC1235:		
		case SENSOR_MODEL_SC2235:
		case SENSOR_MODEL_SC2232:	
		case SENSOR_MODEL_SMARTSENS_SC2035:
		case SENSOR_MODEL_SMARTSENS_SC2045:		
			stPubAttr.enBayer	   = BAYER_BGGR;
			stPubAttr.f32FrameRate			= 25;
			break;
        case SENSOR_MODEL_SC3035:
			stPubAttr.enBayer	   = BAYER_BGGR;
			stPubAttr.f32FrameRate			= 13;
        	break;
		case SENSOR_MODEL_PS5270:
			stPubAttr.enBayer	   = BAYER_BGGR;
			stPubAttr.f32FrameRate			= 13;
			break;
        case SENSOR_MODEL_IMX225:
		case SENSOR_MODEL_IMX291:
			stPubAttr.enBayer	   = BAYER_GBRG;
			stPubAttr.f32FrameRate			= 25;
       		break;
        case SENSOR_MODEL_PS5230:
			stPubAttr.enBayer	   = BAYER_BGGR;
			stPubAttr.f32FrameRate			= 25;
        	break;
	}	

	stPubAttr.stWndRect.s32X		= 0;
	stPubAttr.stWndRect.s32Y		= 0;
	stPubAttr.stWndRect.u32Width	= _isp_attr.sensor_resolution_width;
	stPubAttr.stWndRect.u32Height	= _isp_attr.sensor_resolution_height;
	
	stChnAttr.stCapRect.s32X = 0;
	stChnAttr.stCapRect.s32Y = 0;
	stChnAttr.stCapRect.u32Width  = _isp_attr.sensor_resolution_width;
	stChnAttr.stCapRect.u32Height = _isp_attr.sensor_resolution_height;
	stChnAttr.stDestSize.u32Width = _isp_attr.sensor_resolution_width;
	stChnAttr.stDestSize.u32Height = _isp_attr.sensor_resolution_height;
	
	stVpssGrpAttr.u32MaxW = _isp_attr.sensor_resolution_width;
	stVpssGrpAttr.u32MaxH = _isp_attr.sensor_resolution_height;
	
	stVpssChnMode.u32Width		 = _isp_attr.sensor_resolution_width;		
	stVpssChnMode.u32Height 	 = _isp_attr.sensor_resolution_height;
	
	stWdrMode.enWDRMode  = WDR_MODE_NONE;

	int enc_width,enc_height;	
	
	enc_width = _isp_attr.sensor_resolution_width;
	enc_height = _isp_attr.sensor_resolution_height;
	
#if defined(HI3518E_V2)	
	if(-1 != access(MAIN_RESOLUTION, F_OK)){//exist
		
		FILE *fid = fopen(MAIN_RESOLUTION, "rb");
		char buf[16] = "";
		char tmp[5] = "";		
		int width,height;
		
		if(NULL != fid){	
			fread(buf,sizeof(buf),1,fid);
			fclose(fid);
			fid = NULL;
			sscanf(buf,"%d %s %d",&width,tmp,&height);
			printf("width x height = %d %s %d \n",width, tmp, height);
			
			if(width >= 720 && width <=_isp_attr.sensor_resolution_width &&
				height >= 576 && height <= _isp_attr.sensor_resolution_height){		

				if(_isp_attr.sensor_resolution_width >= 1920 && _isp_attr.sensor_resolution_height >= 1080 &&
					width < 1920 && height <= 1080 ){
					stPubAttr.stWndRect.u32Width	 = 1280;
					stPubAttr.stWndRect.u32Height	  = 960;
					
					stChnAttr.stCapRect.u32Width  = 1280;
					stChnAttr.stCapRect.u32Height = 960;
					stChnAttr.stDestSize.u32Width = 1280;
					stChnAttr.stDestSize.u32Height = 960;
					
					stVpssGrpAttr.u32MaxW = 1280;
					stVpssGrpAttr.u32MaxH = 960;
									
					stVpssChnMode.u32Width		 = 1280;		
					stVpssChnMode.u32Height 	 = 960;	
				}else{
		
				}
				enc_width = width;
				enc_height = height;

			}else{
				char cmd[50]= "";
				sprintf(cmd, "rm -rf %s",MAIN_RESOLUTION);
				system(cmd);
			}

		}else{

			printf("open %s failed\n",MAIN_RESOLUTION);
		}
	}else{
		char cmd[48];
		snprintf(cmd, sizeof(cmd), "echo %d x %d > %s",stChnAttr.stDestSize.u32Width,stChnAttr.stDestSize.u32Height,MAIN_RESOLUTION);
		system(cmd);
		printf("Create %s !\n",MAIN_RESOLUTION);

	}
#endif
	HI_SDK_mpp_vb_init(enc_width,enc_height);

	_isp_attr.src_framerate = stPubAttr.f32FrameRate ;
	_isp_attr.isp_wdr_mode = stWdrMode.enWDRMode;

	{
		//isp init
		SOC_CHECK(HI_MPI_ISP_MemInit(HI3518A_VIN_DEV));

	/* 6. isp set WDR mode */
	
	SOC_CHECK(HI_MPI_ISP_SetWDRMode(0, &stWdrMode));

    /* 7. isp set pub attributes */
    /* note : different sensor, different ISP_PUB_ATTR_S define.
              if the sensor you used is different, you can change
              ISP_PUB_ATTR_S definition */
		SOC_CHECK(HI_MPI_ISP_SetPubAttr(HI3518A_VIN_DEV, &stPubAttr));
    	SOC_CHECK(HI_MPI_ISP_Init(HI3518A_VIN_DEV));

	//	pthread_t pid;
	    if (0 != pthread_create(&_isp_attr.isp_run_pid, 0, (void* (*)(void*))ISP_Thread_Run, NULL))
	    {
	        printf("%s: create isp running thread failed!\n", __FUNCTION__);
	        return HI_FAILURE;
	    }

	}

	{
		SOC_CHECK(HI_MPI_VI_SetDevAttr(HI3518A_VIN_DEV, &vi_dev_attr_720p_30fps));		
	//	SOC_CHECK(HI_MPI_VI_SetDevAttrEx(HI3518A_VIN_DEV, &vi_dev_attr_720p_30fps));
#if 1
		    SOC_CHECK(HI_MPI_ISP_GetWDRMode(HI3518A_VIN_DEV, &stWdrMode));
		    
		    if (stWdrMode.enWDRMode)  //wdr mode
		    {
		        VI_WDR_ATTR_S stWdrAttr;

		        stWdrAttr.enWDRMode = stWdrMode.enWDRMode;
		        stWdrAttr.bCompress = HI_FALSE;

		        SOC_CHECK(HI_MPI_VI_SetWDRAttr(HI3518A_VIN_DEV, &stWdrAttr));
		    }
#endif

		SOC_CHECK(HI_MPI_VI_EnableDev(HI3518A_VIN_DEV));
	}
	{
	//	VI_CHN_ATTR_S stChnAttr;
	    /* step  5: config & start vicap dev */

	    stChnAttr.enCapSel = VI_CAPSEL_BOTH;
	    stChnAttr.enPixFormat = PIXEL_FORMAT_YUV_SEMIPLANAR_420;   /* sp420 or sp422 */

	    stChnAttr.bMirror = HI_FALSE;
	    stChnAttr.bFlip = HI_FALSE;

	    stChnAttr.s32SrcFrameRate = stPubAttr.f32FrameRate;
	    stChnAttr.s32DstFrameRate = stPubAttr.f32FrameRate;
	    stChnAttr.enCompressMode = COMPRESS_MODE_NONE;

		
		SOC_CHECK(HI_MPI_VI_SetChnAttr(HI3518A_VIN_CHN, &stChnAttr));
		SOC_CHECK(HI_MPI_VI_EnableChn(HI3518A_VIN_CHN));
	}
	{
		VPSS_GRP VpssGrp = 0;		
	    VPSS_CHN VpssChn = 1; //  1
	    VPSS_CHN_ATTR_S stVpssChnAttr;

		stVpssGrpAttr.bIeEn = HI_FALSE;
		stVpssGrpAttr.bNrEn = HI_TRUE;
		stVpssGrpAttr.bHistEn = HI_FALSE;
		stVpssGrpAttr.bDciEn = HI_FALSE;
		stVpssGrpAttr.enDieMode = VPSS_DIE_MODE_NODIE;
		stVpssGrpAttr.enPixFmt = PIXEL_FORMAT_YUV_SEMIPLANAR_420;

		SOC_CHECK(HI_MPI_VPSS_CreateGrp(VpssGrp, &stVpssGrpAttr));
			
	        /*** set vpss param ***/		
	/*	VPSS_NR_PARAM_U unNrParam = {{0}};
        HI_MPI_VPSS_GetNRParam(VpssGrp, &unNrParam);      
        HI_MPI_VPSS_SetNRParam(VpssGrp, &unNrParam);
 */
		SOC_CHECK(HI_MPI_VPSS_StartGrp(VpssGrp));

		MPP_CHN_S stSrcChn;
    	MPP_CHN_S stDestChn;
		stSrcChn.enModId  = HI_ID_VIU;
        stSrcChn.s32DevId = 0;
        stSrcChn.s32ChnId = 0;
    
        stDestChn.enModId  = HI_ID_VPSS;
        stDestChn.s32DevId = VpssGrp;
        stDestChn.s32ChnId = 0;
		
        SOC_CHECK(HI_MPI_SYS_Bind(&stSrcChn, &stDestChn));

		stVpssChnMode.enChnMode 	 = VPSS_CHN_MODE_USER;
		stVpssChnMode.bDouble		 = HI_FALSE;
		stVpssChnMode.enPixelFormat  = PIXEL_FORMAT_YUV_SEMIPLANAR_420;
		stVpssChnMode.enCompressMode = COMPRESS_MODE_NONE;
		memset(&stVpssChnAttr, 0, sizeof(stVpssChnAttr));
		stVpssChnAttr.s32SrcFrameRate = -1;
		stVpssChnAttr.s32DstFrameRate = -1;

		SOC_CHECK(HI_MPI_VPSS_SetChnAttr(VpssGrp, VpssChn, &stVpssChnAttr));
		SOC_CHECK(HI_MPI_VPSS_SetChnMode(VpssGrp, VpssChn, &stVpssChnMode));
		SOC_CHECK(HI_MPI_VPSS_EnableChn(VpssGrp, VpssChn));

	}

	isp_ircut_switch(0);//default for daylight
	_isp_attr.md_alarm_thread_trigger = true;
	pthread_create(&_isp_attr.md_alarm_pid, NULL, isp_md_alarm_cal, NULL);  	
	_isp_attr.awb_thread_trigger = true;
	pthread_create(&_isp_attr.awb_cal_pid, NULL, isp_awb_bayer_cal, NULL);		
	*api = &_isp_attr.api;
	return 0;
}

int HI_SDK_ISP_destroy()
{
     if(_isp_attr.ispCfgAttr){
          free(_isp_attr.ispCfgAttr);
     }

	 SOC_CHECK(HI_MPI_VI_DisableChn(HI3518A_VIN_CHN));
	 SOC_CHECK(HI_MPI_VI_DisableDev(HI3518A_VIN_CHN));
	if(_isp_attr.md_alarm_thread_trigger){
		_isp_attr.md_alarm_thread_trigger = false;
		pthread_join(_isp_attr.md_alarm_pid, 0);
		_isp_attr.md_alarm_pid = NULL;
	}

	 if(_isp_attr.awb_thread_trigger){
		 _isp_attr.awb_thread_trigger = false;
		 pthread_join(_isp_attr.awb_cal_pid, 0);
		 _isp_attr.awb_cal_pid = NULL;
	 }

     SOC_CHECK(HI_MPI_ISP_Exit(0));
	 if(_isp_attr.isp_run_pid){
		 pthread_join(_isp_attr.isp_run_pid, 0);
		 _isp_attr.isp_run_pid = 0;
	 }
	 
	 hi_mpp_vb_destroy();
	 
     return 0;
}



